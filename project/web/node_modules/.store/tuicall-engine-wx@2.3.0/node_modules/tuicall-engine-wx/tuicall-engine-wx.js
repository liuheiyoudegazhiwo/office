import*as t from"@tencentcloud/chat";import e from"trtc-wx-sdk";function n(t,e,n,r,i){var a={};return Object.keys(r).forEach((function(t){a[t]=r[t]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,r){return r(t,e,n)||n}),a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(t,e,a),null):a}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function i(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function a(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){a(o,r,i,s,c,"next",t)}function c(t){a(o,r,i,s,c,"throw",t)}s(void 0)}))}}function s(t,e,n){return e=v(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,y()?Reflect.construct(e,n||[],v(t).constructor):e.apply(t,n))}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){return t.get(i(t,e))}function l(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,T(r.key),r)}}function d(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=D(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function p(t,e,n){return(e=T(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&R(t,e)}function y(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(y=function(){return!!t})()}function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach((function(e){p(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function E(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;n[r]=t[r]}return n}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)n=a[r],-1===e.indexOf(n)&&{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function _(){_=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var a=e&&e.prototype instanceof y?e:y,o=Object.create(a.prototype),s=new k(r||[]);return i(o,"_invoke",{value:w(t,n,s)}),o}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",f="suspendedYield",p="executing",v="completed",g={};function y(){}function I(){}function m(){}var E={};u(E,o,(function(){return this}));var R=Object.getPrototypeOf,b=R&&R(R(A([])));b&&b!==n&&r.call(b,o)&&(E=b);var T=m.prototype=y.prototype=Object.create(E);function C(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function D(t,e){function n(i,a,o,s){var c=h(t[i],t,a);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):e.resolve(l).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,s)}))}s(c.arg)}var a;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return a=a?a.then(i,i):i()}})}function w(e,n,r){var i=d;return function(a,o){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===a)throw o;return{value:t,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var c=S(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=h(e,n,r);if("normal"===u.type){if(i=r.done?v:f,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=v,r.method="throw",r.arg=u.arg)}}}function S(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var a=h(i,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var o=a.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function A(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(typeof e+" is not iterable")}return I.prototype=m,i(T,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:I,configurable:!0}),I.displayName=u(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===I||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,u(t,c,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},C(D.prototype),u(D.prototype,s,(function(){return this})),e.AsyncIterator=D,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new D(l(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},C(T),u(T,c,"Generator"),u(T,o,(function(){return this})),u(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=A,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;x(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function R(t,e){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},R(t,e)}function b(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||D(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function D(t,e){if(t){if("string"==typeof t)return r(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}function w(t){var e="function"==typeof Map?new Map:void 0;return w=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(y())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&R(i,n.prototype),i}(t,arguments,v(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),R(n,t)},w(t)}var S="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function O(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var x=function(t){return t&&t.Math===Math&&t},k=x("object"==typeof globalThis&&globalThis)||x("object"==typeof window&&window)||x("object"==typeof self&&self)||x("object"==typeof S&&S)||x("object"==typeof S&&S)||function(){return this}()||Function("return this")(),A={},L=function(t){try{return!!t()}catch(t){return!0}},N=!L((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),U=!L((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),P=U,M=Function.prototype.call,j=P?M.bind(M):function(){return M.apply(M,arguments)},V={},G={}.propertyIsEnumerable,H=Object.getOwnPropertyDescriptor,F=H&&!G.call({1:2},1);V.f=F?function(t){var e=H(this,t);return!!e&&e.enumerable}:G;var B,K,q=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},W=U,z=Function.prototype,J=z.call,Y=W&&z.bind.bind(J,J),Q=W?Y:function(t){return function(){return J.apply(t,arguments)}},$=Q,X=$({}.toString),Z=$("".slice),tt=function(t){return Z(X(t),8,-1)},et=L,nt=tt,rt=Object,it=Q("".split),at=et((function(){return!rt("z").propertyIsEnumerable(0)}))?function(t){return"String"===nt(t)?it(t,""):rt(t)}:rt,ot=function(t){return null==t},st=ot,ct=TypeError,ut=function(t){if(st(t))throw new ct("Can't call method on "+t);return t},lt=at,ht=ut,dt=function(t){return lt(ht(t))},ft="object"==typeof document&&document.all,pt=void 0===ft&&void 0!==ft?function(t){return"function"==typeof t||t===ft}:function(t){return"function"==typeof t},vt=pt,gt=function(t){return"object"==typeof t?null!==t:vt(t)},yt=k,It=pt,mt=function(t,e){return arguments.length<2?(n=yt[t],It(n)?n:void 0):yt[t]&&yt[t][e];var n},Et=Q({}.isPrototypeOf),_t=k.navigator,Rt=_t&&_t.userAgent,bt=Rt?String(Rt):"",Tt=k,Ct=bt,Dt=Tt.process,wt=Tt.Deno,St=Dt&&Dt.versions||wt&&wt.version,Ot=St&&St.v8;Ot&&(K=(B=Ot.split("."))[0]>0&&B[0]<4?1:+(B[0]+B[1])),!K&&Ct&&(!(B=Ct.match(/Edge\/(\d+)/))||B[1]>=74)&&(B=Ct.match(/Chrome\/(\d+)/))&&(K=+B[1]);var xt=K,kt=xt,At=L,Lt=k.String,Nt=!!Object.getOwnPropertySymbols&&!At((function(){var t=Symbol("symbol detection");return!Lt(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&kt&&kt<41})),Ut=Nt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Pt=mt,Mt=pt,jt=Et,Vt=Object,Gt=Ut?function(t){return"symbol"==typeof t}:function(t){var e=Pt("Symbol");return Mt(e)&&jt(e.prototype,Vt(t))},Ht=String,Ft=function(t){try{return Ht(t)}catch(t){return"Object"}},Bt=pt,Kt=Ft,qt=TypeError,Wt=function(t){if(Bt(t))return t;throw new qt(Kt(t)+" is not a function")},zt=Wt,Jt=ot,Yt=function(t,e){var n=t[e];return Jt(n)?void 0:zt(n)},Qt=j,$t=pt,Xt=gt,Zt=TypeError,te={exports:{}},ee=k,ne=Object.defineProperty,re=function(t,e){try{ne(ee,t,{value:e,configurable:!0,writable:!0})}catch(n){ee[t]=e}return e},ie=k,ae=re,oe="__core-js_shared__",se=te.exports=ie[oe]||ae(oe,{});(se.versions||(se.versions=[])).push({version:"3.40.0",mode:"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.40.0/LICENSE",source:"https://github.com/zloirock/core-js"});var ce=te.exports,ue=function(t,e){return ce[t]||(ce[t]=e||{})},le=ut,he=Object,de=function(t){return he(le(t))},fe=de,pe=Q({}.hasOwnProperty),ve=Object.hasOwn||function(t,e){return pe(fe(t),e)},ge=Q,ye=0,Ie=Math.random(),me=ge(1..toString),Ee=function(t){return"Symbol("+(void 0===t?"":t)+")_"+me(++ye+Ie,36)},_e=ue,Re=ve,be=Ee,Te=Nt,Ce=Ut,De=k.Symbol,we=_e("wks"),Se=Ce?De.for||De:De&&De.withoutSetter||be,Oe=function(t){return Re(we,t)||(we[t]=Te&&Re(De,t)?De[t]:Se("Symbol."+t)),we[t]},xe=j,ke=gt,Ae=Gt,Le=Yt,Ne=function(t,e){var n,r;if("string"===e&&$t(n=t.toString)&&!Xt(r=Qt(n,t)))return r;if($t(n=t.valueOf)&&!Xt(r=Qt(n,t)))return r;if("string"!==e&&$t(n=t.toString)&&!Xt(r=Qt(n,t)))return r;throw new Zt("Can't convert object to primitive value")},Ue=TypeError,Pe=Oe("toPrimitive"),Me=function(t,e){if(!ke(t)||Ae(t))return t;var n,r=Le(t,Pe);if(r){if(void 0===e&&(e="default"),n=xe(r,t,e),!ke(n)||Ae(n))return n;throw new Ue("Can't convert object to primitive value")}return void 0===e&&(e="number"),Ne(t,e)},je=Me,Ve=Gt,Ge=function(t){var e=je(t,"string");return Ve(e)?e:e+""},He=gt,Fe=k.document,Be=He(Fe)&&He(Fe.createElement),Ke=function(t){return Be?Fe.createElement(t):{}},qe=Ke,We=!N&&!L((function(){return 7!==Object.defineProperty(qe("div"),"a",{get:function(){return 7}}).a})),ze=N,Je=j,Ye=V,Qe=q,$e=dt,Xe=Ge,Ze=ve,tn=We,en=Object.getOwnPropertyDescriptor;A.f=ze?en:function(t,e){if(t=$e(t),e=Xe(e),tn)try{return en(t,e)}catch(t){}if(Ze(t,e))return Qe(!Je(Ye.f,t,e),t[e])};var nn={},rn=N&&L((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),an=gt,on=String,sn=TypeError,cn=function(t){if(an(t))return t;throw new sn(on(t)+" is not an object")},un=N,ln=We,hn=rn,dn=cn,fn=Ge,pn=TypeError,vn=Object.defineProperty,gn=Object.getOwnPropertyDescriptor,yn="enumerable",In="configurable",mn="writable";nn.f=un?hn?function(t,e,n){if(dn(t),e=fn(e),dn(n),"function"==typeof t&&"prototype"===e&&"value"in n&&mn in n&&!n[mn]){var r=gn(t,e);r&&r[mn]&&(t[e]=n.value,n={configurable:In in n?n[In]:r[In],enumerable:yn in n?n[yn]:r[yn],writable:!1})}return vn(t,e,n)}:vn:function(t,e,n){if(dn(t),e=fn(e),dn(n),ln)try{return vn(t,e,n)}catch(t){}if("get"in n||"set"in n)throw new pn("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var En=nn,_n=q,Rn=N?function(t,e,n){return En.f(t,e,_n(1,n))}:function(t,e,n){return t[e]=n,t},bn={exports:{}},Tn=N,Cn=ve,Dn=Function.prototype,wn=Tn&&Object.getOwnPropertyDescriptor,Sn=Cn(Dn,"name"),On={EXISTS:Sn,PROPER:Sn&&"something"===function(){}.name,CONFIGURABLE:Sn&&(!Tn||Tn&&wn(Dn,"name").configurable)},xn=Q,kn=pt,An=te.exports,Ln=xn(Function.toString);kn(An.inspectSource)||(An.inspectSource=function(t){return Ln(t)});var Nn,Un,Pn,Mn=An.inspectSource,jn=pt,Vn=k.WeakMap,Gn=jn(Vn)&&/native code/.test(String(Vn)),Hn=Ee,Fn=ue("keys"),Bn=function(t){return Fn[t]||(Fn[t]=Hn(t))},Kn={},qn=Gn,Wn=k,zn=gt,Jn=Rn,Yn=ve,Qn=te.exports,$n=Bn,Xn=Kn,Zn="Object already initialized",tr=Wn.TypeError,er=Wn.WeakMap;if(qn||Qn.state){var nr=Qn.state||(Qn.state=new er);nr.get=nr.get,nr.has=nr.has,nr.set=nr.set,Nn=function(t,e){if(nr.has(t))throw new tr(Zn);return e.facade=t,nr.set(t,e),e},Un=function(t){return nr.get(t)||{}},Pn=function(t){return nr.has(t)}}else{var rr=$n("state");Xn[rr]=!0,Nn=function(t,e){if(Yn(t,rr))throw new tr(Zn);return e.facade=t,Jn(t,rr,e),e},Un=function(t){return Yn(t,rr)?t[rr]:{}},Pn=function(t){return Yn(t,rr)}}var ir={set:Nn,get:Un,has:Pn,enforce:function(t){return Pn(t)?Un(t):Nn(t,{})},getterFor:function(t){return function(e){var n;if(!zn(e)||(n=Un(e)).type!==t)throw new tr("Incompatible receiver, "+t+" required");return n}}},ar=Q,or=L,sr=pt,cr=ve,ur=N,lr=On.CONFIGURABLE,hr=Mn,dr=ir.enforce,fr=ir.get,pr=String,vr=Object.defineProperty,gr=ar("".slice),yr=ar("".replace),Ir=ar([].join),mr=ur&&!or((function(){return 8!==vr((function(){}),"length",{value:8}).length})),Er=String(String).split("String"),_r=bn.exports=function(t,e,n){"Symbol("===gr(pr(e),0,7)&&(e="["+yr(pr(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!cr(t,"name")||lr&&t.name!==e)&&(ur?vr(t,"name",{value:e,configurable:!0}):t.name=e),mr&&n&&cr(n,"arity")&&t.length!==n.arity&&vr(t,"length",{value:n.arity});try{n&&cr(n,"constructor")&&n.constructor?ur&&vr(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var r=dr(t);return cr(r,"source")||(r.source=Ir(Er,"string"==typeof e?e:"")),t};Function.prototype.toString=_r((function(){return sr(this)&&fr(this).source||hr(this)}),"toString");var Rr=pt,br=nn,Tr=bn.exports,Cr=re,Dr=function(t,e,n,r){r||(r={});var i=r.enumerable,a=void 0!==r.name?r.name:e;if(Rr(n)&&Tr(n,a,r),r.global)i?t[e]=n:Cr(e,n);else{try{r.unsafe?t[e]&&(i=!0):delete t[e]}catch(t){}i?t[e]=n:br.f(t,e,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return t},wr={},Sr=Math.ceil,Or=Math.floor,xr=Math.trunc||function(t){var e=+t;return(e>0?Or:Sr)(e)},kr=function(t){var e=+t;return e!=e||0===e?0:xr(e)},Ar=kr,Lr=Math.max,Nr=Math.min,Ur=function(t,e){var n=Ar(t);return n<0?Lr(n+e,0):Nr(n,e)},Pr=kr,Mr=Math.min,jr=function(t){var e=Pr(t);return e>0?Mr(e,9007199254740991):0},Vr=jr,Gr=function(t){return Vr(t.length)},Hr=dt,Fr=Ur,Br=Gr,Kr=function(t){return function(e,n,r){var i=Hr(e),a=Br(i);if(0===a)return!t&&-1;var o,s=Fr(r,a);if(t&&n!=n){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((t||s in i)&&i[s]===n)return t||s||0;return!t&&-1}},qr={includes:Kr(!0),indexOf:Kr(!1)},Wr=ve,zr=dt,Jr=qr.indexOf,Yr=Kn,Qr=Q([].push),$r=function(t,e){var n,r=zr(t),i=0,a=[];for(n in r)!Wr(Yr,n)&&Wr(r,n)&&Qr(a,n);for(;e.length>i;)Wr(r,n=e[i++])&&(~Jr(a,n)||Qr(a,n));return a},Xr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Zr=$r,ti=Xr.concat("length","prototype");wr.f=Object.getOwnPropertyNames||function(t){return Zr(t,ti)};var ei={};ei.f=Object.getOwnPropertySymbols;var ni=mt,ri=wr,ii=ei,ai=cn,oi=Q([].concat),si=ni("Reflect","ownKeys")||function(t){var e=ri.f(ai(t)),n=ii.f;return n?oi(e,n(t)):e},ci=ve,ui=si,li=A,hi=nn,di=function(t,e,n){for(var r=ui(e),i=hi.f,a=li.f,o=0;o<r.length;o++){var s=r[o];ci(t,s)||n&&ci(n,s)||i(t,s,a(e,s))}},fi=L,pi=pt,vi=/#|\.prototype\./,gi=function(t,e){var n=Ii[yi(t)];return n===Ei||n!==mi&&(pi(e)?fi(e):!!e)},yi=gi.normalize=function(t){return String(t).replace(vi,".").toLowerCase()},Ii=gi.data={},mi=gi.NATIVE="N",Ei=gi.POLYFILL="P",_i=gi,Ri=k,bi=A.f,Ti=Rn,Ci=Dr,Di=re,wi=di,Si=_i,Oi=function(t,e){var n,r,i,a,o,s=t.target,c=t.global,u=t.stat;if(n=c?Ri:u?Ri[s]||Di(s,{}):Ri[s]&&Ri[s].prototype)for(r in e){if(a=e[r],i=t.dontCallGetSet?(o=bi(n,r))&&o.value:n[r],!Si(c?r:s+(u?".":"#")+r,t.forced)&&void 0!==i){if(typeof a==typeof i)continue;wi(a,i)}(t.sham||i&&i.sham)&&Ti(a,"sham",!0),Ci(n,r,a,t)}},xi=tt,ki=Array.isArray||function(t){return"Array"===xi(t)},Ai=TypeError,Li=function(t){if(t>9007199254740991)throw Ai("Maximum allowed index exceeded");return t},Ni=N,Ui=nn,Pi=q,Mi=function(t,e,n){Ni?Ui.f(t,e,Pi(0,n)):t[e]=n},ji={};ji[Oe("toStringTag")]="z";var Vi="[object z]"===String(ji),Gi=Vi,Hi=pt,Fi=tt,Bi=Oe("toStringTag"),Ki=Object,qi="Arguments"===Fi(function(){return arguments}()),Wi=Gi?Fi:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Ki(t),Bi))?n:qi?Fi(e):"Object"===(r=Fi(e))&&Hi(e.callee)?"Arguments":r},zi=Q,Ji=L,Yi=pt,Qi=Wi,$i=Mn,Xi=function(){},Zi=mt("Reflect","construct"),ta=/^\s*(?:class|function)\b/,ea=zi(ta.exec),na=!ta.test(Xi),ra=function(t){if(!Yi(t))return!1;try{return Zi(Xi,[],t),!0}catch(t){return!1}},ia=function(t){if(!Yi(t))return!1;switch(Qi(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return na||!!ea(ta,$i(t))}catch(t){return!0}};ia.sham=!0;var aa=!Zi||Ji((function(){var t;return ra(ra.call)||!ra(Object)||!ra((function(){t=!0}))||t}))?ia:ra,oa=ki,sa=aa,ca=gt,ua=Oe("species"),la=Array,ha=function(t){var e;return oa(t)&&(e=t.constructor,(sa(e)&&(e===la||oa(e.prototype))||ca(e)&&null===(e=e[ua]))&&(e=void 0)),void 0===e?la:e},da=function(t,e){return new(ha(t))(0===e?0:e)},fa=L,pa=xt,va=Oe("species"),ga=function(t){return pa>=51||!fa((function(){var e=[];return(e.constructor={})[va]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},ya=Oi,Ia=L,ma=ki,Ea=gt,_a=de,Ra=Gr,ba=Li,Ta=Mi,Ca=da,Da=ga,wa=xt,Sa=Oe("isConcatSpreadable"),Oa=wa>=51||!Ia((function(){var t=[];return t[Sa]=!1,t.concat()[0]!==t})),xa=function(t){if(!Ea(t))return!1;var e=t[Sa];return void 0!==e?!!e:ma(t)};ya({target:"Array",proto:!0,arity:1,forced:!Oa||!Da("concat")},{concat:function(t){var e,n,r,i,a,o=_a(this),s=Ca(o,0),c=0;for(e=-1,r=arguments.length;e<r;e++)if(xa(a=-1===e?o:arguments[e]))for(i=Ra(a),ba(c+i),n=0;n<i;n++,c++)n in a&&Ta(s,c,a[n]);else ba(c+1),Ta(s,c++,a);return s.length=c,s}});var ka=tt,Aa=Q,La=function(t){if("Function"===ka(t))return Aa(t)},Na=Wt,Ua=U,Pa=La(La.bind),Ma=function(t,e){return Na(t),void 0===e?t:Ua?Pa(t,e):function(){return t.apply(e,arguments)}},ja=Ma,Va=at,Ga=de,Ha=Gr,Fa=da,Ba=Q([].push),Ka=function(t){var e=1===t,n=2===t,r=3===t,i=4===t,a=6===t,o=7===t,s=5===t||a;return function(c,u,l,h){for(var d,f,p=Ga(c),v=Va(p),g=Ha(v),y=ja(u,l),I=0,m=h||Fa,E=e?m(c,g):n||o?m(c,0):void 0;g>I;I++)if((s||I in v)&&(f=y(d=v[I],I,p),t))if(e)E[I]=f;else if(f)switch(t){case 3:return!0;case 5:return d;case 6:return I;case 2:Ba(E,d)}else switch(t){case 4:return!1;case 7:Ba(E,d)}return a?-1:r||i?i:E}},qa={forEach:Ka(0),map:Ka(1),filter:Ka(2),some:Ka(3),every:Ka(4),find:Ka(5),findIndex:Ka(6),filterReject:Ka(7)},Wa=qa.filter;Oi({target:"Array",proto:!0,forced:!ga("filter")},{filter:function(t){return Wa(this,t,arguments.length>1?arguments[1]:void 0)}});var za={},Ja=$r,Ya=Xr,Qa=Object.keys||function(t){return Ja(t,Ya)},$a=N,Xa=rn,Za=nn,to=cn,eo=dt,no=Qa;za.f=$a&&!Xa?Object.defineProperties:function(t,e){to(t);for(var n,r=eo(e),i=no(e),a=i.length,o=0;a>o;)Za.f(t,n=i[o++],r[n]);return t};var ro,io=mt("document","documentElement"),ao=cn,oo=za,so=Xr,co=Kn,uo=io,lo=Ke,ho="prototype",fo="script",po=Bn("IE_PROTO"),vo=function(){},go=function(t){return"<"+fo+">"+t+"</"+fo+">"},yo=function(t){t.write(go("")),t.close();var e=t.parentWindow.Object;return t=null,e},Io=function(){try{ro=new ActiveXObject("htmlfile")}catch(t){}var t,e,n;Io="undefined"!=typeof document?document.domain&&ro?yo(ro):(e=lo("iframe"),n="java"+fo+":",e.style.display="none",uo.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(go("document.F=Object")),t.close(),t.F):yo(ro);for(var r=so.length;r--;)delete Io[ho][so[r]];return Io()};co[po]=!0;var mo=Object.create||function(t,e){var n;return null!==t?(vo[ho]=ao(t),n=new vo,vo[ho]=null,n[po]=t):n=Io(),void 0===e?n:oo.f(n,e)},Eo=Oe,_o=mo,Ro=nn.f,bo=Eo("unscopables"),To=Array.prototype;void 0===To[bo]&&Ro(To,bo,{configurable:!0,value:_o(null)});var Co=function(t){To[bo][t]=!0},Do=Oi,wo=qa.find,So=Co,Oo="find",xo=!0;Oo in[]&&Array(1)[Oo]((function(){xo=!1})),Do({target:"Array",proto:!0,forced:xo},{find:function(t){return wo(this,t,arguments.length>1?arguments[1]:void 0)}}),So(Oo);var ko=L,Ao=function(t,e){var n=[][t];return!!n&&ko((function(){n.call(null,e||function(){return 1},1)}))},Lo=qa.forEach,No=Ao("forEach")?[].forEach:function(t){return Lo(this,t,arguments.length>1?arguments[1]:void 0)};Oi({target:"Array",proto:!0,forced:[].forEach!==No},{forEach:No});var Uo=j,Po=cn,Mo=Yt,jo=function(t,e,n){var r,i;Po(t);try{if(!(r=Mo(t,"return"))){if("throw"===e)throw n;return n}r=Uo(r,t)}catch(t){i=!0,r=t}if("throw"===e)throw n;if(i)throw r;return Po(r),n},Vo=cn,Go=jo,Ho={},Fo=Ho,Bo=Oe("iterator"),Ko=Array.prototype,qo=function(t){return void 0!==t&&(Fo.Array===t||Ko[Bo]===t)},Wo=Wi,zo=Yt,Jo=ot,Yo=Ho,Qo=Oe("iterator"),$o=function(t){if(!Jo(t))return zo(t,Qo)||zo(t,"@@iterator")||Yo[Wo(t)]},Xo=j,Zo=Wt,ts=cn,es=Ft,ns=$o,rs=TypeError,is=function(t,e){var n=arguments.length<2?ns(t):e;if(Zo(n))return ts(Xo(n,t));throw new rs(es(t)+" is not iterable")},as=Ma,os=j,ss=de,cs=function(t,e,n,r){try{return r?e(Vo(n)[0],n[1]):e(n)}catch(e){Go(t,"throw",e)}},us=qo,ls=aa,hs=Gr,ds=Mi,fs=is,ps=$o,vs=Array,gs=Oe("iterator"),ys=!1;try{var Is=0,ms={next:function(){return{done:!!Is++}},return:function(){ys=!0}};ms[gs]=function(){return this},Array.from(ms,(function(){throw 2}))}catch(t){}var Es=function(t,e){try{if(!e&&!ys)return!1}catch(t){return!1}var n=!1;try{var r={};r[gs]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n},_s=function(t){var e=ss(t),n=ls(this),r=arguments.length,i=r>1?arguments[1]:void 0,a=void 0!==i;a&&(i=as(i,r>2?arguments[2]:void 0));var o,s,c,u,l,h,d=ps(e),f=0;if(!d||this===vs&&us(d))for(o=hs(e),s=n?new this(o):vs(o);o>f;f++)h=a?i(e[f],f):e[f],ds(s,f,h);else for(s=n?new this:[],l=(u=fs(e,d)).next;!(c=os(l,u)).done;f++)h=a?cs(u,i,[c.value,f],!0):c.value,ds(s,f,h);return s.length=f,s};Oi({target:"Array",stat:!0,forced:!Es((function(t){Array.from(t)}))},{from:_s});var Rs=Oi,bs=qr.indexOf,Ts=Ao,Cs=La([].indexOf),Ds=!!Cs&&1/Cs([1],1,-0)<0;Rs({target:"Array",proto:!0,forced:Ds||!Ts("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return Ds?Cs(this,t,e)||0:bs(this,t,e)}});var ws,Ss,Os,xs=!L((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),ks=ve,As=pt,Ls=de,Ns=xs,Us=Bn("IE_PROTO"),Ps=Object,Ms=Ps.prototype,js=Ns?Ps.getPrototypeOf:function(t){var e=Ls(t);if(ks(e,Us))return e[Us];var n=e.constructor;return As(n)&&e instanceof n?n.prototype:e instanceof Ps?Ms:null},Vs=L,Gs=pt,Hs=gt,Fs=js,Bs=Dr,Ks=Oe("iterator"),qs=!1;[].keys&&("next"in(Os=[].keys())?(Ss=Fs(Fs(Os)))!==Object.prototype&&(ws=Ss):qs=!0);var Ws=!Hs(ws)||Vs((function(){var t={};return ws[Ks].call(t)!==t}));Ws&&(ws={}),Gs(ws[Ks])||Bs(ws,Ks,(function(){return this}));var zs={IteratorPrototype:ws,BUGGY_SAFARI_ITERATORS:qs},Js=nn.f,Ys=ve,Qs=Oe("toStringTag"),$s=function(t,e,n){t&&!n&&(t=t.prototype),t&&!Ys(t,Qs)&&Js(t,Qs,{configurable:!0,value:e})},Xs=zs.IteratorPrototype,Zs=mo,tc=q,ec=$s,nc=Ho,rc=function(){return this},ic=Q,ac=Wt,oc=gt,sc=function(t){return oc(t)||null===t},cc=String,uc=TypeError,lc=function(t,e,n){try{return ic(ac(Object.getOwnPropertyDescriptor(t,e)[n]))}catch(t){}},hc=gt,dc=ut,fc=function(t){if(sc(t))return t;throw new uc("Can't set "+cc(t)+" as a prototype")},pc=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=lc(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return dc(n),fc(r),hc(n)?(e?t(n,r):n.__proto__=r,n):n}}():void 0),vc=Oi,gc=j,yc=pt,Ic=function(t,e,n,r){var i=e+" Iterator";return t.prototype=Zs(Xs,{next:tc(+!r,n)}),ec(t,i,!1),nc[i]=rc,t},mc=js,Ec=pc,_c=$s,Rc=Rn,bc=Dr,Tc=Ho,Cc=On.PROPER,Dc=On.CONFIGURABLE,wc=zs.IteratorPrototype,Sc=zs.BUGGY_SAFARI_ITERATORS,Oc=Oe("iterator"),xc="keys",kc="values",Ac="entries",Lc=function(){return this},Nc=function(t,e,n,r,i,a,o){Ic(n,e,r);var s,c,u,l=function(t){if(t===i&&v)return v;if(!Sc&&t&&t in f)return f[t];switch(t){case xc:case kc:case Ac:return function(){return new n(this,t)}}return function(){return new n(this)}},h=e+" Iterator",d=!1,f=t.prototype,p=f[Oc]||f["@@iterator"]||i&&f[i],v=!Sc&&p||l(i),g="Array"===e&&f.entries||p;if(g&&(s=mc(g.call(new t)))!==Object.prototype&&s.next&&(mc(s)!==wc&&(Ec?Ec(s,wc):yc(s[Oc])||bc(s,Oc,Lc)),_c(s,h,!0)),Cc&&i===kc&&p&&p.name!==kc&&(Dc?Rc(f,"name",kc):(d=!0,v=function(){return gc(p,this)})),i)if(c={values:l(kc),keys:a?v:l(xc),entries:l(Ac)},o)for(u in c)(Sc||d||!(u in f))&&bc(f,u,c[u]);else vc({target:e,proto:!0,forced:Sc||d},c);return f[Oc]!==v&&bc(f,Oc,v,{name:i}),Tc[e]=v,c},Uc=function(t,e){return{value:t,done:e}},Pc=dt,Mc=Co,jc=Ho,Vc=ir,Gc=nn.f,Hc=Nc,Fc=Uc,Bc=N,Kc="Array Iterator",qc=Vc.set,Wc=Vc.getterFor(Kc),zc=Hc(Array,"Array",(function(t,e){qc(this,{type:Kc,target:Pc(t),index:0,kind:e})}),(function(){var t=Wc(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,Fc(void 0,!0);switch(t.kind){case"keys":return Fc(n,!1);case"values":return Fc(e[n],!1)}return Fc([n,e[n]],!1)}),"values"),Jc=jc.Arguments=jc.Array;if(Mc("keys"),Mc("values"),Mc("entries"),Bc&&"values"!==Jc.name)try{Gc(Jc,"name",{value:"values"})}catch(t){}var Yc=qa.map;Oi({target:"Array",proto:!0,forced:!ga("map")},{map:function(t){return Yc(this,t,arguments.length>1?arguments[1]:void 0)}});var Qc=Q([].slice),$c=Oi,Xc=ki,Zc=aa,tu=gt,eu=Ur,nu=Gr,ru=dt,iu=Mi,au=Oe,ou=Qc,su=ga("slice"),cu=au("species"),uu=Array,lu=Math.max;$c({target:"Array",proto:!0,forced:!su},{slice:function(t,e){var n,r,i,a=ru(this),o=nu(a),s=eu(t,o),c=eu(void 0===e?o:e,o);if(Xc(a)&&(n=a.constructor,(Zc(n)&&(n===uu||Xc(n.prototype))||tu(n)&&null===(n=n[cu]))&&(n=void 0),n===uu||void 0===n))return ou(a,s,c);for(r=new(void 0===n?uu:n)(lu(c-s,0)),i=0;s<c;s++,i++)s in a&&iu(r,i,a[s]);return r.length=i,r}});var hu=Oi,du=Date,fu=Q(du.prototype.getTime);hu({target:"Date",stat:!0},{now:function(){return fu(new du)}});var pu=de,vu=Me;Oi({target:"Date",proto:!0,arity:1,forced:L((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}))},{toJSON:function(t){var e=pu(this),n=vu(e,"number");return"number"!=typeof n||isFinite(n)?e.toISOString():null}});var gu=Q,yu=Dr,Iu=Date.prototype,mu="Invalid Date",Eu="toString",_u=gu(Iu[Eu]),Ru=gu(Iu.getTime);String(new Date(NaN))!==mu&&yu(Iu,Eu,(function(){var t=Ru(this);return t==t?_u(this):mu}));var bu=bn.exports,Tu=nn,Cu=function(t,e,n){return n.get&&bu(n.get,e,{getter:!0}),n.set&&bu(n.set,e,{setter:!0}),Tu.f(t,e,n)},Du=N,wu=On.EXISTS,Su=Q,Ou=Cu,xu=Function.prototype,ku=Su(xu.toString),Au=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,Lu=Su(Au.exec);Du&&!wu&&Ou(xu,"name",{configurable:!0,get:function(){try{return Lu(Au,ku(this))[1]}catch(t){return""}}});var Nu=Oi,Uu=L,Pu=dt,Mu=A.f,ju=N;Nu({target:"Object",stat:!0,forced:!ju||Uu((function(){Mu(1)})),sham:!ju},{getOwnPropertyDescriptor:function(t,e){return Mu(Pu(t),e)}});var Vu=de,Gu=Qa;Oi({target:"Object",stat:!0,forced:L((function(){Gu(1)}))},{keys:function(t){return Gu(Vu(t))}});var Hu=Wi,Fu=Vi?{}.toString:function(){return"[object "+Hu(this)+"]"};Vi||Dr(Object.prototype,"toString",Fu,{unsafe:!0});var Bu,Ku,qu,Wu,zu=k,Ju=bt,Yu=tt,Qu=function(t){return Ju.slice(0,t.length)===t},$u=Qu("Bun/")?"BUN":Qu("Cloudflare-Workers")?"CLOUDFLARE":Qu("Deno/")?"DENO":Qu("Node.js/")?"NODE":zu.Bun&&"string"==typeof Bun.version?"BUN":zu.Deno&&"object"==typeof Deno.version?"DENO":"process"===Yu(zu.process)?"NODE":zu.window&&zu.document?"BROWSER":"REST",Xu="NODE"===$u,Zu=mt,tl=Cu,el=N,nl=Oe("species"),rl=function(t){var e=Zu(t);el&&e&&!e[nl]&&tl(e,nl,{configurable:!0,get:function(){return this}})},il=Et,al=TypeError,ol=function(t,e){if(il(e,t))return t;throw new al("Incorrect invocation")},sl=aa,cl=Ft,ul=TypeError,ll=cn,hl=function(t){if(sl(t))return t;throw new ul(cl(t)+" is not a constructor")},dl=ot,fl=Oe("species"),pl=U,vl=Function.prototype,gl=vl.apply,yl=vl.call,Il="object"==typeof Reflect&&Reflect.apply||(pl?yl.bind(gl):function(){return yl.apply(gl,arguments)}),ml=TypeError,El=function(t,e){if(t<e)throw new ml("Not enough arguments");return t},_l=/(?:ipad|iphone|ipod).*applewebkit/i.test(bt),Rl=k,bl=Il,Tl=Ma,Cl=pt,Dl=ve,wl=L,Sl=io,Ol=Qc,xl=Ke,kl=El,Al=_l,Ll=Xu,Nl=Rl.setImmediate,Ul=Rl.clearImmediate,Pl=Rl.process,Ml=Rl.Dispatch,jl=Rl.Function,Vl=Rl.MessageChannel,Gl=Rl.String,Hl=0,Fl={},Bl="onreadystatechange";wl((function(){Bu=Rl.location}));var Kl=function(t){if(Dl(Fl,t)){var e=Fl[t];delete Fl[t],e()}},ql=function(t){return function(){Kl(t)}},Wl=function(t){Kl(t.data)},zl=function(t){Rl.postMessage(Gl(t),Bu.protocol+"//"+Bu.host)};Nl&&Ul||(Nl=function(t){kl(arguments.length,1);var e=Cl(t)?t:jl(t),n=Ol(arguments,1);return Fl[++Hl]=function(){bl(e,void 0,n)},Ku(Hl),Hl},Ul=function(t){delete Fl[t]},Ll?Ku=function(t){Pl.nextTick(ql(t))}:Ml&&Ml.now?Ku=function(t){Ml.now(ql(t))}:Vl&&!Al?(Wu=(qu=new Vl).port2,qu.port1.onmessage=Wl,Ku=Tl(Wu.postMessage,Wu)):Rl.addEventListener&&Cl(Rl.postMessage)&&!Rl.importScripts&&Bu&&"file:"!==Bu.protocol&&!wl(zl)?(Ku=zl,Rl.addEventListener("message",Wl,!1)):Ku=Bl in xl("script")?function(t){Sl.appendChild(xl("script"))[Bl]=function(){Sl.removeChild(this),Kl(t)}}:function(t){setTimeout(ql(t),0)});var Jl={set:Nl,clear:Ul},Yl=k,Ql=N,$l=Object.getOwnPropertyDescriptor,Xl=function(){this.head=null,this.tail=null};Xl.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}};var Zl,th,eh,nh,rh,ih=Xl,ah=/ipad|iphone|ipod/i.test(bt)&&"undefined"!=typeof Pebble,oh=/web0s(?!.*chrome)/i.test(bt),sh=k,ch=function(t){if(!Ql)return Yl[t];var e=$l(Yl,t);return e&&e.value},uh=Ma,lh=Jl.set,hh=ih,dh=_l,fh=ah,ph=oh,vh=Xu,gh=sh.MutationObserver||sh.WebKitMutationObserver,yh=sh.document,Ih=sh.process,mh=sh.Promise,Eh=ch("queueMicrotask");if(!Eh){var _h=new hh,Rh=function(){var t,e;for(vh&&(t=Ih.domain)&&t.exit();e=_h.get();)try{e()}catch(t){throw _h.head&&Zl(),t}t&&t.enter()};dh||vh||ph||!gh||!yh?!fh&&mh&&mh.resolve?((nh=mh.resolve(void 0)).constructor=mh,rh=uh(nh.then,nh),Zl=function(){rh(Rh)}):vh?Zl=function(){Ih.nextTick(Rh)}:(lh=uh(lh,sh),Zl=function(){lh(Rh)}):(th=!0,eh=yh.createTextNode(""),new gh(Rh).observe(eh,{characterData:!0}),Zl=function(){eh.data=th=!th}),Eh=function(t){_h.head||Zl(),_h.add(t)}}var bh=Eh,Th=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Ch=k.Promise,Dh=k,wh=Ch,Sh=pt,Oh=_i,xh=Mn,kh=Oe,Ah=$u,Lh=xt;wh&&wh.prototype;var Nh=kh("species"),Uh=!1,Ph=Sh(Dh.PromiseRejectionEvent),Mh=Oh("Promise",(function(){var t=xh(wh),e=t!==String(wh);if(!e&&66===Lh)return!0;if(!Lh||Lh<51||!/native code/.test(t)){var n=new wh((function(t){t(1)})),r=function(t){t((function(){}),(function(){}))};if((n.constructor={})[Nh]=r,!(Uh=n.then((function(){}))instanceof r))return!0}return!(e||"BROWSER"!==Ah&&"DENO"!==Ah||Ph)})),jh={CONSTRUCTOR:Mh,REJECTION_EVENT:Ph,SUBCLASSING:Uh},Vh={},Gh=Wt,Hh=TypeError,Fh=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw new Hh("Bad Promise constructor");e=t,n=r})),this.resolve=Gh(e),this.reject=Gh(n)};Vh.f=function(t){return new Fh(t)};var Bh,Kh,qh,Wh=Oi,zh=Xu,Jh=k,Yh=j,Qh=Dr,$h=pc,Xh=$s,Zh=rl,td=Wt,ed=pt,nd=gt,rd=ol,id=function(t,e){var n,r=ll(t).constructor;return void 0===r||dl(n=ll(r)[fl])?e:hl(n)},ad=Jl.set,od=bh,sd=function(t,e){try{1===arguments.length?console.error(t):console.error(t,e)}catch(t){}},cd=Th,ud=ih,ld=ir,hd=Ch,dd=Vh,fd="Promise",pd=jh.CONSTRUCTOR,vd=jh.REJECTION_EVENT,gd=jh.SUBCLASSING,yd=ld.getterFor(fd),Id=ld.set,md=hd&&hd.prototype,Ed=hd,_d=md,Rd=Jh.TypeError,bd=Jh.document,Td=Jh.process,Cd=dd.f,Dd=Cd,wd=!!(bd&&bd.createEvent&&Jh.dispatchEvent),Sd="unhandledrejection",Od=function(t){var e;return!(!nd(t)||!ed(e=t.then))&&e},xd=function(t,e){var n,r,i,a=e.value,o=1===e.state,s=o?t.ok:t.fail,c=t.resolve,u=t.reject,l=t.domain;try{s?(o||(2===e.rejection&&Ud(e),e.rejection=1),!0===s?n=a:(l&&l.enter(),n=s(a),l&&(l.exit(),i=!0)),n===t.promise?u(new Rd("Promise-chain cycle")):(r=Od(n))?Yh(r,n,c,u):c(n)):u(a)}catch(t){l&&!i&&l.exit(),u(t)}},kd=function(t,e){t.notified||(t.notified=!0,od((function(){for(var n,r=t.reactions;n=r.get();)xd(n,t);t.notified=!1,e&&!t.rejection&&Ld(t)})))},Ad=function(t,e,n){var r,i;wd?((r=bd.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),Jh.dispatchEvent(r)):r={promise:e,reason:n},!vd&&(i=Jh["on"+t])?i(r):t===Sd&&sd("Unhandled promise rejection",n)},Ld=function(t){Yh(ad,Jh,(function(){var e,n=t.facade,r=t.value;if(Nd(t)&&(e=cd((function(){zh?Td.emit("unhandledRejection",r,n):Ad(Sd,n,r)})),t.rejection=zh||Nd(t)?2:1,e.error))throw e.value}))},Nd=function(t){return 1!==t.rejection&&!t.parent},Ud=function(t){Yh(ad,Jh,(function(){var e=t.facade;zh?Td.emit("rejectionHandled",e):Ad("rejectionhandled",e,t.value)}))},Pd=function(t,e,n){return function(r){t(e,r,n)}},Md=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,kd(t,!0))},jd=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw new Rd("Promise can't be resolved itself");var r=Od(e);r?od((function(){var n={done:!1};try{Yh(r,e,Pd(jd,n,t),Pd(Md,n,t))}catch(e){Md(n,e,t)}})):(t.value=e,t.state=1,kd(t,!1))}catch(e){Md({done:!1},e,t)}}};if(pd&&(_d=(Ed=function(t){rd(this,_d),td(t),Yh(Bh,this);var e=yd(this);try{t(Pd(jd,e),Pd(Md,e))}catch(t){Md(e,t)}}).prototype,(Bh=function(t){Id(this,{type:fd,done:!1,notified:!1,parent:!1,reactions:new ud,rejection:!1,state:0,value:null})}).prototype=Qh(_d,"then",(function(t,e){var n=yd(this),r=Cd(id(this,Ed));return n.parent=!0,r.ok=!ed(t)||t,r.fail=ed(e)&&e,r.domain=zh?Td.domain:void 0,0===n.state?n.reactions.add(r):od((function(){xd(r,n)})),r.promise})),Kh=function(){var t=new Bh,e=yd(t);this.promise=t,this.resolve=Pd(jd,e),this.reject=Pd(Md,e)},dd.f=Cd=function(t){return t===Ed||undefined===t?new Kh(t):Dd(t)},ed(hd)&&md!==Object.prototype)){qh=md.then,gd||Qh(md,"then",(function(t,e){var n=this;return new Ed((function(t,e){Yh(qh,n,t,e)})).then(t,e)}),{unsafe:!0});try{delete md.constructor}catch(t){}$h&&$h(md,_d)}Wh({global:!0,constructor:!0,wrap:!0,forced:pd},{Promise:Ed}),Xh(Ed,fd,!1),Zh(fd);var Vd=Ma,Gd=j,Hd=cn,Fd=Ft,Bd=qo,Kd=Gr,qd=Et,Wd=is,zd=$o,Jd=jo,Yd=TypeError,Qd=function(t,e){this.stopped=t,this.result=e},$d=Qd.prototype,Xd=function(t,e,n){var r,i,a,o,s,c,u,l=n&&n.that,h=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_RECORD),f=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),v=Vd(e,l),g=function(t){return r&&Jd(r,"normal",t),new Qd(!0,t)},y=function(t){return h?(Hd(t),p?v(t[0],t[1],g):v(t[0],t[1])):p?v(t,g):v(t)};if(d)r=t.iterator;else if(f)r=t;else{if(!(i=zd(t)))throw new Yd(Fd(t)+" is not iterable");if(Bd(i)){for(a=0,o=Kd(t);o>a;a++)if((s=y(t[a]))&&qd($d,s))return s;return new Qd(!1)}r=Wd(t,i)}for(c=d?t.next:r.next;!(u=Gd(c,r)).done;){try{s=y(u.value)}catch(t){Jd(r,"throw",t)}if("object"==typeof s&&s&&qd($d,s))return s}return new Qd(!1)},Zd=Ch,tf=jh.CONSTRUCTOR||!Es((function(t){Zd.all(t).then(void 0,(function(){}))})),ef=j,nf=Wt,rf=Vh,af=Th,of=Xd;Oi({target:"Promise",stat:!0,forced:tf},{all:function(t){var e=this,n=rf.f(e),r=n.resolve,i=n.reject,a=af((function(){var n=nf(e.resolve),a=[],o=0,s=1;of(t,(function(t){var c=o++,u=!1;s++,ef(n,e,t).then((function(t){u||(u=!0,a[c]=t,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise}});var sf=Oi,cf=jh.CONSTRUCTOR,uf=Ch,lf=mt,hf=pt,df=Dr,ff=uf&&uf.prototype;if(sf({target:"Promise",proto:!0,forced:cf,real:!0},{catch:function(t){return this.then(void 0,t)}}),hf(uf)){var pf=lf("Promise").prototype.catch;ff.catch!==pf&&df(ff,"catch",pf,{unsafe:!0})}var vf=j,gf=Wt,yf=Vh,If=Th,mf=Xd;Oi({target:"Promise",stat:!0,forced:tf},{race:function(t){var e=this,n=yf.f(e),r=n.reject,i=If((function(){var i=gf(e.resolve);mf(t,(function(t){vf(i,e,t).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Ef=Vh;Oi({target:"Promise",stat:!0,forced:jh.CONSTRUCTOR},{reject:function(t){var e=Ef.f(this);return(0,e.reject)(t),e.promise}});var _f=cn,Rf=gt,bf=Vh,Tf=Oi,Cf=jh.CONSTRUCTOR,Df=function(t,e){if(_f(t),Rf(e)&&e.constructor===t)return e;var n=bf.f(t);return(0,n.resolve)(e),n.promise};mt("Promise"),Tf({target:"Promise",stat:!0,forced:Cf},{resolve:function(t){return Df(this,t)}});var wf={exports:{}},Sf={},Of=tt,xf=dt,kf=wr.f,Af=Qc,Lf="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Sf.f=function(t){return Lf&&"Window"===Of(t)?function(t){try{return kf(t)}catch(t){return Af(Lf)}}(t):kf(xf(t))};var Nf=L((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Uf=L,Pf=gt,Mf=tt,jf=Nf,Vf=Object.isExtensible,Gf=Uf((function(){Vf(1)}))||jf?function(t){return!!Pf(t)&&((!jf||"ArrayBuffer"!==Mf(t))&&(!Vf||Vf(t)))}:Vf,Hf=!L((function(){return Object.isExtensible(Object.preventExtensions({}))})),Ff=Oi,Bf=Q,Kf=Kn,qf=gt,Wf=ve,zf=nn.f,Jf=wr,Yf=Sf,Qf=Gf,$f=Hf,Xf=!1,Zf=Ee("meta"),tp=0,ep=function(t){zf(t,Zf,{value:{objectID:"O"+tp++,weakData:{}}})},np=wf.exports={enable:function(){np.enable=function(){},Xf=!0;var t=Jf.f,e=Bf([].splice),n={};n[Zf]=1,t(n).length&&(Jf.f=function(n){for(var r=t(n),i=0,a=r.length;i<a;i++)if(r[i]===Zf){e(r,i,1);break}return r},Ff({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Yf.f}))},fastKey:function(t,e){if(!qf(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!Wf(t,Zf)){if(!Qf(t))return"F";if(!e)return"E";ep(t)}return t[Zf].objectID},getWeakData:function(t,e){if(!Wf(t,Zf)){if(!Qf(t))return!0;if(!e)return!1;ep(t)}return t[Zf].weakData},onFreeze:function(t){return $f&&Xf&&Qf(t)&&!Wf(t,Zf)&&ep(t),t}};Kf[Zf]=!0;var rp=pt,ip=gt,ap=pc,op=function(t,e,n){var r,i;return ap&&rp(r=e.constructor)&&r!==n&&ip(i=r.prototype)&&i!==n.prototype&&ap(t,i),t},sp=Oi,cp=k,up=Q,lp=_i,hp=Dr,dp=wf.exports,fp=Xd,pp=ol,vp=pt,gp=ot,yp=gt,Ip=L,mp=Es,Ep=$s,_p=op,Rp=function(t,e,n){var r=-1!==t.indexOf("Map"),i=-1!==t.indexOf("Weak"),a=r?"set":"add",o=cp[t],s=o&&o.prototype,c=o,u={},l=function(t){var e=up(s[t]);hp(s,t,"add"===t?function(t){return e(this,0===t?0:t),this}:"delete"===t?function(t){return!(i&&!yp(t))&&e(this,0===t?0:t)}:"get"===t?function(t){return i&&!yp(t)?void 0:e(this,0===t?0:t)}:"has"===t?function(t){return!(i&&!yp(t))&&e(this,0===t?0:t)}:function(t,n){return e(this,0===t?0:t,n),this})};if(lp(t,!vp(o)||!(i||s.forEach&&!Ip((function(){(new o).entries().next()})))))c=n.getConstructor(e,t,r,a),dp.enable();else if(lp(t,!0)){var h=new c,d=h[a](i?{}:-0,1)!==h,f=Ip((function(){h.has(1)})),p=mp((function(t){new o(t)})),v=!i&&Ip((function(){for(var t=new o,e=5;e--;)t[a](e,e);return!t.has(-0)}));p||((c=e((function(t,e){pp(t,s);var n=_p(new o,t,c);return gp(e)||fp(e,n[a],{that:n,AS_ENTRIES:r}),n}))).prototype=s,s.constructor=c),(f||v)&&(l("delete"),l("has"),r&&l("get")),(v||d)&&l(a),i&&s.clear&&delete s.clear}return u[t]=c,sp({global:!0,constructor:!0,forced:c!==o},u),Ep(c,t),i||n.setStrong(c,t,r),c},bp=Dr,Tp=function(t,e,n){for(var r in e)bp(t,r,e[r],n);return t},Cp=mo,Dp=Cu,wp=Tp,Sp=Ma,Op=ol,xp=ot,kp=Xd,Ap=Nc,Lp=Uc,Np=rl,Up=N,Pp=wf.exports.fastKey,Mp=ir.set,jp=ir.getterFor,Vp={getConstructor:function(t,e,n,r){var i=t((function(t,i){Op(t,a),Mp(t,{type:e,index:Cp(null),first:null,last:null,size:0}),Up||(t.size=0),xp(i)||kp(i,t[r],{that:t,AS_ENTRIES:n})})),a=i.prototype,o=jp(e),s=function(t,e,n){var r,i,a=o(t),s=c(t,e);return s?s.value=n:(a.last=s={index:i=Pp(e,!0),key:e,value:n,previous:r=a.last,next:null,removed:!1},a.first||(a.first=s),r&&(r.next=s),Up?a.size++:t.size++,"F"!==i&&(a.index[i]=s)),t},c=function(t,e){var n,r=o(t),i=Pp(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key===e)return n};return wp(a,{clear:function(){for(var t=o(this),e=t.first;e;)e.removed=!0,e.previous&&(e.previous=e.previous.next=null),e=e.next;t.first=t.last=null,t.index=Cp(null),Up?t.size=0:this.size=0},delete:function(t){var e=this,n=o(e),r=c(e,t);if(r){var i=r.next,a=r.previous;delete n.index[r.index],r.removed=!0,a&&(a.next=i),i&&(i.previous=a),n.first===r&&(n.first=i),n.last===r&&(n.last=a),Up?n.size--:e.size--}return!!r},forEach:function(t){for(var e,n=o(this),r=Sp(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:n.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!c(this,t)}}),wp(a,n?{get:function(t){var e=c(this,t);return e&&e.value},set:function(t,e){return s(this,0===t?0:t,e)}}:{add:function(t){return s(this,t=0===t?0:t,t)}}),Up&&Dp(a,"size",{configurable:!0,get:function(){return o(this).size}}),i},setStrong:function(t,e,n){var r=e+" Iterator",i=jp(e),a=jp(r);Ap(t,e,(function(t,e){Mp(this,{type:r,target:t,state:i(t),kind:e,last:null})}),(function(){for(var t=a(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?Lp("keys"===e?n.key:"values"===e?n.value:[n.key,n.value],!1):(t.target=null,Lp(void 0,!0))}),n?"entries":"values",!n,!0),Np(e)}};Rp("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),Vp);var Gp=Wi,Hp=String,Fp=function(t){if("Symbol"===Gp(t))throw new TypeError("Cannot convert a Symbol value to a string");return Hp(t)},Bp=Q,Kp=kr,qp=Fp,Wp=ut,zp=Bp("".charAt),Jp=Bp("".charCodeAt),Yp=Bp("".slice),Qp=function(t){return function(e,n){var r,i,a=qp(Wp(e)),o=Kp(n),s=a.length;return o<0||o>=s?t?"":void 0:(r=Jp(a,o))<55296||r>56319||o+1===s||(i=Jp(a,o+1))<56320||i>57343?t?zp(a,o):r:t?Yp(a,o,o+2):i-56320+(r-55296<<10)+65536}},$p={codeAt:Qp(!1),charAt:Qp(!0)},Xp=$p.charAt,Zp=Fp,tv=ir,ev=Nc,nv=Uc,rv="String Iterator",iv=tv.set,av=tv.getterFor(rv);ev(String,"String",(function(t){iv(this,{type:rv,string:Zp(t),index:0})}),(function(){var t,e=av(this),n=e.string,r=e.index;return r>=n.length?nv(void 0,!0):(t=Xp(n,r),e.index+=t.length,nv(t,!1))}));var ov={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},sv=Ke("span").classList,cv=sv&&sv.constructor&&sv.constructor.prototype,uv=cv===Object.prototype?void 0:cv,lv=k,hv=ov,dv=uv,fv=No,pv=Rn,vv=function(t){if(t&&t.forEach!==fv)try{pv(t,"forEach",fv)}catch(e){t.forEach=fv}};for(var gv in hv)hv[gv]&&vv(lv[gv]&&lv[gv].prototype);vv(dv);var yv=k,Iv=ov,mv=uv,Ev=zc,_v=Rn,Rv=$s,bv=Oe("iterator"),Tv=Ev.values,Cv=function(t,e){if(t){if(t[bv]!==Tv)try{_v(t,bv,Tv)}catch(e){t[bv]=Tv}if(Rv(t,e,!0),Iv[e])for(var n in Ev)if(t[n]!==Ev[n])try{_v(t,n,Ev[n])}catch(e){t[n]=Ev[n]}}};for(var Dv in Iv)Cv(yv[Dv]&&yv[Dv].prototype,Dv);Cv(mv,"DOMTokenList");var wv=k,Sv=Il,Ov=pt,xv=$u,kv=bt,Av=Qc,Lv=El,Nv=wv.Function,Uv=/MSIE .\./.test(kv)||"BUN"===xv&&function(){var t=wv.Bun.version.split(".");return t.length<3||"0"===t[0]&&(t[1]<3||"3"===t[1]&&"0"===t[2])}(),Pv=function(t,e){var n=e?2:1;return Uv?function(r,i){var a=Lv(arguments.length,1)>n,o=Ov(r)?r:Nv(r),s=a?Av(arguments,n):[],c=a?function(){Sv(o,this,s)}:o;return e?t(c,i):t(c)}:t},Mv=Oi,jv=k,Vv=Pv(jv.setInterval,!0);Mv({global:!0,bind:!0,forced:jv.setInterval!==Vv},{setInterval:Vv});var Gv=Oi,Hv=k,Fv=Pv(Hv.setTimeout,!0);Gv({global:!0,bind:!0,forced:Hv.setTimeout!==Fv},{setTimeout:Fv});var Bv="2.3.0",Kv={INVITED:"INVITED",ON_CALL_RECEIVED:"onCallReceived",GROUP_CALL_INVITEE_LIST_UPDATE:"GROUP_CALL_INVITEE_LIST_UPDATE",USER_ENTER:"USER_ENTER",USER_LEAVE:"USER_LEAVE",USER_ACCEPT:"USER_ACCEPT",USER_UPDATE:"USER_UPDATE",REJECT:"REJECT",NO_RESP:"NO_RESP",LINE_BUSY:"LINE_BUSY",CALLING_CANCEL:"CALLING_CANCEL",ON_CALL_CANCELED:"onCallCancelled",CALLING_TIMEOUT:"CALLING_TIMEOUT",ON_CALL_BEGIN:"onCallBegin",CALL_END:"CALL_END",USER_VIDEO_AVAILABLE:"USER_VIDEO_AVAILABLE",USER_AUDIO_AVAILABLE:"USER_AUDIO_AVAILABLE",USER_VOICE_VOLUME:"USER_VOICE_VOLUME",SDK_READY:"SDK_READY",KICKED_OUT:"KICKED_OUT",CALL_MODE:"CALL_MODE",HANG_UP:"HANG_UP",ON_USER_NETWORK_QUALITY_CHANGED:"ON_USER_NETWORK_QUALITY_CHANGED",MESSAGE_SENT_BY_ME:"onMessageSentByMe",ERROR:"ERROR",CALL_MESSAGE:"CALL_MESSAGE"},qv={IDLE:"idle",CALLING:"calling",CONNECTED:"connected"},Wv=1,zv=2,Jv=3,Yv=4,Qv=5,$v=1,Xv={AUDIO:1,VIDEO:2},Zv="",tg="inviter",eg="invitee",ng=1,rg=2,ig=["","audioCall","videoCall"],ag="audio",og="video",sg={EAR:"ear",SPEAKER:"speaker"},cg={BASE:Math.pow(2,16),PRO:Math.pow(2,17),ULTIMATE:Math.pow(2,18)},ug=2147483647,lg="video",hg="audio",dg="function",fg="inviter",pg="invitee",vg="normal",gg="reject",yg="timeout",Ig="raf",mg="interval",Eg="busyline",_g="unknown",Rg="caller",bg="callee",Tg="devtools",Cg="av_call",Dg="callkit_records_svr",wg="single",Sg="group",Og="start_call",xg="receive_call",kg="call_accepted",Ag="accept_call",Lg="call_missed",Ng="not_answer_call",Ug="call_rejected",Pg="reject_call",Mg="call_busy",jg="ignore_call",Vg="cancel_call",Gg="call_canceled",Hg="call_failed",Fg="call_end",Bg="invite_user",Kg="join_in_group_call",qg="event_report",Wg="heartbeat",zg="calling",Jg="miniProgram",Yg="banned",Qg="waiting",$g="userId",Xg="麦克风权限授权",Zg="使用语音通话，需要在设置中对麦克风进行授权允许",ty="麦克风、摄像头权限授权",ey="使用视频通话，需要在设置中对麦克风、摄像头进行授权允许",ny="去设置",ry="麦克风权限未开启",iy="在设置-应用-微信-权限中开启麦克风权限，以正常使用音视频通话功能",ay="麦克风/摄像头权限未开启",oy="在设置-应用-微信-权限中开启麦克风/摄像头权限，以正常使用音视频通话功能",sy="前往设置",cy="authorized",uy="微信开发者工具不支持原生推拉流组件(即 <live-pusher> 和 <live-player> 标签)，请使用真机调试或者扫码预览。",ly="scope.record",hy="scope.camera",dy="cameraAuthorized",fy="microphoneAuthorized",py="",vy="call_wait",gy="call_accept",yy={"":qv.IDLE,call_wait:qv.CALLING,call_accept:qv.CONNECTED},Iy={exports:{}};self;var my=O(Iy.exports=(()=>(()=>{var t={902:function(t,e,n){var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},r.apply(this,arguments)},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}c((r=r.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(e,"__esModule",{value:!0});var o,s=n(266),c=n(466),u=n(402),l=n(882),h=n(271),d=n(884),f=n(900),p=n(172);!function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARING=2]="WARING",t[t.ERROR=3]="ERROR"}(o||(o={}));var v={metric:!0,context:!0},g=function(t,e,n){return void 0===n&&(n=0),(0,s.isPlainObject)(t)?(0,s.isPlainObject)(e)?(Object.keys(e).forEach((function(r){var i=t[r],a=e[r];t[r]=v[r]&&0===n?g(i,a,1):a})),t):t:(0,s.isPlainObject)(e)?e:{}},y={clsConfig:{endpoint:"",topicId:""}},I=function(){function t(t){var e=this;this.url="",this.uploadChannel="",this.sendClsPipe=null,this.sendEsPipe=null,this._logLevel=o.INFO,this._getReportDataList=[],this._blacklist=[];var n=t||y,r=n.clsConfig,s=n.esConfig,c=r.endpoint,p=r.topicId;this.esConfig=s,this.endpoint=c,this.topicId=p;var v=this.buildUploadUrl();this.url=v,this.initPageUnloadMonitor(),v&&(this.sendClsPipe=(0,u.createPipeline)([(0,f.filterSdkappIdPipe)(this),(0,d.createThrottlePipe)(this,5),(0,l.formatClsLog)(),(0,h.limitLengthPipe)(),function(t){return i(e,void 0,void 0,(function(){var e,n,r=this;return a(this,(function(o){return e=0,n=function(){return i(r,void 0,void 0,(function(){var r;return a(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.send({url:v,data:t})];case 1:return i.sent(),[3,3];case 2:return r=i.sent(),e<=2?(e++,setTimeout((function(){n()}),1e3)):console.debug(r),[3,3];case 3:return[2]}}))}))},n(),[2]}))}))}])),this.updateBlacklist()}return t.prototype.initPageUnloadMonitor=function(){var t=this,e=this;!(0,s.isMiniProgram)()&&document&&"function"==typeof document.addEventListener&&document.addEventListener("visibilitychange",(function(){if("hidden"===document.visibilityState){var n=t.getCommonReportData(),r=g(n,{level:o.WARING,method:"PAGE_UNLOAD",type:"event"});if(e.esConfig)try{var s=e.esConfig,c=s.url,p=s.table;(0,u.createPipeline)([(0,f.filterSdkappIdPipe)(e),(0,d.createThrottlePipe)(e,1),(0,l.formatESLog)({table:p}),(0,h.limitLengthPipe)(),function(e){return i(t,void 0,void 0,(function(){var t;return a(this,(function(n){try{t=new Blob([JSON.stringify(e)],{type:"application/x-www-form-urlencoded"}),null===navigator||void 0===navigator||navigator.sendBeacon(c,t)}catch(t){console.debug(t)}return[2]}))}))}])(r)}catch(t){console.debug(t)}}}))},t.prototype.updateEsConfig=function(t){var e=this;try{if(t){this.esConfig=t;var n=t.url,r=t.table;n&&r&&(this.uploadChannel=n,this.sendEsPipe=(0,u.createPipeline)([(0,f.filterSdkappIdPipe)(this),(0,d.createThrottlePipe)(this,5),(0,l.formatESLog)({table:r}),(0,h.limitLengthPipe)(),function(t){return i(e,void 0,void 0,(function(){var e,r,o=this;return a(this,(function(s){return e=0,r=function(){return i(o,void 0,void 0,(function(){var i;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.send({url:n,data:t})];case 1:return a.sent(),[3,3];case 2:return i=a.sent(),e<=2?(e++,setTimeout((function(){r()}),1e3)):console.debug(i),[3,3];case 3:return[2]}}))}))},r(),[2]}))}))}]))}}catch(t){console.debug(t)}},t.prototype.updateGetReportData=function(t){"function"==typeof t&&this._getReportDataList.push(t)},t.prototype.updateBlacklist=function(){return i(this,void 0,void 0,(function(){var t,e,n;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,(0,c.request)({url:p.RAINBOW_BLACK_LIST_API})];case 1:return t=r.sent().data,"string"==typeof(e=null==t?void 0:t.blackList)&&(this._blacklist=e.split(",")),[3,3];case 2:return n=r.sent(),console.debug("update blacklist fail",n),[3,3];case 3:return[2]}}))}))},t.prototype.getBlackList=function(){return this._blacklist},t.prototype.setLogLevel=function(t){"number"!=typeof t&&(t=o.INFO),this._logLevel=t},t.prototype.createLogFunc=function(t){var e=this;return function(n,r){e.log(n,r,{level:t})}},t.prototype.buildUploadUrl=function(){return this.endpoint&&this.topicId?"".concat(this.endpoint,"/tracklog?topic_id=").concat(this.topicId):""},t.prototype.sendPipe=function(t){"function"==typeof this.sendClsPipe&&this.sendClsPipe(t),"function"==typeof this.sendEsPipe&&this.sendEsPipe(t)},t.prototype.info=function(t,e){this.log(t,e,{level:o.INFO})},t.prototype.debug=function(t,e){this.log(t,e,{level:o.DEBUG})},t.prototype.warn=function(t,e){this.log(t,e,{level:o.WARING})},t.prototype.error=function(t,e){this.log(t,e,{level:o.ERROR})},t.prototype.log=function(t,e,n){try{var i=n||{},a=i.level;if(i.topicId,this._logLevel<=a){var o=this.getCommonReportData(),s=g(o,r({level:a,method:t},e));this.sendPipe(s)}}catch(t){console.debug(t)}},t.prototype.getCommonReportData=function(){for(var t={},e=0;e<this._getReportDataList.length;e++)t=g(t,this._getReportDataList[e]());return t},t.prototype.send=function(t){return i(this,void 0,void 0,(function(){var e,n,r,i;return a(this,(function(a){switch(a.label){case 0:n=(e=t||{}).url,r=e.data,a.label=1;case 1:return a.trys.push([1,4,,5]),n?[4,(0,c.request)({url:n,data:r,method:"post"})]:[3,3];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:throw i=a.sent(),console.debug(i),new Error(i);case 5:return[2]}}))}))},t}();e.default=I},900:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.filterSdkappIdPipe=void 0,e.filterSdkappIdPipe=function(t){return function(e,n){try{var r=e.sdkappid,i=t.getBlackList();if(null==i?void 0:i.includes(String(r)))throw new Error("this sdkappid in blacklist");n(e)}catch(t){console.debug(t)}}}},793:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.formatClsLog=void 0;var r=n(266);e.formatClsLog=function(){return function(t,e){try{e({logs:null==t?void 0:t.map((function(t){var e={};return Object.keys(t).forEach((function(n){if((0,r.isPlainObject)(t[n]))try{e[n]=(0,r.stringifyPlus)(t[n])}catch(t){console.debug(t)}else"time"===n&&(e[n]=new Date(t[n]).toISOString()),e[n]=t[n]+""})),{contents:e,time:t.time}})),source:""})}catch(t){console.debug(t)}}}},713:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.formatESLog=void 0;var r=n(266);e.formatESLog=function(t){var e=t.table;return function(t,n){try{var i=null==t?void 0:t.map((function(t){var e={};return Object.keys(t).forEach((function(n){if((0,r.isPlainObject)(t[n]))try{e[n]=(0,r.stringifyPlus)(t[n])}catch(t){console.debug(t)}else e[n]="level"===n?t[n]+"":"time"===n?new Date(t[n]).toISOString():t[n]})),e}));n({table:e,report:i})}catch(t){console.debug(t)}}}},882:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.formatClsLog=e.formatESLog=void 0;var r=n(793);Object.defineProperty(e,"formatClsLog",{enumerable:!0,get:function(){return r.formatClsLog}});var i=n(713);Object.defineProperty(e,"formatESLog",{enumerable:!0,get:function(){return i.formatESLog}})},402:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createPipeline=void 0;var r=n(266);e.createPipeline=function(t){if(!t||!t.reduce||!t.length)throw new TypeError("createPipeline need at least one function param");return 1===t.length?function(e,n){t[0](e,n||r.noop)}:t.reduce((function(t,e){return function(n,i){return void 0===i&&(i=r.noop),t(n,(function(t){return null==e?void 0:e(t,i)}))}}))}},271:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.limitLengthPipe=e.MAX_LOG_LENGTH=void 0;var r=n(266);e.MAX_LOG_LENGTH=102400,e.limitLengthPipe=function(){return function(t,n){try{var i=(t=t||{}).logs,a=void 0===i?[]:i;t.logs=null==a?void 0:a.map((function(t){var n=e.MAX_LOG_LENGTH,i=t.contents;return Object.keys(i).forEach((function(t){var e=i[t];try{e&&e.length>n&&(i[t]=null==e?void 0:e.substring(0,n))}catch(a){console.debug("size of content > limitSize"),i[t]=(0,r.stringifyPlus)(e).substring(0,n)}})),t})),n(t)}catch(t){console.debug(t)}}}},884:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createThrottlePipe=void 0,e.createThrottlePipe=function(t,e){var n,r=[];return function(i,a){if(Array.isArray(i)?r=r.concat(i):r.push(i),e&&r.length>=e||t.sendNow&&r.length>0)return a(r.splice(0,r.length)),void(n&&clearTimeout(n));n&&clearTimeout(n),n=setTimeout((function(){n=null,r.length>0&&a(r.splice(0,r.length))}),t.delay||1e3)}}},466:function(t,e,n){var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},r.apply(this,arguments)},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}c((r=r.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},o=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.request=void 0;var s=n(732),c=n(377),u=n(266);e.request=function(t){return i(void 0,void 0,void 0,(function(){var e=t.url,n=t.data,i=t.header,l=void 0===i?{}:i,h=t.method,d=void 0===h?"GET":h,f=t.dataType,p=t.responseType,v=o(t,["url","data","header","method","dataType","responseType"]);return a(this,(function(t){return(0,u.isBrowser)()?[2,(0,c.requestXHR)(e,n,{headers:l,method:d,responseType:p,dataType:f})]:(0,u.isMiniProgram)()?[2,(0,s.requestWeapp)(r({url:e,data:n,header:l,method:d,dataType:f,responseType:p},v))]:(console.debug("unsupport env"),[2])}))}))}},732:function(t,e,n){var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},r.apply(this,arguments)},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}c((r=r.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.requestWeapp=function(t){return i(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:n.trys.push([0,5,6,7]),n.label=1;case 1:return c>=s?[4,(0,o.startBlocking)()]:[3,3];case 2:return n.sent(),[3,1];case 3:return c++,[4,new Promise((function(e,n){wx.request(r(r({},t),{success:function(t){e(t)},fail:function(t){n(t)}}))}))];case 4:return[2,n.sent()];case 5:return e=n.sent(),[2,Promise.reject(e)];case 6:return c--,(0,o.resolveFirstBlock)(),[7];case 7:return[2]}}))}))};var o=n(640),s=2,c=0},377:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}c((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.default=u,e.requestXHR=function(t){return r(this,arguments,void 0,(function(t,e,n){var l,h=this;return void 0===e&&(e={}),void 0===n&&(n={}),i(this,(function(d){switch(d.label){case 0:return d.trys.push([0,2,3,4]),[4,new Promise((function(l,d){return r(h,void 0,void 0,(function(){var r,h,f,p,v,g;return i(this,(function(i){switch(i.label){case 0:return c>=s?[4,(0,o.startBlocking)()]:[3,2];case 1:return i.sent(),[3,0];case 2:return c++,r=n.method,h=n.headers,f=void 0===h?{}:h,p=n.responseType,v=void 0===p?"json":p,r=(r||"get").toUpperCase(),Object.assign(f,{"Content-type":"application/json"}),(g=new window.XMLHttpRequest).responseType=v,g.timeout=1e4,g.onreadystatechange=function(){4===g.readyState&&(200===g.status?l({data:g.response}):d({code:g.status,msg:g.statusText}))},g.ontimeout=function(t){d({code:g.status,msg:g.statusText})},g.onloadend=function(){g&&(u((function(t){l(t)}),(function(t){d(t)}),{status:g.status,statusText:g.statusText}),g=null)},g.onabort=function(){g&&(d(new Error("Request aborted")),g=null)},g.onerror=function(){d(new Error("Network Error")),g=null},"GET"===r?t="".concat(t).concat(-1===t.indexOf("?")?"?":"&").concat(a.default.stringify(e)):"POST"===r&&(e=JSON.stringify(e)),g.open(r,t,!0),Object.keys(f).forEach((function(t){g.setRequestHeader(t,f[t])})),g.send("POST"===r?e:null),[2]}}))}))}))];case 1:return[2,d.sent()];case 2:throw l=d.sent(),new Error(l);case 3:return c--,(0,o.resolveFirstBlock)(),[7];case 4:return[2]}}))}))};var a=n(383),o=n(640),s=2,c=0;function u(t,e,n){n.status?e(new Error("Request failed with status code "+n.status)):t(n)}},172:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RAINBOW_BLACK_LIST_API=void 0,e.RAINBOW_BLACK_LIST_API="https://jsonschema.qpic.cn/87084b1b6d263426b92926cfa5fa23af/18f29786d25587b5eb162d5e9f724b1e/blackList"},266:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.date2ISOString=e.stringifyPlus=e.noop=e.isBrowser=e.isMiniProgram=e.isPlainObject=e.appendParams=void 0,e.appendParams=function(t,n){void 0===n&&(n={});var r=[];return Object.keys(n).forEach((function(t){var i=n[t];if(void 0!==i){if((0,e.isPlainObject)(i))try{i=JSON.stringify(i)}catch(t){}r.push("".concat(t,"=").concat(encodeURIComponent(i)))}})),r.length?(t.indexOf("?")>-1?"".concat(t,"&"):"".concat(t,"?"))+r.join("&"):t},e.isPlainObject=function(t){if("object"!=typeof t||null===t)return!1;var e=Object.getPrototypeOf(t);if(null===e)return!0;for(var n=e;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return e===n},e.isMiniProgram=function(){try{return!(!(null===wx||void 0===wx?void 0:wx.request)||!(null===wx||void 0===wx?void 0:wx.connectSocket))}catch(t){return!1}},e.isBrowser=function(){try{return!(0,e.isMiniProgram)()&&"undefined"!=typeof window&&void 0!==window.document}catch(t){return!1}},e.noop=function(){};var n=function(){var t=new WeakSet;return function(e,n){if(n instanceof Error)return"Error.message: ".concat(n.message," \n  Error.stack: ").concat(n.stack);if("object"==typeof n&&null!==n){if(t.has(n))return"[Circular ".concat(e||"root","]");t.add(n)}return n}};e.stringifyPlus=function(t){if("string"==typeof t)return t;try{return t instanceof Error?(JSON.stringify(t,n())||"undefined").replace(/"/gim,""):JSON.stringify(t,n())||"undefined"}catch(t){return"error happen when aegis stringify: \n ".concat(t.message," \n ").concat(t.stack)}},e.date2ISOString=function(){var t,e=new Date,n=e.toISOString(),r=e.getTimezoneOffset()/60;return t=r<0?r>-10?"+0".concat(Math.abs(100*r)):"+".concat(Math.abs(100*r)):r>=10?"-".concat(100*r):"-0".concat(100*r),n.replace("Z",t)}},383:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(266);e.default={stringify:function(t){return t?Object.keys(t).map((function(e){var n=t[e];if((0,r.isPlainObject)(n))n=JSON.stringify(n);else{if("string"!=typeof n&&"number"!=typeof n)return"";n=+n}return encodeURIComponent(e)+"="+encodeURIComponent(n)})).filter((function(t){return t.length>0})).join("&"):""}}},640:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.startBlocking=e.resolveFirstBlock=void 0;var n=[];e.startBlocking=function(){var t,e=new Promise((function(e){t=e}));return n.push({promise:e,resolve:t}),e},e.resolveFirstBlock=function(){n.length&&(n[0].resolve(),n.shift())}}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={exports:{}};return t[r].call(a.exports,a,a.exports,n),a.exports}var r={};return(()=>{var t=r;Object.defineProperty(t,"__esModule",{value:!0});var e=n(902),i=null;t.default=function(t){return i||(i=new e.default(t)),i}})(),r})())()),Ey=function(){return d((function t(e){c(this,t),this._emitter=e.emitter,this._logger=my()}),[{key:"onError",value:function(t){this._logger.error("TUICallEvent.onError",{text:{error:t},type:"event"}),this._emitter.emit(Kv.ERROR,t)}},{key:"onCallBegin",value:function(t){this._logger.info("TUICallEvent.onCallBegin",{text:{data:t},type:"event"}),this._emitter.emit(Kv.ON_CALL_BEGIN,t)}},{key:"onCallEnd",value:function(t){this._logger.info("TUICallEvent.onCallEnd",{text:{data:t},type:"event"}),this._emitter.emit(Kv.CALL_END,t)}},{key:"onInvited",value:function(t){this._logger.info("TUICallEvent.onInvited",{text:{data:t},type:"event"});var e=m({callerId:null==t?void 0:t.sponsor},t);this._emitter.emit(Kv.INVITED,t),this._emitter.emit(Kv.ON_CALL_RECEIVED,e)}},{key:"onLineBusy",value:function(t){this._logger.info("TUICallEvent.onLineBusy",{text:{data:t},type:"event"});var e=t.inviteID,n=t.invitee,r=t.userID;this._emitter.emit(Kv.LINE_BUSY,{inviteID:e,invitee:n,userID:r,reason:"line busy"})}},{key:"onReject",value:function(t){var e=t.inviteID,n=t.invitee,r=t.userID;this._emitter.emit(Kv.REJECT,{inviteID:e,invitee:n,userID:r,reason:"reject"})}},{key:"onNoResp",value:function(t){this._logger.info("TUICallEvent.onNoResp",{text:{data:t},type:"event"});var e=t.groupID,n=void 0===e?"":e,r=t.inviteID,i=t.sponsor,a=t.timeoutUserList,o=t.userIDList;this._emitter.emit(Kv.NO_RESP,{groupID:n,inviteID:r,sponsor:i,timeoutUserList:a,userIDList:o})}},{key:"onCancel",value:function(t){this._emitter.emit(Kv.CALLING_CANCEL,t),this._emitter.emit(Kv.ON_CALL_CANCELED,t)}},{key:"onTimeout",value:function(t){this._logger.info("TUICallEvent.onTimeout",{text:{data:t},type:"event"});var e=t.inviteID,n=t.groupID,r=t.sponsor,i=t.timeoutUserList;this._emitter.emit(Kv.CALLING_TIMEOUT,{groupID:n,inviteID:e,sponsor:r,timeoutUserList:i})}},{key:"onUserAccept",value:function(t){this._logger.info("TUICallEvent.onUserAccept",{text:{data:t},type:"event"});var e=t.userID,n=t.userList;this._emitter.emit(Kv.USER_ACCEPT,{userID:e,userList:n})}},{key:"onUserEnter",value:function(t){this._logger.info("TUICallEvent.onUserEnter",{text:{data:t},type:"event"});var e=t.userID,n=t.playerList;this._emitter.emit(Kv.USER_ENTER,{userID:e,playerList:n})}},{key:"onUserLeave",value:function(t){this._logger.info("TUICallEvent.onUserLeave",{text:{data:t},type:"event"});var e=t.userID,n=t.playerList;this._emitter.emit(Kv.USER_LEAVE,{userID:e,playerList:n})}},{key:"onUserUpdate",value:function(t){var e=t.pusher,n=t.playerList;this._emitter.emit(Kv.USER_UPDATE,{pusher:e,playerList:n})}},{key:"onUserNetworkQualityChanged",value:function(t){this._emitter.emit(Kv.ON_USER_NETWORK_QUALITY_CHANGED,{networkQualityList:t})}},{key:"onSdkReady",value:function(t){this._logger.info("TUICallEvent.onSdkReady",{text:{data:t},type:"event"}),this._emitter.emit(Kv.SDK_READY,t)}},{key:"onKickedOut",value:function(t){this._logger.info("TUICallEvent.onKickedOut",{text:{data:t},type:"event"}),this._emitter.emit(Kv.KICKED_OUT,t)}},{key:"onCallMode",value:function(t){this._logger.info("TUICallEvent.onCallMode",{text:{data:t},type:"event"}),this._emitter.emit(Kv.CALL_MODE,t)}},{key:"onMessageSentByMe",value:function(t){this._logger.info("TUICallEvent.onMessageSentByMe",{text:{data:t},type:"event"}),this._emitter.emit(Kv.MESSAGE_SENT_BY_ME,t)}},{key:"onCallMessage",value:function(t){var e;this._logger.info("TUICallEvent.onCallMessage",{text:{data:t},type:"event"}),this._emitter.emit(Kv.CALL_MESSAGE,null==t||null===(e=t.data)||void 0===e?void 0:e.message)}},{key:"destroyed",value:function(){this._logger.info("TUICallEvent.destroyed",{type:"api"}),this._emitter=null}}])}(),_y={},Ry=Oe;_y.f=Ry;var by=k,Ty=by,Cy=ve,Dy=_y,wy=nn.f,Sy=j,Oy=mt,xy=Oe,ky=Dr,Ay=Oi,Ly=k,Ny=j,Uy=Q,Py=N,My=Nt,jy=L,Vy=ve,Gy=Et,Hy=cn,Fy=dt,By=Ge,Ky=Fp,qy=q,Wy=mo,zy=Qa,Jy=wr,Yy=Sf,Qy=ei,$y=A,Xy=nn,Zy=za,tI=V,eI=Dr,nI=Cu,rI=ue,iI=Kn,aI=Ee,oI=Oe,sI=_y,cI=function(t){var e=Ty.Symbol||(Ty.Symbol={});Cy(e,t)||wy(e,t,{value:Dy.f(t)})},uI=function(){var t=Oy("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,r=xy("toPrimitive");e&&!e[r]&&ky(e,r,(function(t){return Sy(n,this)}),{arity:1})},lI=$s,hI=ir,dI=qa.forEach,fI=Bn("hidden"),pI="Symbol",vI="prototype",gI=hI.set,yI=hI.getterFor(pI),II=Object[vI],mI=Ly.Symbol,EI=mI&&mI[vI],_I=Ly.RangeError,RI=Ly.TypeError,bI=Ly.QObject,TI=$y.f,CI=Xy.f,DI=Yy.f,wI=tI.f,SI=Uy([].push),OI=rI("symbols"),xI=rI("op-symbols"),kI=rI("wks"),AI=!bI||!bI[vI]||!bI[vI].findChild,LI=function(t,e,n){var r=TI(II,e);r&&delete II[e],CI(t,e,n),r&&t!==II&&CI(II,e,r)},NI=Py&&jy((function(){return 7!==Wy(CI({},"a",{get:function(){return CI(this,"a",{value:7}).a}})).a}))?LI:CI,UI=function(t,e){var n=OI[t]=Wy(EI);return gI(n,{type:pI,tag:t,description:e}),Py||(n.description=e),n},PI=function(t,e,n){t===II&&PI(xI,e,n),Hy(t);var r=By(e);return Hy(n),Vy(OI,r)?(n.enumerable?(Vy(t,fI)&&t[fI][r]&&(t[fI][r]=!1),n=Wy(n,{enumerable:qy(0,!1)})):(Vy(t,fI)||CI(t,fI,qy(1,Wy(null))),t[fI][r]=!0),NI(t,r,n)):CI(t,r,n)},MI=function(t,e){Hy(t);var n=Fy(e),r=zy(n).concat(HI(n));return dI(r,(function(e){Py&&!Ny(jI,n,e)||PI(t,e,n[e])})),t},jI=function(t){var e=By(t),n=Ny(wI,this,e);return!(this===II&&Vy(OI,e)&&!Vy(xI,e))&&(!(n||!Vy(this,e)||!Vy(OI,e)||Vy(this,fI)&&this[fI][e])||n)},VI=function(t,e){var n=Fy(t),r=By(e);if(n!==II||!Vy(OI,r)||Vy(xI,r)){var i=TI(n,r);return!i||!Vy(OI,r)||Vy(n,fI)&&n[fI][r]||(i.enumerable=!0),i}},GI=function(t){var e=DI(Fy(t)),n=[];return dI(e,(function(t){Vy(OI,t)||Vy(iI,t)||SI(n,t)})),n},HI=function(t){var e=t===II,n=DI(e?xI:Fy(t)),r=[];return dI(n,(function(t){!Vy(OI,t)||e&&!Vy(II,t)||SI(r,OI[t])})),r};My||(eI(EI=(mI=function(){if(Gy(EI,this))throw new RI("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?Ky(arguments[0]):void 0,e=aI(t),n=function(t){var r=void 0===this?Ly:this;r===II&&Ny(n,xI,t),Vy(r,fI)&&Vy(r[fI],e)&&(r[fI][e]=!1);var i=qy(1,t);try{NI(r,e,i)}catch(t){if(!(t instanceof _I))throw t;LI(r,e,i)}};return Py&&AI&&NI(II,e,{configurable:!0,set:n}),UI(e,t)})[vI],"toString",(function(){return yI(this).tag})),eI(mI,"withoutSetter",(function(t){return UI(aI(t),t)})),tI.f=jI,Xy.f=PI,Zy.f=MI,$y.f=VI,Jy.f=Yy.f=GI,Qy.f=HI,sI.f=function(t){return UI(oI(t),t)},Py&&(nI(EI,"description",{configurable:!0,get:function(){return yI(this).description}}),eI(II,"propertyIsEnumerable",jI,{unsafe:!0}))),Ay({global:!0,constructor:!0,wrap:!0,forced:!My,sham:!My},{Symbol:mI}),dI(zy(kI),(function(t){cI(t)})),Ay({target:pI,stat:!0,forced:!My},{useSetter:function(){AI=!0},useSimple:function(){AI=!1}}),Ay({target:"Object",stat:!0,forced:!My,sham:!Py},{create:function(t,e){return void 0===e?Wy(t):MI(Wy(t),e)},defineProperty:PI,defineProperties:MI,getOwnPropertyDescriptor:VI}),Ay({target:"Object",stat:!0,forced:!My},{getOwnPropertyNames:GI}),uI(),lI(mI,pI),iI[fI]=!0;var FI=Nt&&!!Symbol.for&&!!Symbol.keyFor,BI=Oi,KI=mt,qI=ve,WI=Fp,zI=ue,JI=FI,YI=zI("string-to-symbol-registry"),QI=zI("symbol-to-string-registry");BI({target:"Symbol",stat:!0,forced:!JI},{for:function(t){var e=WI(t);if(qI(YI,e))return YI[e];var n=KI("Symbol")(e);return YI[e]=n,QI[n]=e,n}});var $I=Oi,XI=ve,ZI=Gt,tm=Ft,em=FI,nm=ue("symbol-to-string-registry");$I({target:"Symbol",stat:!0,forced:!em},{keyFor:function(t){if(!ZI(t))throw new TypeError(tm(t)+" is not a symbol");if(XI(nm,t))return nm[t]}});var rm=ki,im=pt,am=tt,om=Fp,sm=Q([].push),cm=Oi,um=mt,lm=Il,hm=j,dm=Q,fm=L,pm=pt,vm=Gt,gm=Qc,ym=function(t){if(im(t))return t;if(rm(t)){for(var e=t.length,n=[],r=0;r<e;r++){var i=t[r];"string"==typeof i?sm(n,i):"number"!=typeof i&&"Number"!==am(i)&&"String"!==am(i)||sm(n,om(i))}var a=n.length,o=!0;return function(t,e){if(o)return o=!1,e;if(rm(this))return e;for(var r=0;r<a;r++)if(n[r]===t)return e}}},Im=Nt,mm=String,Em=um("JSON","stringify"),_m=dm(/./.exec),Rm=dm("".charAt),bm=dm("".charCodeAt),Tm=dm("".replace),Cm=dm(1..toString),Dm=/[\uD800-\uDFFF]/g,wm=/^[\uD800-\uDBFF]$/,Sm=/^[\uDC00-\uDFFF]$/,Om=!Im||fm((function(){var t=um("Symbol")("stringify detection");return"[null]"!==Em([t])||"{}"!==Em({a:t})||"{}"!==Em(Object(t))})),xm=fm((function(){return'"\\udf06\\ud834"'!==Em("\udf06\ud834")||'"\\udead"'!==Em("\udead")})),km=function(t,e){var n=gm(arguments),r=ym(e);if(pm(r)||void 0!==t&&!vm(t))return n[1]=function(t,e){if(pm(r)&&(e=hm(r,this,mm(t),e)),!vm(e))return e},lm(Em,null,n)},Am=function(t,e,n){var r=Rm(n,e-1),i=Rm(n,e+1);return _m(wm,t)&&!_m(Sm,i)||_m(Sm,t)&&!_m(wm,r)?"\\u"+Cm(bm(t,0),16):t};Em&&cm({target:"JSON",stat:!0,arity:3,forced:Om||xm},{stringify:function(t,e,n){var r=gm(arguments),i=lm(Om?km:Em,null,r);return xm&&"string"==typeof i?Tm(i,Dm,Am):i}});var Lm=ei,Nm=de;Oi({target:"Object",stat:!0,forced:!Nt||L((function(){Lm.f(1)}))},{getOwnPropertySymbols:function(t){var e=Lm.f;return e?e(Nm(t)):[]}});var Um=Oi,Pm=N,Mm=Q,jm=ve,Vm=pt,Gm=Et,Hm=Fp,Fm=Cu,Bm=di,Km=k.Symbol,qm=Km&&Km.prototype;if(Pm&&Vm(Km)&&(!("description"in qm)||void 0!==Km().description)){var Wm={},zm=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:Hm(arguments[0]),e=Gm(qm,this)?new Km(t):void 0===t?Km():Km(t);return""===t&&(Wm[e]=!0),e};Bm(zm,Km),zm.prototype=qm,qm.constructor=zm;var Jm="Symbol(description detection)"===String(Km("description detection")),Ym=Mm(qm.valueOf),Qm=Mm(qm.toString),$m=/^Symbol\((.*)\)[^)]+$/,Xm=Mm("".replace),Zm=Mm("".slice);Fm(qm,"description",{configurable:!0,get:function(){var t=Ym(this);if(jm(Wm,t))return"";var e=Qm(t),n=Jm?Zm(e,7,-1):Xm(e,$m,"$1");return""===n?void 0:n}}),Um({global:!0,constructor:!0,forced:!0},{Symbol:zm})}var tE={UNKNOWN:65535,NO_NETWORK:2805,FAILURE_SWITCH_TO_AUDIO:60001,FAILURE_SWITCH_TO_VIDEO:60002,ERROR_PACKAGE_NOT_PURCHASED:-1001,ERROR_PACKAGE_NOT_SUPPORTED:-1002,ERROR_TIM_VERSION_OUTDATED:-1003,ERROR_PERMISSION_DENIED:-1101,ERROR_GET_DEVICE_LIST_FAIL:-1102,ERROR_INIT_FAIL:-1201,ERROR_PARAM_INVALID:-1202,ERROR_REQUEST_REFUSED:-1203,ERROR_REQUEST_REPEATED:-1204,ERROR_SCENE_NOT_SUPPORTED:-1205,INVALID_PARAMETER_REQUIRED:-120200,INVALID_PARAMETER_TYPE:-120201,INVALID_PARAMETER_EMPTY:-120202,INVALID_PARAMETER_RANGE:-120203,ERROR_SIGNALING_SEND_FAIL:-1401,ERROR_INVALID_INVITEID:8010,ERROR_INVALID_SEND_FAIL:8021,ERROR_BLACKLIST:20007};Oi({target:"Array",stat:!0},{isArray:ki});var eE=Oi,nE=at,rE=dt,iE=Ao,aE=Q([].join);eE({target:"Array",proto:!0,forced:nE!==Object||!iE("join",",")},{join:function(t){return aE(rE(this),void 0===t?",":t)}});var oE=cn,sE=function(){var t=oE(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},cE=j,uE=ve,lE=Et,hE=sE,dE=RegExp.prototype,fE=On.PROPER,pE=Dr,vE=cn,gE=Fp,yE=L,IE=function(t){var e=t.flags;return void 0!==e||"flags"in dE||uE(t,"flags")||!lE(dE,t)?e:cE(hE,t)},mE="toString",EE=RegExp.prototype,_E=EE[mE],RE=yE((function(){return"/a/b"!==_E.call({source:"a",flags:"b"})})),bE=fE&&_E.name!==mE;(RE||bE)&&pE(EE,mE,(function(){var t=vE(this);return"/"+gE(t.source)+"/"+gE(IE(t))}),{unsafe:!0});var TE=Oi,CE=qa.findIndex,DE=Co,wE="findIndex",SE=!0;wE in[]&&Array(1)[wE]((function(){SE=!1})),TE({target:"Array",proto:!0,forced:SE},{findIndex:function(t){return CE(this,t,arguments.length>1?arguments[1]:void 0)}}),DE(wE);var OE=Q(1..valueOf),xE="\t\n\v\f\r                　\u2028\u2029\ufeff",kE=ut,AE=Fp,LE=xE,NE=Q("".replace),UE=RegExp("^["+LE+"]+"),PE=RegExp("(^|[^"+LE+"])["+LE+"]+$"),ME=function(t){return function(e){var n=AE(kE(e));return 1&t&&(n=NE(n,UE,"")),2&t&&(n=NE(n,PE,"$1")),n}},jE={start:ME(1),end:ME(2),trim:ME(3)},VE=Oi,GE=N,HE=k,FE=by,BE=Q,KE=_i,qE=ve,WE=op,zE=Et,JE=Gt,YE=Me,QE=L,$E=wr.f,XE=A.f,ZE=nn.f,t_=OE,e_=jE.trim,n_="Number",r_=HE[n_];FE[n_];var i_=r_.prototype,a_=HE.TypeError,o_=BE("".slice),s_=BE("".charCodeAt),c_=function(t){var e,n,r,i,a,o,s,c,u=YE(t,"number");if(JE(u))throw new a_("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=e_(u),43===(e=s_(u,0))||45===e){if(88===(n=s_(u,2))||120===n)return NaN}else if(48===e){switch(s_(u,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+u}for(o=(a=o_(u,2)).length,s=0;s<o;s++)if((c=s_(a,s))<48||c>i)return NaN;return parseInt(a,r)}return+u},u_=KE(n_,!r_(" 0o1")||!r_("0b1")||r_("+0x1")),l_=function(t){var e,n=arguments.length<1?0:r_(function(t){var e=YE(t,"number");return"bigint"==typeof e?e:c_(e)}(t));return zE(i_,e=this)&&QE((function(){t_(e)}))?WE(Object(n),this,l_):n};l_.prototype=i_,u_&&(i_.constructor=l_),VE({global:!0,constructor:!0,wrap:!0,forced:u_},{Number:l_});u_&&function(t,e){for(var n,r=GE?$E(e):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),i=0;r.length>i;i++)qE(e,n=r[i])&&!qE(t,n)&&ZE(t,n,XE(e,n))}(FE[n_],r_);var h_=Il,d_=Wt,f_=cn;Oi({target:"Reflect",stat:!0,forced:!L((function(){Reflect.apply((function(){}))}))},{apply:function(t,e,n){return h_(d_(t),e,f_(n))}});var p_,v_,g_=L,y_=k.RegExp,I_=g_((function(){var t=y_("a","y");return t.lastIndex=2,null!==t.exec("abcd")})),m_=I_||g_((function(){return!y_("a","y").sticky})),E_={BROKEN_CARET:I_||g_((function(){var t=y_("^r","gy");return t.lastIndex=2,null!==t.exec("str")})),MISSED_STICKY:m_,UNSUPPORTED_Y:I_},__=L,R_=k.RegExp,b_=__((function(){var t=R_(".","s");return!(t.dotAll&&t.test("\n")&&"s"===t.flags)})),T_=L,C_=k.RegExp,D_=T_((function(){var t=C_("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),w_=j,S_=Q,O_=Fp,x_=sE,k_=E_,A_=mo,L_=ir.get,N_=b_,U_=D_,P_=ue("native-string-replace",String.prototype.replace),M_=RegExp.prototype.exec,j_=M_,V_=S_("".charAt),G_=S_("".indexOf),H_=S_("".replace),F_=S_("".slice),B_=(v_=/b*/g,w_(M_,p_=/a/,"a"),w_(M_,v_,"a"),0!==p_.lastIndex||0!==v_.lastIndex),K_=k_.BROKEN_CARET,q_=void 0!==/()??/.exec("")[1];(B_||q_||K_||N_||U_)&&(j_=function(t){var e,n,r,i,a,o,s,c=this,u=L_(c),l=O_(t),h=u.raw;if(h)return h.lastIndex=c.lastIndex,e=w_(j_,h,l),c.lastIndex=h.lastIndex,e;var d=u.groups,f=K_&&c.sticky,p=w_(x_,c),v=c.source,g=0,y=l;if(f&&(p=H_(p,"y",""),-1===G_(p,"g")&&(p+="g"),y=F_(l,c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==V_(l,c.lastIndex-1))&&(v="(?: "+v+")",y=" "+y,g++),n=new RegExp("^(?:"+v+")",p)),q_&&(n=new RegExp("^"+v+"$(?!\\s)",p)),B_&&(r=c.lastIndex),i=w_(M_,f?n:c,y),f?i?(i.input=F_(i.input,g),i[0]=F_(i[0],g),i.index=c.lastIndex,c.lastIndex+=i[0].length):c.lastIndex=0:B_&&i&&(c.lastIndex=c.global?i.index+i[0].length:r),q_&&i&&i.length>1&&w_(P_,i[0],n,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&d)for(i.groups=o=A_(null),a=0;a<d.length;a++)o[(s=d[a])[0]]=i[s[1]];return i});var W_=j_;Oi({target:"RegExp",proto:!0,forced:/./.exec!==W_},{exec:W_});var z_=j,J_=Dr,Y_=W_,Q_=L,$_=Oe,X_=Rn,Z_=$_("species"),tR=RegExp.prototype,eR=function(t,e,n,r){var i=$_(t),a=!Q_((function(){var e={};return e[i]=function(){return 7},7!==""[t](e)})),o=a&&!Q_((function(){var e=!1,n=/a/;return"split"===t&&((n={}).constructor={},n.constructor[Z_]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return e=!0,null},n[i](""),!e}));if(!a||!o||n){var s=/./[i],c=e(i,""[t],(function(t,e,n,r,i){var o=e.exec;return o===Y_||o===tR.exec?a&&!i?{done:!0,value:z_(s,e,n,r)}:{done:!0,value:z_(t,n,e,r)}:{done:!1}}));J_(String.prototype,t,c[0]),J_(tR,i,c[1])}r&&X_(tR[i],"sham",!0)},nR=$p.charAt,rR=function(t,e,n){return e+(n?nR(t,e).length:1)},iR=j,aR=cn,oR=pt,sR=tt,cR=W_,uR=TypeError,lR=function(t,e){var n=t.exec;if(oR(n)){var r=iR(n,t,e);return null!==r&&aR(r),r}if("RegExp"===sR(t))return iR(cR,t,e);throw new uR("RegExp#exec called on incompatible receiver")},hR=j,dR=cn,fR=ot,pR=jr,vR=Fp,gR=ut,yR=Yt,IR=rR,mR=lR;eR("match",(function(t,e,n){return[function(e){var n=gR(this),r=fR(e)?void 0:yR(e,t);return r?hR(r,e,n):new RegExp(e)[t](vR(n))},function(t){var r=dR(this),i=vR(t),a=n(e,r,i);if(a.done)return a.value;if(!r.global)return mR(r,i);var o=r.unicode;r.lastIndex=0;for(var s,c=[],u=0;null!==(s=mR(r,i));){var l=vR(s[0]);c[u]=l,""===l&&(r.lastIndex=IR(i,pR(r.lastIndex),o)),u++}return 0===u?null:c}]}));var ER=Q,_R=de,RR=Math.floor,bR=ER("".charAt),TR=ER("".replace),CR=ER("".slice),DR=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,wR=/\$([$&'`]|\d{1,2})/g,SR=Il,OR=j,xR=Q,kR=eR,AR=L,LR=cn,NR=pt,UR=ot,PR=kr,MR=jr,jR=Fp,VR=ut,GR=rR,HR=Yt,FR=function(t,e,n,r,i,a){var o=n+t.length,s=r.length,c=wR;return void 0!==i&&(i=_R(i),c=DR),TR(a,c,(function(a,c){var u;switch(bR(c,0)){case"$":return"$";case"&":return t;case"`":return CR(e,0,n);case"'":return CR(e,o);case"<":u=i[CR(c,1,-1)];break;default:var l=+c;if(0===l)return a;if(l>s){var h=RR(l/10);return 0===h?a:h<=s?void 0===r[h-1]?bR(c,1):r[h-1]+bR(c,1):a}u=r[l-1]}return void 0===u?"":u}))},BR=lR,KR=Oe("replace"),qR=Math.max,WR=Math.min,zR=xR([].concat),JR=xR([].push),YR=xR("".indexOf),QR=xR("".slice),$R="$0"==="a".replace(/./,"$0"),XR=!!/./[KR]&&""===/./[KR]("a","$0");kR("replace",(function(t,e,n){var r=XR?"$":"$0";return[function(t,n){var r=VR(this),i=UR(t)?void 0:HR(t,KR);return i?OR(i,t,r,n):OR(e,jR(r),t,n)},function(t,i){var a=LR(this),o=jR(t);if("string"==typeof i&&-1===YR(i,r)&&-1===YR(i,"$<")){var s=n(e,a,o,i);if(s.done)return s.value}var c=NR(i);c||(i=jR(i));var u,l=a.global;l&&(u=a.unicode,a.lastIndex=0);for(var h,d=[];null!==(h=BR(a,o))&&(JR(d,h),l);){""===jR(h[0])&&(a.lastIndex=GR(o,MR(a.lastIndex),u))}for(var f,p="",v=0,g=0;g<d.length;g++){for(var y,I=jR((h=d[g])[0]),m=qR(WR(PR(h.index),o.length),0),E=[],_=1;_<h.length;_++)JR(E,void 0===(f=h[_])?f:String(f));var R=h.groups;if(c){var b=zR([I],E,m,o);void 0!==R&&JR(b,R),y=jR(SR(i,void 0,b))}else y=FR(I,o,m,E,R,i);m>=v&&(p+=QR(o,v,m)+y,v=m+I.length)}return p+QR(o,v)}]}),!!AR((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!$R||XR);var ZR,tb=gt,eb=tt,nb=Oe("match"),rb=function(t){var e;return tb(t)&&(void 0!==(e=t[nb])?!!e:"RegExp"===eb(t))},ib=TypeError,ab=function(t){if(rb(t))throw new ib("The method doesn't accept regular expressions");return t},ob=Oe("match"),sb=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[ob]=!1,"/./"[t](e)}catch(t){}}return!1},cb=Oi,ub=La,lb=A.f,hb=jr,db=Fp,fb=ab,pb=ut,vb=sb,gb=ub("".slice),yb=Math.min,Ib=vb("startsWith");cb({target:"String",proto:!0,forced:!!(Ib||(ZR=lb(String.prototype,"startsWith"),!ZR||ZR.writable))&&!Ib},{startsWith:function(t){var e=db(pb(this));fb(t);var n=hb(yb(arguments.length>1?arguments[1]:void 0,e.length)),r=db(t);return gb(e,n,n+r.length)===r}});var mb=k,Eb=L,_b=Q,Rb=Fp,bb=jE.trim,Tb=xE,Cb=mb.parseInt,Db=mb.Symbol,wb=Db&&Db.iterator,Sb=/^[+-]?0x/i,Ob=_b(Sb.exec),xb=8!==Cb(Tb+"08")||22!==Cb(Tb+"0x16")||wb&&!Eb((function(){Cb(Object(wb))}))?function(t,e){var n=bb(Rb(t));return Cb(n,e>>>0||(Ob(Sb,n)?16:10))}:Cb;function kb(t,e){t=t.split("."),e=e.split(".");for(var n=Math.max(t.length,e.length);t.length<n;)t.push("0");for(;e.length<n;)e.push("0");for(var r=0;r<n;r++){var i=parseInt(t[r],10),a=parseInt(e[r],10);if(i>a)return 1;if(i<a)return-1}return 0}Oi({global:!0,forced:parseInt!==xb},{parseInt:xb});var Ab="TRTC-ROOM",Lb=wx||qq;Lb||console.error(Ab,"不支持当前小程序环境");var Nb,Ub=Lb.getSystemInfoSync(),Pb=Ub.safeArea;("iOS 13.3"===Ub.system||"iPhoneX"===Ub.model&&"iOS 13.3.1"===Ub.system)&&console.log("use media audio volume type"),console.log(Ab,"SystemInfo",Ub),"undefined"!=typeof qq?Nb=!0:"undefined"!=typeof wx&&(Nb=kb(Ub.version,"7.0.8")>=0||kb(Ub.version,"2.4.0")>=0&&kb(Ub.version,"6.0.0")<0&&kb(Ub.SDKVersion,"2.10.0")>=0);var Mb=Nb;/iOS/i.test(Ub.system),/Android/i.test(Ub.system),/mac/i.test(Ub.system);var jb=Ub.version,Vb=Ub.SDKBuild?"".concat(Ub.SDKVersion,"-").concat(Ub.SDKBuild):Ub.SDKVersion;Ub.screenHeight,Pb.bottom,console.log(Ab,"APP_VERSION:",jb," LIB_VERSION:",Vb," is new version:",Mb);var Gb=N,Hb=ki,Fb=TypeError,Bb=Object.getOwnPropertyDescriptor,Kb=Gb&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(Hb(t)&&!Bb(t,"length").writable)throw new Fb("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},qb=Ft,Wb=TypeError,zb=Oi,Jb=de,Yb=Ur,Qb=kr,$b=Gr,Xb=Kb,Zb=Li,tT=da,eT=Mi,nT=function(t,e){if(!delete t[e])throw new Wb("Cannot delete property "+qb(e)+" of "+qb(t))},rT=ga("splice"),iT=Math.max,aT=Math.min;zb({target:"Array",proto:!0,forced:!rT},{splice:function(t,e){var n,r,i,a,o,s,c=Jb(this),u=$b(c),l=Yb(t,u),h=arguments.length;for(0===h?n=r=0:1===h?(n=0,r=u-l):(n=h-2,r=aT(iT(Qb(e),0),u-l)),Zb(u+n-r),i=tT(c,r),a=0;a<r;a++)(o=l+a)in c&&eT(i,a,c[o]);if(i.length=r,n<r){for(a=l;a<u-r;a++)s=a+n,(o=a+r)in c?c[s]=c[o]:nT(c,s);for(a=u;a>u-r+n;a--)nT(c,a-1)}else if(n>r)for(a=u-r;a>l;a--)s=a+n-1,(o=a+r-1)in c?c[s]=c[o]:nT(c,s);for(a=0;a<n;a++)c[a+l]=arguments[a+2];return Xb(c,u-r+n),i}}),Rp("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),Vp);var oT,sT,cT=Gf;Oi({target:"Object",stat:!0,forced:Object.isExtensible!==cT},{isExtensible:cT}),oT="undefined"!=typeof console?console:"undefined"!=typeof global&&global.console?global.console:"undefined"!=typeof window&&window.console?window.console:{};for(var uT=function(){},lT=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],hT=lT.length-1;hT;)sT=lT[hT],console[sT]||(oT[sT]=uT),hT-=1;Object.isExtensible(oT)&&(oT.methods=lT);var dT=oT,fT=0,pT=new Map,vT="CallEngine";function gT(){var t=new Date;return"[".concat(t.toLocaleTimeString("en-US",{hour12:!1}),".").concat(function(t){var e;switch(t.toString().length){case 1:e="00".concat(t);break;case 2:e="0".concat(t);break;default:e=t}return e}(t.getMilliseconds()),"]")}var yT={_data:[],_length:0,_visible:!1,arguments2String:function(t,e){var n;if(1===e.length)n="【".concat(vT,"】").concat(gT()," <").concat(t,"> ").concat(e[0]);else{n="【".concat(vT,"】").concat(gT()," <").concat(t,"> ");for(var r=0,i=e.length;r<i;r++)TT(e[r])?ST(e[r])?n+=OT(e[r]):n+=JSON.stringify(e[r]):n+=e[r],n+=" "}return n},debug:function(){if(fT<=-1){var t=this.arguments2String("DEBUG",arguments);yT.record(t,"debug"),dT.debug(t)}},log:function(){if(fT<=0){var t=this.arguments2String("LOG",arguments);yT.record(t,"log"),dT.log(t)}},info:function(){if(fT<=1){var t=this.arguments2String("INFO",arguments);yT.record(t,"info"),dT.info(t)}},warn:function(){if(fT<=2){var t=this.arguments2String("WARN",arguments);yT.record(t,"warn"),dT.warn(t)}},error:function(){if(fT<=3){var t=this.arguments2String("ERROR",arguments);yT.record(t,"error"),dT.error(t)}},time:function(t){pT.set(t,wT.now())},timeEnd:function(t){if(pT.has(t)){var e=wT.now()-pT.get(t);return pT.delete(t),e}return dT.warn("未找到对应label: ".concat(t,", 请在调用 logger.timeEnd 前，调用 logger.time")),0},setLevel:function(t){t<4&&dT.log("".concat(gT(),"set level from ").concat(fT," to ").concat(t)),fT=t},getLevel:function(){return fT},record:function(t,e){1100===yT._length&&(yT._data.splice(0,100),yT._length=1e3),yT._length+=1,yT._data.push("".concat(t," [").concat(e,"] \n"))},getLog:function(){return yT._data}},IT=function(t){return Object.prototype.toString.call(t).match(/^\[object (.*)\]$/)[1].toLowerCase()},mT=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"array"===IT(t)},ET=function(t){return null!==t&&("number"==typeof t&&!isNaN(t-0)||"object"===C(t)&&t.constructor===Number)},_T=function(t){return"string"==typeof t},RT=function(t){return null!==t&&"object"===C(t)},bT=function(t){return void 0===t},TT=function(t){return mT(t)||RT(t)},CT=function(t){return C(t)===dg},DT=0;Date.now||(Date.now=function(){return(new Date).getTime()});var wT={now:function(){0===DT&&(DT=Date.now()-1);var t=Date.now()-DT;return t>4294967295?(DT+=4294967295,Date.now()-DT):t},utc:function(){return Math.round(Date.now()/1e3)}},ST=function(t){return t instanceof Error},OT=function(t){return JSON.stringify(t,["message","code"])};function xT(t){return kT.apply(this,arguments)}function kT(){return kT=o(_().mark((function t(e){var n,r,i,a,s,c,u;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",!1);case 2:return n=e.microphone,r=void 0!==n&&n,i=e.camera,a=void 0!==i&&i,t.prev=3,t.next=6,new Promise(function(){var t=o(_().mark((function t(e,n){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:wx.getSetting({success:function(t){var n=null;n=wx.$TUICallKitPlugin?t.miniprogramAuthSetting:t.authSetting,e(n)},fail:function(t){n(t)}});case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}());case 6:if(t.t0=t.sent,t.t0){t.next=9;break}t.t0=!1;case 9:if(s=t.t0,c=s[ly],u=s[hy],!r||!a){t.next=14;break}return t.abrupt("return",c&&u);case 14:if(!r){t.next=16;break}return t.abrupt("return",c);case 16:if(!a){t.next=18;break}return t.abrupt("return",u);case 18:return t.abrupt("return",!1);case 21:return t.prev=21,t.t1=t.catch(3),t.abrupt("return",!1);case 24:case"end":return t.stop()}}),t,null,[[3,21]])}))),kT.apply(this,arguments)}function AT(t){if(!t)return!1;var e=t.microphone,n=void 0!==e&&e,r=t.camera,i=void 0!==r&&r,a=wx.getAppAuthorizeSetting(),o=a[fy]===cy,s=a[dy]===cy;return n&&i?o&&s:n?o:!!i&&s}function LT(t){return t===Cg}function NT(){return performance&&performance.now?Math.floor(performance.now()):Date.now()}function UT(t){var e=String(t);return e.startsWith("14")||e.startsWith("16")||e.startsWith("17")}function PT(t){var e=UT(t)?"https://buy.cloud.tencent.com/avc?addRavLicense=1":"https://buy.tencentcloud.com/avc?addRavLicense=1";return"".concat(e,"&position=").concat(t,"&regionId=").concat(function(t){return t>=2e7&&t<3e7||t>=172e7&&t<173e7?9:t>=3e7&&t<4e7||t>=173e7&&t<174e7?18:t>=4e7&&t<5e7||t>=174e7&&t<175e7?17:t>=5e7&&t<6e7||t>=175e7&&t<176e7?21:t>=7e7&&t<8e7||t>=177e7&&t<178e7?15:1}(t))}function MT(t){return Reflect.apply(Object.prototype.toString,t,[]).replace(/^\[object\s(\w+)\]$/,"$1").toLowerCase()}function jT(t,e){return ET(t)&&t>0?t:0===t&&e?e:Math.floor(2147483646*Math.random()+1)}function VT(t,e,n){if(0===Object.keys(e).length)return t;var r=t.findIndex((function(t){return t[n]===e[n]}));return-1!==r?t[r]=e:t.push(e),t}function GT(t){return HT.apply(this,arguments)}function HT(){return HT=o(_().mark((function t(e){var n;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(e.map(function(){var t=o(_().mark((function t(e){var n;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e;case 3:return n=t.sent,t.abrupt("return",{status:"fulfilled",value:n});case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",{status:"rejected",reason:t.t0});case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}()));case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)}))),HT.apply(this,arguments)}function FT(t){if("string"!=typeof t)return t;var e;try{var n=JSON.parse(t);e="object"===C(n)&&n?n:t}catch(n){e=t}return e}function BT(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n="",r=0;r<t;r++)n+=e.charAt(Math.floor(48*Math.random()));return n}var KT={NO_NETWORK:"未连接到网络",FAILURE_SWITCH_TO_AUDIO:"switch to audio call error",FAILURE_SWITCH_TO_VIDEO:"switch to video call error",ERROR_NULL:"success",ERROR_PACKAGE_NOT_PURCHASED:"You do not have TUICallKit package, please open the free experience in the console: https://console.intl.cloud.tencent.com/im/detail or purchase the official package: ${purchaseAddress}",ERROR_PACKAGE_NOT_SUPPORTED:"The package you purchased does not support this ability. You can refer to here to purchase: ${purchaseAddress}",ERROR_TIM_VERSION_OUTDATED:"TIM SDK version is too old. Please upgrade version",ERROR_PERMISSION_DENIED:"camera / microphone permission refused. Please go to: https://cloud.tencent.com/document/product/647/78770",ERROR_GET_DEVICE_LIST_FAIL:"Failed to get device list",ERROR_INIT_FAIL:"init is not complete, this API needs to be used after init. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/78769#3a61f42b-e06f-49af-88bf-362d40025887",ERROR_REQUEST_REFUSED:"The API is not support use in the current state. Please go to: https://cloud.tencent.com/document/product/647/78769#5e65043d-e3dc-4bd3-8220-3ac7694dfa42",ERROR_REQUEST_REPEATED:"The current method is being executed, please do not call it repeatedly",ERROR_REQUEST_REPEATED_SWITCH:"Consistent with the current call type, please do not switch repeatedly",ERROR_SCENE_NOT_SUPPORTED:"In the current call scene, this function is not supported",ERROR_SIGNALING_SEND_FAIL:"signaling failed to send",ERROR_INVALID_INVITEID:"Failed to send message, common reasons: the called userID or groupID does not exist. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/84363#e97ea97b-7812-42ed-89b7-2a3840ac0e3f",ERROR_INVALID_SEND_FAIL:"Invalid sender or receiver identifier! To solve the problem, please go to: https://cloud.tencent.com/document/product/647/84363#661be1b0-f649-4199-a343-958c3f4f4bbb",ERROR_PARAM_INVALID:"invalid parameter"},qT={NO_NETWORK:"未连接到网络",FAILURE_SWITCH_TO_AUDIO:"切换语音通话失败",FAILURE_SWITCH_TO_VIDEO:"切换视频通话失败",ERROR_NULL:"成功",ERROR_PACKAGE_NOT_PURCHASED:"您的应用还未开通音视频通话（TUICallKit）能力，您可以去控制台申请免费体验: https://console.cloud.tencent.com/im/detail 或购买通话能力套餐包: ${purchaseAddress}",ERROR_PACKAGE_NOT_SUPPORTED:"您暂不支持使用该能力，请前往如下购买页购买开通: ${purchaseAddress}",ERROR_TIM_VERSION_OUTDATED:"TIM SDK 版本太旧，请升级版本",ERROR_PERMISSION_DENIED:"摄像头/麦克风权限被拒绝。解决方案请前往: https://cloud.tencent.com/document/product/647/78770",ERROR_GET_DEVICE_LIST_FAIL:"获取设备列表失败",ERROR_INIT_FAIL:"TUICallEngine init 未完成，需要在 init 完成后使用此 API。解决方案请前往: https://cloud.tencent.com/document/product/647/78769#3a61f42b-e06f-49af-88bf-362d40025887",ERROR_REQUEST_REFUSED:"当前通话状态无法使用该API。解决方案请前往: https://cloud.tencent.com/document/product/647/78769#5e65043d-e3dc-4bd3-8220-3ac7694dfa42",ERROR_REQUEST_REPEATED:"当前方法正在执行中，请勿重复调用",ERROR_REQUEST_REPEATED_SWITCH:"与当前通话类型一致，请勿重复切换",ERROR_SCENE_NOT_SUPPORTED:"当前通话场景不支持该功能",ERROR_SIGNALING_SEND_FAIL:"信令发送失败",ERROR_INVALID_INVITEID:"inviteID 无效或邀请已处理。解决方案请前往: https://cloud.tencent.com/document/product/647/84363#e97ea97b-7812-42ed-89b7-2a3840ac0e3f",ERROR_INVALID_SEND_FAIL:"消息发送失败，常见原因：被叫用户 userID 或群 groupID 不存在。解决方案请前往: https://cloud.tencent.com/document/product/647/84363#661be1b0-f649-4199-a343-958c3f4f4bbb",ERROR_PARAM_INVALID:"参数错误"};function WT(t){var e,n,r,i,a=t.code,o=t.params,s=t.enableDocLink,c=void 0!==s&&s,u=t.languageList,l=void 0===u?["en","zh-CN"]:u,h="",d=(n=tE,r=a,i="",Object.keys(n).forEach((function(t){n[t]===r&&(i=t)})),i);try{l.forEach((function(t){switch(t){case"en":e=zT[d];break;case"zh-CN":e=JT[d]}CT(e)?(h=h?"".concat(h," "):h,h+=e(o)):_T(e)&&(h=e)}))}catch(t){e=zT.UNKNOWN_ERROR}return c&&(h+=" doc:"),h}var zT={ERROR_INIT_FAIL:function(t){var e=t.fnName;return"".concat(e,": ").concat(KT.ERROR_INIT_FAIL,".")},ERROR_SCENE_NOT_SUPPORTED:function(t){var e=t.fnName;return"".concat(e,": ").concat(KT.ERROR_SCENE_NOT_SUPPORTED,".")},ERROR_REQUEST_REFUSED:function(t){var e=t.value;return"".concat(KT.ERROR_REQUEST_REFUSED,". customStatus: ").concat(e,".")},ERROR_PARAM_INVALID:function(t){var e=t.fnName;return"the parameters of the '".concat(e,"' you called does not meet the requirements, please check the API documentation.")},INVALID_PARAMETER_REQUIRED:function(t){var e=t.key,n=t.rule,r=t.fnName,i=t.value;return"'".concat(e||n.name,"' is a required param when calling ").concat(r,"(), received: ").concat(i,".")},INVALID_PARAMETER_TYPE:function(t){var e=t.key,n=t.rule,r=t.fnName,i=t.value,a="".concat(e||n.name),o="";return o=Array.isArray(n.type)?n.type.join("|"):n.type,"'".concat(a,"' must be type of ").concat(o," when calling ").concat(r,"(), received type: ").concat(MT(i),".")},INVALID_PARAMETER_EMPTY:function(t){var e=t.key,n=t.rule,r=t.fnName;return"'".concat(e||n.name,"' cannot be empty when calling ").concat(r,"().")},INVALID_PARAMETER_RANGE:function(t){var e=t.key,n=t.rule,r=t.fnName,i=t.value;return mT(n.values)?"'".concat(e||n.name,"' must be one of ").concat(n.values.join("|")," when calling ").concat(r,"(), received: ").concat(i,"."):_T(n.values)&&-1!==n.values.indexOf("~")?"'".concat(e||n.name,"' must be the range of ").concat(n.values," when calling ").concat(r,"(), received: ").concat(i,"."):void 0},ERROR_REQUEST_REPEATED:function(t){var e=t.fnName;return"you are already ".concat(e,"(), cannot repeated call '").concat(e,"'.")},ERROR_HTTP:function(){return"".concat(KT.ERROR_HTTP,".")},ERROR_TIM_VERSION_OUTDATED:function(){return"".concat(KT.ERROR_TIM_VERSION_OUTDATED," >= 2.21.2.")},ERROR_PACKAGE_NOT_SUPPORTED:function(){return"".concat(KT.ERROR_PACKAGE_NOT_SUPPORTED,".")},FAILURE_SWITCH_TO_AUDIO:function(){return"".concat(KT.FAILURE_SWITCH_TO_AUDIO,".")},ERROR_INVALID_SEND_FAIL:function(){return"".concat(KT.ERROR_INVALID_SEND_FAIL,".")},UNKNOWN_ERROR:function(t){var e=t.fnName,n=t.error;return"'".concat(e,"' throw unknown exception").concat(n?", error: ".concat(n.toString(),"."):".")}},JT={ERROR_INIT_FAIL:function(t){var e=t.fnName;return"".concat(e,": ").concat(qT.ERROR_INIT_FAIL,"。")},ERROR_SCENE_NOT_SUPPORTED:function(t){var e=t.fnName;return"".concat(e,": ").concat(qT.ERROR_SCENE_NOT_SUPPORTED,"。")},ERROR_REQUEST_REFUSED:function(t){var e=t.value;return"".concat(qT.ERROR_REQUEST_REFUSED,". customStatus: ").concat(e,"。")},ERROR_PARAM_INVALID:function(t){var e=t.fnName;return"the parameters of the '".concat(e,"' you called does not meet the requirements, please check the API documentation.")},INVALID_PARAMETER_REQUIRED:function(t){var e=t.key,n=t.rule,r=t.fnName,i=t.value;return"调用 ".concat(r,"() 方法的时候 '").concat(e||n.name,"' 是必须的参数, 收到的值为: ").concat(i,"。")},INVALID_PARAMETER_TYPE:function(t){var e=t.key,n=t.rule,r=t.fnName,i=t.value,a="".concat(e||n.name),o="";return o=Array.isArray(n.type)?n.type.join("|"):n.type,"调用 ".concat(r,"() 方法的时候 '").concat(a,"' 必须是 ").concat(o," 类型, 收到的类型是: ").concat(MT(i),"。")},INVALID_PARAMETER_EMPTY:function(t){var e=t.key,n=t.rule,r=t.fnName;return t.value,"调用 ".concat(r,"() 的时候 '").concat(e||n.name,"' 不能是空。")},INVALID_PARAMETER_RANGE:function(t){var e=t.key,n=t.rule,r=t.fnName,i=t.value;return mT(n.values)?"调用 ".concat(r,"() 的时候 '").concat(e||n.name,"' 必须是 ").concat(n.values.join("|")," 的其中一种, 收到的是: ").concat(i,"。"):_T(n.values)&&-1!==n.values.indexOf("~")?"调用 ".concat(r,"() 的时候 '").concat(e||n.name,"' 范围是 ").concat(n.values,", 收到的是: ").concat(i,"。"):void 0},ERROR_REQUEST_REPEATED:function(t){var e=t.fnName;return"你已经调用 ".concat(e,"(), 请勿重复调用 '").concat(e,"'。")},ERROR_HTTP:function(){return"".concat(qT.ERROR_HTTP,"。")},ERROR_TIM_VERSION_OUTDATED:function(){return"".concat(qT.ERROR_TIM_VERSION_OUTDATED," >= 2.21.2。")},ERROR_PACKAGE_NOT_SUPPORTED:function(){return"".concat(qT.ERROR_PACKAGE_NOT_SUPPORTED,"。")},FAILURE_SWITCH_TO_AUDIO:function(){return"".concat(qT.FAILURE_SWITCH_TO_AUDIO,"。")},ERROR_INVALID_SEND_FAIL:function(){return"".concat(qT.ERROR_INVALID_SEND_FAIL,".")}},YT=function(){function t(e){var n,r=e.name,i=void 0===r?"":r,a=e.code,o=void 0===a?tE.UNKNOWN:a,u=e.message,l=void 0===u?"":u,h=e.messageParams,d=void 0===h?{}:h;e.extraCode;var f=e.fnName,p=void 0===f?"":f;return c(this,t),(n=s(this,t,[l||WT({code:o,params:m({fnName:p},d)})])).name=i||n.name,n.code=o,n.functionName=p||n.functionName,n}return g(t,w(Error)),d(t,[{key:"getCode",value:function(){return this.code}}])}(),QT=["inviteID","type"],$T=function(){return d((function t(e){c(this,t),p(this,"_tuiCallEngine",null),this._tuiCallEngine=e.tuiCallEngine,this._chat=e.chat,this._logger=my()}),[{key:"handleNewSignaling",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._logger.info("TSignaling.handleNewSignaling.start",{text:{data:{data:t,params:e,userData:n}},type:"api"});var r=m(m({userData:n||""},t),{},{version:4,businessID:"av_call",platform:"MiniApp",data:m({cmd:ig[t.call_type],room_id:t.room_id,str_room_id:t.str_room_id,inviter:this._tuiCallEngine.getInviterID(),message:""},e)});return void 0!==this._tuiCallEngine.getExcludeFromHistoryMessage()&&(this._tuiCallEngine.getExcludeFromHistoryMessage()?r.data.excludeFromHistoryMessage=!0:delete r.data.excludeFromHistoryMessage),delete r.str_room_id,r}},{key:"extractCallingInfoFromMessage",value:function(t){if(!t||"TIMCustomElem"!==t.type)return"";var e=JSON.parse(t.payload.data);if(e.businessID!==$v)return"";switch(e.actionType){case Wv:var n=JSON.parse(e.data);return n.call_end>0&&!e.groupID?n.call_end:0!==n.call_end&&n.room_id?"发起通话":"结束群聊";case zv:return"取消通话";case Jv:return"已接听";case Yv:return"拒绝通话";case Qv:return"无应答";default:return""}}},{key:"handleError",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.code,n=void 0===e?"":e,r=t.message;if(n)throw new YT({message:void 0===r?"":r,code:n})}},{key:"_handleInviteData",value:function(t){var e=t.type,n=t.roomID,r=t.strRoomId,i=t.userIDList,a=t.hangup,o=t.switchMode,s=t.userData;if(a)return JSON.stringify(this.handleNewSignaling({version:0,call_type:e,call_end:a.callEnd},{cmd:"hangup"}));if(o){var c={version:0,call_type:e,room_id:n},u={cmd:"switchToVideo"};return o===ag&&(c.switch_to_audio_call="switch_to_audio_call",u.cmd="switchToAudio"),JSON.stringify(this.handleNewSignaling(c,u))}var l=this.handleNewSignaling({version:0,call_type:e,room_id:n,str_room_id:r},{userIDs:i,excludeFromHistoryMessage:!0},s);return this._tuiCallEngine.setInitialInviteData(l),JSON.stringify(l)}},{key:"_handleInviteGroupData",value:function(t){var e=t.type,n=t.roomID,r=t.strRoomId,i=t.hangup,a=t.userData;return i?JSON.stringify(this.handleNewSignaling({version:0,call_type:e,call_end:i.call_end},{cmd:"hangup"},a)):JSON.stringify(this.handleNewSignaling({version:0,call_type:e,room_id:n,str_room_id:r},{},a))}},{key:"invite",value:(s=o(_().mark((function t(e){var n,r,i,a;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("TSignaling.invite.start",{text:{data:{params:e}},type:"api"}),n=e.userID,r=e.offlinePushInfo,i=e.timeout,a=e.switchMode,t.prev=2,t.next=5,this._chat.invite({userID:n,data:this._handleInviteData(e),timeout:i,offlinePushInfo:this._convertOfflinePushParams(r)});case 5:return t.abrupt("return",t.sent);case 8:if(t.prev=8,t.t0=t.catch(2),this._logger.error("TSignaling.invite.fail",{text:{data:{params:e},error:t.t0},type:"api"}),!a){t.next=13;break}return t.abrupt("return",this.handleError(t.t0,a));case 13:return t.abrupt("return",this.handleError(t.t0,"invite"));case 14:case"end":return t.stop()}}),t,this,[[2,8]])}))),function(t){return s.apply(this,arguments)})},{key:"inviteGroup",value:(a=o(_().mark((function t(e){var n,r,i,a,o,s;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("TSignaling.inviteGroup.start",{text:{data:{params:e}},type:"api"}),n=e.groupID,r=e.userIDList,i=e.offlinePushInfo,a=e.timeout,o=e.inCallUserIDs,s=void 0===o?[]:o,t.prev=2,t.next=5,this._chat.inviteInGroup({groupID:n,inviteeList:r,timeout:a,data:this._handleInviteGroupData(e),offlinePushInfo:this._convertOfflinePushParams(i),inCallUserIDs:s});case 5:return t.abrupt("return",t.sent);case 8:return t.prev=8,t.t0=t.catch(2),this._logger.error("TSignaling.inviteGroup.fail",{text:{data:{params:e},error:t.t0},type:"api"}),t.abrupt("return",this.handleError(t.t0,"inviteGroup"));case 12:case"end":return t.stop()}}),t,this,[[2,8]])}))),function(t){return a.apply(this,arguments)})},{key:"accept",value:(i=o(_().mark((function t(e,n){var r,i,a;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("TSignaling.accept.start",{text:{data:{params:e,supportParams:n}},type:"api"}),r=e.inviteID,i=e.type,a=E(e,QT),t.prev=2,t.next=5,this._chat.accept({inviteID:r,data:JSON.stringify(this.handleNewSignaling(m({version:0,call_type:i},a),m(m({},n),{},{excludeFromHistoryMessage:!0})))});case 5:return t.abrupt("return",t.sent);case 8:return t.prev=8,t.t0=t.catch(2),this._logger.error("TSignaling.accept.fail",{text:{error:t.t0},type:"api"}),t.abrupt("return",this.handleError(t.t0,"accept"));case 12:case"end":return t.stop()}}),t,this,[[2,8]])}))),function(t,e){return i.apply(this,arguments)})},{key:"reject",value:(r=o(_().mark((function t(e){var n,r,i,a,o;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("TSignaling.reject.start",{text:{data:{params:e}},type:"api"}),n=e.inviteID,r=e.type,i=e.lineBusy,a={version:0,call_type:r},o=null,i?(a.line_busy=i,o=JSON.stringify(this.handleNewSignaling(a,{message:"lineBusy"}))):o=JSON.stringify(this.handleNewSignaling(a)),t.prev=5,t.next=8,this._tuiCallEngine.modifyInvitation(n);case 8:return t.next=10,this._chat.reject({inviteID:n,data:o});case 10:return t.abrupt("return",t.sent);case 13:if(t.prev=13,t.t0=t.catch(5),this._logger.error("TSignaling.reject.fail",{text:{error:t.t0},type:"api"}),!i){t.next=18;break}return t.abrupt("return",this.handleError(t.t0,"line_busy"));case 18:return t.abrupt("return",this.handleError(t.t0,"reject"));case 19:case"end":return t.stop()}}),t,this,[[5,13]])}))),function(t){return r.apply(this,arguments)})},{key:"cancel",value:(n=o(_().mark((function t(e){var n,r,i;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("TSignaling.cancel.start",{text:{data:{params:e}},type:"api"}),n=e.inviteID,r=e.callType,t.prev=2,t.next=5,this._chat.cancel({inviteID:n,data:JSON.stringify(this.handleNewSignaling({version:0,call_type:r}))});case 5:return i=t.sent,t.abrupt("return",i);case 9:return t.prev=9,t.t0=t.catch(2),this._logger.error("TSignaling.cancel.fail",{text:{error:t.t0},type:"api"}),t.abrupt("return",this.handleError(t.t0,"cancel"));case 13:case"end":return t.stop()}}),t,this,[[2,9]])}))),function(t){return n.apply(this,arguments)})},{key:"hangup",value:(e=o(_().mark((function t(e){var n,r,i,a,o,s,c,u,l,h,d,f;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("TSignaling.hangup.start",{text:{data:{params:e}},type:"api"}),n=e.userIDList,r=e.callType,i=e.callEnd,a=void 0===i?0:i,o=e.isGroupCall,s=void 0!==o&&o,c=e.groupID,u=void 0===c?"":c,l={version:0,call_type:r,call_end:a},h={cmd:"hangup"},d=JSON.stringify(this.handleNewSignaling(l,h)),f={},!s||!u){t.next=12;break}return t.next=9,this._chat.inviteInGroup({inviteeList:n,groupID:u,data:d,timeout:0});case 9:f=t.sent,t.next=15;break;case 12:return t.next=14,this._chat.invite({userID:n[0],data:d,timeout:0});case 14:f=t.sent;case 15:return this._tuiCallEngine.TRTCCallingDelegate.onCallMessage(f),t.abrupt("return",f);case 17:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"switchCallMode",value:(t=o(_().mark((function t(e){var n,r,i,a;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("TSignaling.switchCallMode.start",{text:{data:{params:e}},type:"api"}),n=e.userID,r=e.callType,i=e.roomID,a=e.mode,t.abrupt("return",this.invite({userID:n,type:r,roomID:i,switchMode:a}));case 3:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"destroyed",value:function(){this._logger.info("TSignaling.destroyed.start",{type:"api"}),this._chat=null}},{key:"setLogLevel",value:function(t){this._chat.setLogLevel(t)}},{key:"_convertOfflinePushParams",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(0===Object.keys(t).length)return{};var e=t.title,n=t.description,r=t.androidOPPOChannelID,i=t.extension,a=t.isDisablePush,o=t.iOSPushType,s=void 0===o?0:o,c=t.ignoreIOSBadge,u=t.iOSSound,l=t.androidSound,h=t.androidVIVOClassification;return{title:e||"",description:n||"",extension:i||"",disablePush:a||!1,androidInfo:{sound:l,XiaoMiChannelID:t.androidXiaoMiChannelID,OPPOChannelID:r,FCMChannelID:t.androidFCMChannelID,VIVOClassification:h,HuaWeiCategory:t.androidHuaWeiCategory},apnsInfo:{sound:u,ignoreIOSBadge:c||!1,disableVoipPush:1!==s}}}}]);var t,e,n,r,i,a,s}(),XT=function(){return d((function t(){c(this,t)}),[{key:"on",value:function(t,e,n){"function"==typeof e?(this._stores=this._stores||{},(this._stores[t]=this._stores[t]||[]).push({cb:e,ctx:n})):console.error("listener must be a function")}},{key:"emit",value:function(t){this._stores=this._stores||{};var e,n=this._stores[t];if(n){n=n.slice(0),(e=[].slice.call(arguments,1))[0]={eventCode:t,data:e[0]};for(var r=0,i=n.length;r<i;r++)n[r].cb.apply(n[r].ctx,e)}}},{key:"off",value:function(t,e){if(this._stores=this._stores||{},arguments.length){var n=this._stores[t];if(n)if(1!==arguments.length){for(var r=0,i=n.length;r<i;r++)if(n[r].cb===e){n.splice(r,1);break}}else delete this._stores[t]}else this._stores={}}}])}();var ZT=qr.includes,tC=Co;Oi({target:"Array",proto:!0,forced:L((function(){return!Array(1).includes()}))},{includes:function(t){return ZT(this,t,arguments.length>1?arguments[1]:void 0)}}),tC("includes");var eC=Oi,nC=ab,rC=ut,iC=Fp,aC=sb,oC=Q("".indexOf);eC({target:"String",proto:!0,forced:!aC("includes")},{includes:function(t){return!!~oC(iC(rC(this)),iC(nC(t)),arguments.length>1?arguments[1]:void 0)}});var sC=Q,cC=Tp,uC=wf.exports.getWeakData,lC=ol,hC=cn,dC=ot,fC=gt,pC=Xd,vC=ve,gC=ir.set,yC=ir.getterFor,IC=qa.find,mC=qa.findIndex,EC=sC([].splice),_C=0,RC=function(t){return t.frozen||(t.frozen=new bC)},bC=function(){this.entries=[]},TC=function(t,e){return IC(t.entries,(function(t){return t[0]===e}))};bC.prototype={get:function(t){var e=TC(this,t);if(e)return e[1]},has:function(t){return!!TC(this,t)},set:function(t,e){var n=TC(this,t);n?n[1]=e:this.entries.push([t,e])},delete:function(t){var e=mC(this.entries,(function(e){return e[0]===t}));return~e&&EC(this.entries,e,1),!!~e}};var CC,DC={getConstructor:function(t,e,n,r){var i=t((function(t,i){lC(t,a),gC(t,{type:e,id:_C++,frozen:null}),dC(i)||pC(i,t[r],{that:t,AS_ENTRIES:n})})),a=i.prototype,o=yC(e),s=function(t,e,n){var r=o(t),i=uC(hC(e),!0);return!0===i?RC(r).set(e,n):i[r.id]=n,t};return cC(a,{delete:function(t){var e=o(this);if(!fC(t))return!1;var n=uC(t);return!0===n?RC(e).delete(t):n&&vC(n,e.id)&&delete n[e.id]},has:function(t){var e=o(this);if(!fC(t))return!1;var n=uC(t);return!0===n?RC(e).has(t):n&&vC(n,e.id)}}),cC(a,n?{get:function(t){var e=o(this);if(fC(t)){var n=uC(t);if(!0===n)return RC(e).get(t);if(n)return n[e.id]}},set:function(t,e){return s(this,t,e)}}:{add:function(t){return s(this,t,!0)}}),i}},wC=Hf,SC=k,OC=Q,xC=Tp,kC=wf.exports,AC=Rp,LC=DC,NC=gt,UC=ir.enforce,PC=L,MC=Gn,jC=Object,VC=Array.isArray,GC=jC.isExtensible,HC=jC.isFrozen,FC=jC.isSealed,BC=jC.freeze,KC=jC.seal,qC=!SC.ActiveXObject&&"ActiveXObject"in SC,WC=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},zC=AC("WeakMap",WC,LC),JC=zC.prototype,YC=OC(JC.set);if(MC)if(qC){CC=LC.getConstructor(WC,"WeakMap",!0),kC.enable();var QC=OC(JC.delete),$C=OC(JC.has),XC=OC(JC.get);xC(JC,{delete:function(t){if(NC(t)&&!GC(t)){var e=UC(this);return e.frozen||(e.frozen=new CC),QC(this,t)||e.frozen.delete(t)}return QC(this,t)},has:function(t){if(NC(t)&&!GC(t)){var e=UC(this);return e.frozen||(e.frozen=new CC),$C(this,t)||e.frozen.has(t)}return $C(this,t)},get:function(t){if(NC(t)&&!GC(t)){var e=UC(this);return e.frozen||(e.frozen=new CC),$C(this,t)?XC(this,t):e.frozen.get(t)}return XC(this,t)},set:function(t,e){if(NC(t)&&!GC(t)){var n=UC(this);n.frozen||(n.frozen=new CC),$C(this,t)?YC(this,t,e):n.frozen.set(t,e)}else YC(this,t,e);return this}})}else wC&&PC((function(){var t=BC([]);return YC(new zC,t,1),!HC(t)}))&&xC(JC,{set:function(t,e){var n;return VC(t)&&(HC(t)?n=BC:FC(t)&&(n=KC)),YC(this,t,e),n&&n(t),this}});var ZC="number",tD="string",eD="object",nD="boolean",rD="function",iD="array",aD={createInstance:{sdkAppID:{required:!0,rules:[ZC],allowEmpty:!1},tim:{required:!1,rules:[eD],allowEmpty:!0}},destroyInstance:{},init:{userID:{required:!0,rules:[tD],allowEmpty:!1},userSig:{required:!0,rules:[tD],allowEmpty:!1}},login:{userID:{required:!0,rules:[tD],allowEmpty:!1},userSig:{required:!0,rules:[tD],allowEmpty:!1}},on:[{key:"eventCode",required:!0,rules:[tD],allowEmpty:!1},{key:"handler",required:!0,rules:[rD],allowEmpty:!1},{key:"context",required:!0,rules:[eD],allowEmpty:!1}],off:[{key:"eventCode",required:!0,rules:[tD],allowEmpty:!1},{key:"handler",required:!0,rules:[rD],allowEmpty:!1}],call:{userID:{required:!0,rules:[tD],allowEmpty:!1},type:{required:!0,rules:[ZC],allowEmpty:!1},roomID:{required:!1,rules:[ZC],range:"0~".concat(ug),allowEmpty:!0},strRoomID:{required:!1,rules:[tD],allowEmpty:!0}},groupCall:{groupID:{required:!0,rules:[tD],allowEmpty:!1},type:{required:!0,rules:[ZC],allowEmpty:!1},userIDList:{required:!0,rules:[iD],allowEmpty:!1},roomID:{required:!1,rules:[ZC],range:"0~".concat(ug),allowEmpty:!0},strRoomID:{required:!1,rules:[tD],allowEmpty:!0}},joinInGroupCall:{groupID:{required:!0,rules:[tD],allowEmpty:!1},type:{required:!0,rules:[ZC],allowEmpty:!1},roomID:{required:!0,rules:[ZC],allowEmpty:!1},strRoomID:{required:!1,rules:[tD],allowEmpty:!0}},inviteUser:{userIDList:{required:!0,rules:[iD],allowEmpty:!1}},accept:{},reject:{},hangup:{},switchCallMediaType:[{key:"type",required:!0,rules:[ZC],allowEmpty:!1}],openCamera:{},closeCamera:{},switchCamera:{},openMicrophone:{},closeMicrophone:{},selectAudioPlaybackDevice:[{key:"type",required:!0,rules:[tD],allowEmpty:!1}],setSelfInfo:[{key:"nickName",required:!0,rules:[tD],allowEmpty:!1},{key:"avatar",required:!0,rules:[tD],allowEmpty:!1}],setBeautyLevel:[{key:"level",required:!0,rules:[ZC],range:"0~9",allowEmpty:!1}],enableMultiDeviceAbility:[{key:"enable",required:!0,rules:[nD],allowEmpty:!1}]},oD={createInstance:"",destroyInstance:"",init:"",on:"",off:"",call:[qv.IDLE],groupCall:[qv.IDLE],accept:[qv.CALLING],reject:[qv.CALLING],hangup:[qv.CALLING,qv.CONNECTED],switchCallMediaType:[qv.CALLING,qv.CONNECTED],joinInGroupCall:[qv.IDLE],inviteUser:[qv.CALLING,qv.CONNECTED],openCamera:[qv.CALLING,qv.CONNECTED],closeCamera:[qv.CALLING,qv.CONNECTED],switchCamera:[qv.CALLING,qv.CONNECTED],openMicrophone:[qv.CALLING,qv.CONNECTED],closeMicrophone:[qv.CALLING,qv.CONNECTED],selectAudioPlaybackDevice:[qv.CALLING,qv.CONNECTED],setSelfInfo:"",setBeautyLevel:""},sD={createInstance:!1,destroyInstance:!0,init:!1,off:!0,call:!0,groupCall:!0,joinInGroupCall:!0,inviteUser:!0,accept:!0,reject:!0,hangup:!0,switchCallMediaType:!0,openCamera:!0,closeCamera:!0,switchCamera:!0,openMicrophone:!0,closeMicrophone:!0,selectAudioPlaybackDevice:!0,setSelfInfo:!0,setBeautyLevel:!1,enableMultiDeviceAbility:!0};function cD(t){var e=UT(t)?"".concat(qT.ERROR_PACKAGE_NOT_PURCHASED):"".concat(KT.ERROR_PACKAGE_NOT_PURCHASED);return e=e.replace("${purchaseAddress}",PT(t))}var uD=function(){return d((function t(){c(this,t),p(this,"paramsMatchedRule",aD),p(this,"statusMatchedRule",oD),p(this,"requireInit",sD)}),[{key:"getParamsMatchedRule",value:function(t){return this.paramsMatchedRule[t]}},{key:"getStatusMatchedRule",value:function(t){return this.statusMatchedRule[t]}},{key:"getInitReadyRule",value:function(t){return this.requireInit[t]}}])}(),lD=function(){return d((function t(){c(this,t),this._logger=my()}),[{key:"notify",value:function(t,e,n){this._logger.error("check:".concat(t.api),{text:{data:t,error:{code:e,message:n}}});var r={code:e,fnName:t.api};throw r=n?m(m({},r),{},{message:n}):r,new YT(r)}}])}(),hD=d((function t(e){c(this,t),p(this,"api",""),p(this,"attributes",{}),p(this,"callStatus",""),p(this,"capabilityCode",void 0),p(this,"initReady",void 0),this.api=e.api,this.attributes=e.attributes,this.callStatus=e.callStatus,this.capabilityCode=e.capabilityCode,this.initReady=e.initReady,this.sdkAppID=e.sdkAppID})),dD=new WeakMap,fD=function(){return d((function t(){var e,n,r;c(this,t),l(this,dD,void 0),n=this,r=[],(e=dD).set(i(e,n),r)}),[{key:"addAlertHandler",value:function(t){u(dD,this).push(t)}},{key:"check",value:(t=o(_().mark((function t(e,n){var r;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=0;case 1:if(!(r<u(dD,this).length)){t.next=7;break}return t.next=4,u(dD,this)[r].check(e,n);case 4:r++,t.next=1;break;case 7:case"end":return t.stop()}}),t,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"checkSync",value:function(t,e){for(var n=0;n<u(dD,this).length;n++)u(dD,this)[n].check(t,e)}}]);var t}(),pD=function(){return d((function t(e,n){c(this,t),p(this,"rule",void 0),p(this,"notification",void 0),this.rule=e,this.notification=n}),[{key:"check",value:(t=o(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return");case 1:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]);var t}(),vD=function(){function t(e,n){return c(this,t),s(this,t,[e,n])}return g(t,pD),d(t,[{key:"check",value:function(t){if(t.callStatus){var e=this.rule.getStatusMatchedRule(t.api);e&&!e.includes(t.callStatus)&&this.notification.notify(t,tE.ERROR_REQUEST_REFUSED)}}}])}(),gD=function(){function t(e,n){return c(this,t),s(this,t,[e,n])}return g(t,pD),d(t,[{key:"check",value:(e=o(_().mark((function t(e){var n,r,i,a=arguments;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:{},!e.capabilityCode){t.next=19;break}return t.prev=2,t.next=5,n.tim.callExperimentalAPI("isCommercialAbilityEnabled",e.capabilityCode);case 5:!1===t.sent.data.enabled&&this.notification.notify(e,tE.ERROR_PACKAGE_NOT_SUPPORTED),t.next=19;break;case 9:if(t.prev=9,t.t0=t.catch(2),2905!==t.t0.code){t.next=15;break}this.notification.notify(e,tE.ERROR_TIM_VERSION_OUTDATED),t.next=19;break;case 15:throw r=null,i=0,e.capabilityCode===cg.PRO?(r="".concat((o=e.sdkAppID,s=void 0,s=UT(o)?"".concat(qT.ERROR_PACKAGE_NOT_SUPPORTED):"".concat(KT.ERROR_PACKAGE_NOT_SUPPORTED),s=s.replace("${purchaseAddress}",PT(o)))," <ERROR_PACKAGE_NOT_SUPPORTED: ").concat(tE.ERROR_PACKAGE_NOT_SUPPORTED,">"),i=tE.ERROR_PACKAGE_NOT_SUPPORTED):(r="".concat(cD(e.sdkAppID)," <ERROR_PACKAGE_NOT_PURCHASED: ").concat(tE.ERROR_PACKAGE_NOT_PURCHASED,">"),i=tE.ERROR_PACKAGE_NOT_PURCHASED),new YT({code:i,message:r});case 19:case"end":return t.stop()}var o,s}),t,this,[[2,9]])}))),function(t){return e.apply(this,arguments)})}]);var e}(),yD=function(){function t(e,n){return c(this,t),s(this,t,[e,n])}return g(t,pD),d(t,[{key:"check",value:function(t,e){void 0!==t.initReady&&this.rule.getInitReadyRule(t.api)!==t.initReady&&this.notification.notify(t,tE.ERROR_INIT_FAIL)}}])}(),ID=function(){function t(){c(this,t),p(this,"alertRule",void 0),p(this,"notification",void 0),p(this,"alert",void 0)}return d(t,[{key:"initializeBeans",value:function(){this.alertRule=new uD,this.notification=new lD,this.alert=new fD,this.alert.addAlertHandler(new yD(this.alertRule,this.notification)),this.alert.addAlertHandler(new gD(this.alertRule,this.notification)),this.alert.addAlertHandler(new vD(this.alertRule,this.notification))}},{key:"getAlert",value:function(){return this.alert}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new t,this.instance.initializeBeans()),this.instance}}])}();function mD(t){return ED.apply(this,arguments)}function ED(){return ED=o(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e===Xv.AUDIO||e===Xv.VIDEO){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",new Promise(function(){var t=o(_().mark((function t(n,r){var i,a,o,s,c;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(a=AT(i={microphone:!0,camera:e===Xv.VIDEO}))||e!==Xv.AUDIO||(RD(ry,iy),r({callType:e,hasAppDevicePermission:a})),a||e!==Xv.VIDEO||(RD(ay,oy),r({callType:e,hasAppDevicePermission:a})),t.next=6,xT(i);case 6:if((o=t.sent)||e!==Xv.AUDIO){t.next=19;break}return t.prev=8,t.next=11,bD({scope:ly});case 11:t.next=19;break;case 13:t.prev=13,t.t0=t.catch(8),_D(s=Xg,Zg),r({callType:e,text:s});case 19:if(o||e!==Xv.VIDEO){t.next=30;break}return t.prev=20,t.next=23,GT([bD({scope:ly}),bD({scope:hy})]);case 23:t.sent.find((function(t){return"rejected"===(null==t?void 0:t.status)}))&&(_D(c=ty,ey),r({callType:e,text:c})),t.next=30;break;case 27:t.prev=27,t.t1=t.catch(20),console.debug(t.t1);case 30:n();case 31:case"end":return t.stop()}}),t,null,[[8,13],[20,27]])})));return function(e,n){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}}),t)}))),ED.apply(this,arguments)}function _D(t,e){wx.showModal({title:t,content:e,confirmText:ny,success:function(t){t.confirm&&wx.openSetting()}})}function RD(t,e){wx.showModal({title:t,content:e,confirmText:sy,success:function(t){t.confirm&&wx.openAppAuthorizeSetting()}})}function bD(t){return TD.apply(this,arguments)}function TD(){return(TD=o(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(wx.$TUICallKitPlugin){t.next=5;break}return t.next=3,wx.authorize(e);case 3:t.next=7;break;case 5:return t.next=7,wx.authorizeForMiniProgram(e);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}p(ID,"instance",void 0);var CD=Q,DD=Wt,wD=gt,SD=ve,OD=Qc,xD=U,kD=Function,AD=CD([].concat),LD=CD([].join),ND={},UD=xD?kD.bind:function(t){var e=DD(this),n=e.prototype,r=OD(arguments,1),i=function(){var n=AD(r,OD(arguments));return this instanceof i?function(t,e,n){if(!SD(ND,e)){for(var r=[],i=0;i<e;i++)r[i]="a["+i+"]";ND[e]=kD("C,a","return new C("+LD(r,",")+")")}return ND[e](t,n)}(e,n.length,n):e.apply(t,n)};return wD(n)&&(i.prototype=n),i};Oi({target:"Function",proto:!0,forced:Function.bind!==UD},{bind:UD});var PD=kr,MD=Fp,jD=ut,VD=RangeError,GD=Oi,HD=Q,FD=kr,BD=OE,KD=function(t){var e=MD(jD(this)),n="",r=PD(t);if(r<0||r===1/0)throw new VD("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n},qD=L,WD=RangeError,zD=String,JD=Math.floor,YD=HD(KD),QD=HD("".slice),$D=HD(1..toFixed),XD=function(t,e,n){return 0===e?n:e%2==1?XD(t,e-1,n*t):XD(t*t,e/2,n)},ZD=function(t,e,n){for(var r=-1,i=n;++r<6;)i+=e*t[r],t[r]=i%1e7,i=JD(i/1e7)},tw=function(t,e){for(var n=6,r=0;--n>=0;)r+=t[n],t[n]=JD(r/e),r=r%e*1e7},ew=function(t){for(var e=6,n="";--e>=0;)if(""!==n||0===e||0!==t[e]){var r=zD(t[e]);n=""===n?r:n+YD("0",7-r.length)+r}return n};GD({target:"Number",proto:!0,forced:qD((function(){return"0.000"!==$D(8e-5,3)||"1"!==$D(.9,0)||"1.25"!==$D(1.255,2)||"1000000000000000128"!==$D(0xde0b6b3a7640080,0)}))||!qD((function(){$D({})}))},{toFixed:function(t){var e,n,r,i,a=BD(this),o=FD(t),s=[0,0,0,0,0,0],c="",u="0";if(o<0||o>20)throw new WD("Incorrect fraction digits");if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return zD(a);if(a<0&&(c="-",a=-a),a>1e-21)if(n=(e=function(t){for(var e=0,n=t;n>=4096;)e+=12,n/=4096;for(;n>=2;)e+=1,n/=2;return e}(a*XD(2,69,1))-69)<0?a*XD(2,-e,1):a/XD(2,e,1),n*=4503599627370496,(e=52-e)>0){for(ZD(s,0,n),r=o;r>=7;)ZD(s,1e7,0),r-=7;for(ZD(s,XD(10,r,1),0),r=e-1;r>=23;)tw(s,1<<23),r-=23;tw(s,1<<r),ZD(s,1,1),tw(s,2),u=ew(s)}else ZD(s,0,n),ZD(s,1<<-e,0),u=ew(s)+YD("0",o);return u=o>0?c+((i=u.length)<=o?"0."+YD("0",o-i)+u:QD(u,0,i-o)+"."+QD(u,i-o)):c+u}});var nw=function(){return d((function t(){c(this,t)}),null,[{key:"generateTaskID",value:function(){return this.currentTaskID+=1}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yg,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;n=m(m({},t===mg?{delay:2e3,count:0,backgroundTask:!0}:t===Ig?{fps:60,delay:16.6,count:0,backgroundTask:!0}:{delay:2e3,count:0,backgroundTask:!0}),n),RT(e)&&(n=m(m({},n),e)),CT(t)&&(e=t,t=yg);var r=m({taskID:this.generateTaskID(),loopCount:0,intervalID:null,timeoutID:null,rafID:null,taskName:t,callback:e},n);return this.taskMap.set(r.taskID,r),this[t](r),r.taskID}},{key:"interval",value:function(t){var e=this;return t.intervalID=setInterval((function(){t.callback(),t.loopCount+=1,e.isBreakLoop(t)}),t.delay)}},{key:"timeout",value:function(t){var e=this,n=function(){if(t.callback(),t.loopCount+=1,!e.isBreakLoop(t))return t.timeoutID=setTimeout(n,t.delay)};return t.timeoutID=setTimeout(n,t.delay)}},{key:"raf",value:function(t){var e=this;t.delay=(1e3/t.fps).toFixed(2);var n,r=NT(),i=function(){if(document.hidden&&t.backgroundTask){if(n=NT()-r,r=NT(),t.callback(),t.loopCount+=1,e.isBreakLoop(t))return;return t.timeoutID=setTimeout(i,t.delay-Math.floor(n%t.delay))}if((n=NT()-r)>=t.delay&&(r=NT()-Math.floor(n%t.delay),t.callback(),t.loopCount+=1),!e.isBreakLoop(t))return t.rafID=requestAnimationFrame(i)};if(t.rafID=requestAnimationFrame(i),t.backgroundTask){var a=function(){if(document.hidden){var e=NT()-r;e>=t.delay?i():t.timeoutID=setTimeout(i,t.delay-e)}};document.addEventListener("visibilitychange",a),t.onVisibilitychange=a,document.hidden&&a()}return t.taskID}},{key:"hasTask",value:function(t){return this.taskMap.has(t)}},{key:"clearTask",value:function(t){if(!this.taskMap.has(t))return!0;var e=this.taskMap.get(t),n=e.intervalID,r=e.timeoutID,i=e.onVisibilitychange;return n&&clearInterval(n),r&&clearTimeout(r),i&&document.removeEventListener("visibilitychange",i),this.taskMap.delete(t),!0}},{key:"isBreakLoop",value:function(t){return!this.taskMap.has(t.taskID)||0!==t.count&&t.loopCount>=t.count&&(this.clearTask(t.taskID),!0)}}])}();function rw(t){var e=_g;switch(t){case ng:e=hg;break;case rg:e=lg}return e}function iw(t){var e=t;return e===tg?e=Rg:e===eg&&(e=bg),e}p(nw,"taskMap",new Map),p(nw,"currentTaskID",1);var aw={serviceCommand:"".concat(Dg,".*")},ow="sendTRTCCustomData",sw=function(){return d((function t(e){c(this,t),p(this,"_callRecordData",void 0),p(this,"_tim",void 0),p(this,"_heartbeat",void 0),p(this,"_lastHeartBeatTime",void 0),p(this,"_bodyStatus",void 0),this._tim=e.tim,this._heartbeat=-1,this._lastHeartBeatTime=-1,this._bodyStatus=Qg,this.initializeCallData(e)}),[{key:"getCallRecordData",value:function(){return this._callRecordData}},{key:"initializeCallData",value:function(t){var e=t||{},n=e.version,r=void 0===n?"":n,i=e.userID,a=void 0===i?"":i,o={name:Ub.platform,version:Ub.version},s={version:1,command:qg,sdk_version:r,seq:0,os_name:Jg,os_version:o.version||"",device_name:o.name||"",framework:Jg,call_type:"",media_type:"",client_ts:0,role:Zv,user_id:a,room_id:"",call_id:"",group_id:"",room_id_type:1};this._callRecordData={head:s,body:{event_type:"",code:0,message:"",invitee_list:[]}}}},{key:"reset",value:function(){this.initializeCallData()}},{key:"_setCallType",value:function(t){t&&(this._callRecordData.head=m(m({},this._callRecordData.head),{},{call_type:t}))}},{key:"_setMediaType",value:function(t){t&&(this._callRecordData.head=m(m({},this._callRecordData.head),{},{media_type:rw(t)}))}},{key:"_setCallRole",value:function(t){t&&(this._callRecordData.head=m(m({},this._callRecordData.head),{},{role:t}))}},{key:"_setUserID",value:function(t){t&&(this._callRecordData.head=m(m({},this._callRecordData.head),{},{user_id:t}))}},{key:"_setRoomID",value:function(t){t&&(this._callRecordData.head=m(m({},this._callRecordData.head),{},{room_id:"".concat(t)}))}},{key:"_setInviteID",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t&&(this._callRecordData.head=m(m({},this._callRecordData.head),{},{call_id:t}))}},{key:"_setGroupId",value:function(t){bT(t)||(this._callRecordData.head=m(m({},this._callRecordData.head),{},{group_id:t}))}},{key:"_getGroupId",value:function(){return this._callRecordData.head.group_id}},{key:"_setRoomIdType",value:function(t){t&&(this._callRecordData.head=m(m({},this._callRecordData.head),{},{room_id_type:t}))}},{key:"_setEventType",value:function(t){t&&(this._callRecordData.body=m(m({},this._callRecordData.body),{},{event_type:t}))}},{key:"_setInviteeList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._callRecordData.body=m(m({},this._callRecordData.body),{},{invitee_list:t})}},{key:"_setSeq",value:function(){var t=this.getCallRecordData().head.seq;this._callRecordData.head=m(m({},this._callRecordData.head),{},{seq:t+1})}},{key:"setBodyStatus",value:function(t){if(t){var e=Qg;switch(t){case qv.CALLING:e=Qg;break;case qv.CONNECTED:e=zg}this._bodyStatus=e}}},{key:"eventUpload",value:(r=o(_().mark((function t(e){var n,r,i,a,o,s,c,u,l,h,d,f,p,v,g,y,I,E;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.eventType,i=e.callType,a=e.mediaType,o=e.callRole,s=e.userID,c=e.roomID,u=e.inviteID,l=e.groupId,h=e.strRoomId,d=void 0===h?"":h,f=e.inviteeList,p=void 0===f?[]:f,r){t.next=3;break}return t.abrupt("return");case 3:return this._callRecordData.head=m(m({},this._callRecordData.head),{},{command:qg,client_ts:Math.floor(Date.now()/1e3)}),this._setCallType(i),this._setMediaType(a),this._setCallRole(o),this._setUserID(s),this._setInviteID(u),this._setGroupId(l),c>0?(this._setRoomID("".concat(c)),this._setRoomIdType(1)):0===c&&_T(d)&&d.length>0&&(this._setRoomID(d),this._setRoomIdType(2)),this._setEventType(r),this._setInviteeList(p),this._setSeq(),v=this.getCallRecordData(),g=v.head,y=v.body,I={head:m(m({},g),{},{role:iw(g.role)}),body:y},E=m(m({},aw),{},{data:JSON.stringify(I)}),t.next=19,null==this||null===(n=this._tim)||void 0===n?void 0:n.callExperimentalAPI(ow,E);case 19:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"eventUploadNotSave",value:(n=o(_().mark((function t(e){var n,r,i,a,o,s,c,u,l,h,d,f,p,v,g,y;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.eventType,i=e.callType,a=e.mediaType,o=e.callRole,s=e.roomID,c=e.groupId,u=e.strRoomId,l=void 0===u?"":u,h=e.inviteID,this._setSeq(),d=this.getCallRecordData(),f=d.head,p=d.body,v=f.room_id_type,s>0&&(v=1),0===s&&l&&(v=2),g={head:m(m({},f),{},{role:iw(o),call_id:h,call_type:i,media_type:rw(a),room_id:1===v?"".concat(s):l,client_ts:Math.floor(Date.now()/1e3),group_id:c||this._getGroupId(),room_id_type:v}),body:m(m({},p),{},{event_type:r})},y=m(m({},aw),{},{data:JSON.stringify(g)}),t.next=10,null==this||null===(n=this._tim)||void 0===n?void 0:n.callExperimentalAPI(ow,y);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"heartBeatUpload",value:(e=o(_().mark((function t(){var e,n,r,i;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._setSeq(),n=this._callRecordData.head,r={head:m(m({},n),{},{role:iw(n.role),clientTs:Date.now(),command:Wg}),body:{status:this._bodyStatus}},i=m(m({},aw),{},{data:r}),t.next=6,null==this||null===(e=this._tim)||void 0===e?void 0:e.callExperimentalAPI(ow,i);case 6:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"startHeartbeat",value:function(){-1===this._heartbeat&&(yT.info("start heart beat..."),this.heartBeatUpload(),this._heartbeat=nw.run(yg,this.doHeartbeat.bind(this),{delay:2e3,count:0,backgroundTask:!0}))}},{key:"stopHeartbeat",value:function(){-1!==this._heartbeat&&(yT.info("stop heart beat"),nw.clearTask(this._heartbeat),this._heartbeat=-1,this._lastHeartBeatTime=-1,this._bodyStatus=Qg)}},{key:"doHeartbeat",value:(t=o(_().mark((function t(){var e;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.heartBeatUpload(),e=Date.now(),this._lastHeartBeatTime>0&&e-this._lastHeartBeatTime>1e4&&yT.warn("heartbeat took ".concat(e-this._lastHeartBeatTime)),this._lastHeartBeatTime=e;case 4:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})}]);var t,e,n,r}(),cw=function(){return d((function t(e,n){c(this,t),p(this,"_eventEmitter",void 0),p(this,"_callRecordDataReport",void 0),p(this,"_isCallAccepted",void 0),this._eventEmitter=e,this._callRecordDataReport=n,this._isCallAccepted=!1,this.registerListener()}),[{key:"registerListener",value:function(){this._eventEmitter.on(Kv.ON_CALL_RECEIVED,this.onCallReceived.bind(this)),this._eventEmitter.on(Kv.USER_ACCEPT,this.onCallAccepted.bind(this)),this._eventEmitter.on(Kv.CALL_END,this.onCallEnd.bind(this)),this._eventEmitter.on(Kv.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.on(Kv.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.on(Kv.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.on(Kv.REJECT,this.onReject.bind(this))}},{key:"removeLister",value:function(){this._eventEmitter.off(Kv.ON_CALL_RECEIVED,this.onCallReceived),this._eventEmitter.off(Kv.USER_ACCEPT,this.onCallAccepted),this._eventEmitter.off(Kv.CALL_END,this.onCallEnd),this._eventEmitter.off(Kv.CALLING_CANCEL,this.onCallingCancel),this._eventEmitter.off(Kv.NO_RESP,this.onNoResponse),this._eventEmitter.off(Kv.LINE_BUSY,this.onLineBusy),this._eventEmitter.off(Kv.REJECT,this.onReject)}},{key:"onCallReceived",value:function(){this._callRecordDataReport.startHeartbeat()}},{key:"onCallAccepted",value:function(){var t=this._callRecordDataReport.getCallRecordData().head;if((null==t?void 0:t.role)===fg){if(this._isCallAccepted&&t.call_type===Sg)return;this._isCallAccepted=!0;var e={eventType:kg};this._callRecordDataReport.eventUpload(e),this._callRecordDataReport.setBodyStatus(qv.CONNECTED)}}},{key:"onCallEnd",value:function(){var t={eventType:Fg};this._isCallAccepted=!1,this._callRecordDataReport.eventUpload(t),this._callRecordDataReport.stopHeartbeat()}},{key:"onCallingCancel",value:function(t){var e=this._callRecordDataReport.getCallRecordData().head,n=e.role===fg?Vg:Gg;this._isCallAccepted=!1;var r=(t.data||{}).reason;((void 0===r?"":r)===vg||e.role===fg&&e.call_type===Sg)&&this._callRecordDataReport.eventUpload({eventType:n}),this._callRecordDataReport.stopHeartbeat()}},{key:"onNoResponse",value:function(){this._uploadInC2C(yg)}},{key:"onLineBusy",value:function(){this._uploadInC2C(Eg)}},{key:"onReject",value:function(){this._uploadInC2C(gg)}},{key:"_uploadInC2C",value:function(t){var e=this._callRecordDataReport.getCallRecordData().head;if((null==e?void 0:e.call_type)===wg){var n="";switch(t){case yg:n=e.role===fg?Lg:Ng;break;case gg:n=e.role===fg&&Ug;break;case Eg:n=e.role===fg?Mg:Ng;break;default:return}this._callRecordDataReport.eventUpload({eventType:n})}}}])}(),uw={};function lw(t){var e=t.key,n=t.timeout,r=void 0===n?0:n,i=t.errorMessage,a=void 0===i?"":i,o=null,s=null,c=null,u=new Promise((function(t,e){o=function(){c&&clearTimeout(c),t()},s=function(t){c&&clearTimeout(c),e(t)}}));return r>0&&(c=setTimeout((function(){CT(s)&&s({message:a})}),r)),uw[e]={resolve:o,reject:s,promise:u},u}function hw(t){return uw[t]||{}}var dw=qa.some;Oi({target:"Array",proto:!0,forced:!Ao("some")},{some:function(t){return dw(this,t,arguments.length>1?arguments[1]:void 0)}}),Oi({target:"Number",stat:!0},{isNaN:function(t){return t!=t}});var fw,pw,vw,gw,yw,Iw,mw,Ew,_w,Rw,bw,Tw,Cw,Dw,ww,Sw,Ow=On.PROPER,xw=L,kw=xE,Aw=jE.trim;function Lw(t){return function(e,n,r){var i=r.value;return r.value=function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return Nw.call(this,t,r,n),i.apply(this,r)},r}}function Nw(t,e,n){var r=my();try{if(mT(t))for(var i=0;i<t.length;i++)Uw.call(this,m(m({},t[i]),{},{value:e[i],name:n}));else for(var a in t)Uw.call(this,m(m({},t[a]),{},{value:e[0][a],name:n,key:a}))}catch(t){throw r.error("paramValidate.fail",{text:{error:t}}),t}}function Uw(t){var e=t.required,n=t.rules,r=t.range,i=t.value,a=t.allowEmpty,o=t.name,s=t.key;if(bT(i)){if(e){var c=WT({code:tE.INVALID_PARAMETER_REQUIRED,params:{key:s,value:i,fnName:o}});throw new YT({code:tE.ERROR_PARAM_INVALID,message:c})}}else{var u="";if(!n.some((function(t){return t===IT(i)}))){for(var l=0;l<n.length;l++){var h=n[l];h=h.replace(h[0],h[0].toUpperCase()),u+="".concat(h,"/")}u=u.substring(0,u.length-1);var d=WT({code:tE.INVALID_PARAMETER_TYPE,params:{key:s,rule:{type:u},value:i,fnName:o}});throw new YT({code:tE.ERROR_PARAM_INVALID,message:d})}if(!1===a){if(mT(i)&&0===i.length){var f=WT({code:tE.INVALID_PARAMETER_EMPTY,params:{key:s,fnName:o}});throw new YT({code:tE.ERROR_PARAM_INVALID,message:f})}if(_T(i)&&""===i.trim()){var p=WT({code:tE.INVALID_PARAMETER_EMPTY,params:{key:s,value:i}});throw new YT({code:tE.ERROR_PARAM_INVALID,message:p})}}if(mT(r)&&r&&-1===r.indexOf(i)){var v=WT({code:tE.INVALID_PARAMETER_RANGE,params:{key:s,rule:{values:r},value:i,fnName:o}});throw new YT({code:tE.ERROR_PARAM_INVALID,message:v})}if(_T(r)&&-1!==r.indexOf("~")){var g=r.split("~");if(i<+g[0]||i>+g[1]||ET(i)&&Number.isNaN(i)){var y=WT({code:tE.INVALID_PARAMETER_RANGE,params:{key:s,rule:{values:r},value:i,fnName:o}});throw new YT({code:tE.ERROR_PARAM_INVALID,message:y})}}}}Oi({target:"String",proto:!0,forced:function(t){return xw((function(){return!!kw[t]()||"​᠎"!=="​᠎"[t]()||Ow&&kw[t].name!==t}))}("trim")},{trim:function(){return Aw(this)}});var Pw=my(),Mw=(fw=Lw(aD.createInstance),pw=Lw(aD.setBeautyLevel),vw=Lw(aD.init),gw=Lw(aD.login),yw=Lw(aD.on),Iw=Lw(aD.off),mw=Lw(aD.call),Ew=Lw(aD.groupCall),_w=Lw(aD.joinInGroupCall),Rw=Lw(aD.inviteUser),bw=Lw(aD.selectAudioPlaybackDevice),Tw=Lw(aD.switchCallMediaType),Cw=Lw(aD.setSelfInfo),Dw=Lw(aD.enableMultiDeviceAbility),Sw=function(){function n(r){c(this,n),p(this,"_initReady",!1),p(this,"_timExternal",!1),p(this,"_initialCallId",""),p(this,"_beautyLevel",4),p(this,"_isEnableMultiDeviceAbility",!1),p(this,"_loginResolveList",[]),p(this,"_logLevel",1),p(this,"_excludeFromHistoryMessage",void 0),p(this,"_uniqueLoginId",""),this.data={config:{sdkAppID:r.sdkAppID,userID:"",userSig:"",type:1}},this.initData(),this.EVENT=Kv,this.MEDIA_TYPE=Xv,this.CALL_TYPE=Xv,this._emitter=new XT,this.TRTC=new e(this,{TUIScene:"TUICallEngine"});var i="TUICallEngine";14===(null==r?void 0:r.component)&&(i="TUICallKit"),15===(null==r?void 0:r.component)&&(i="TIMCallKit"),this._initLogger(r);try{(wx&&wx._isTIMCallKit||wx&&wx.getStorageSync&&wx.getStorageSync("_isTIMCallKit")||getApp&&getApp()&&getApp().globalData&&getApp().globalData._isTIMCallKit)&&(i="TIMCallKit")}catch(t){console.error(t)}wx.TUIScene=i,r.tim?(this._chat=r.tim,this._timExternal=!0,CT(r.tim.addSignalingListener)||(this._logger.info("constructor.start",{text:{data:r},type:"api"}),yT.error("constructor.start, you need to pass in an instance of @tencentcloud/chat, \n          please use @tencentcloud/chat instead of tim-js-sdk. 需要传入 @tencentcloud/chat 的实例"))):wx.$TIM?(this._chat=wx.$TIM,this._timExternal=!0):this._chat=t.create({SDKAppID:r.sdkAppID}),this._callRecordReport=new sw({version:Bv,tim:this._chat}),this._recordReportObserver=new cw(this._emitter,this._callRecordReport),wx.getSystemInfoSync().platform===Tg&&yT.warn("".concat(uy)),this.TSignalingClient=new $T({chat:this._chat,tuiCallEngine:this}),this.TRTCCallingDelegate=new Ey({emitter:this._emitter}),this._logger.info("constructor.start",{text:{data:r},type:"api"}),yT.info("SDK Version:".concat(Bv,", SDKAppID:").concat(r.sdkAppID))}return d(n,[{key:"destroyInstance",value:(nt=o(_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.instance){t.next=2;break}return t.abrupt("return");case 2:return this._callRecordReport&&this._callRecordReport.reset(),this._recordReportObserver&&this._recordReportObserver.removeLister(),t.next=6,n.instance.destroyed();case 6:n.instance=null;case 7:case"end":return t.stop()}}),t,this)}))),function(){return nt.apply(this,arguments)})},{key:"_initLogger",value:function(t){var e=this;wx.getSystemInfo({success:function(t){var e=t.brand,n=t.model,r=t.language,i=t.platform,a=t.version;Pw.updateGetReportData((function(){return{useragent:{brand:e,model:n,language:r,platform:i,version:a}}}))}}),this._logger=Pw,this._logger.updateGetReportData((function(){return{app:"TUICallEngine-mini",version:Bv,platform:Jg,sdkappid:t.sdkAppID,time:+new Date,userid:e.getUserID(),uniqueloginid:e._uniqueLoginId,roomid:String(e.getRoomId()||e.getStrRoomId()),callinfo:{inviteid:e.getInitialCallId(),callrole:e.isInviter()?fg:pg,groupid:e.getGroupId(),calltype:e.getCallType(),handledInviteeList:e.getHandledInviteeList(),unHandledInviteeList:e.getUnHandledInviteeList()},callkitversion:t.callkitVersion||_g,framework:t.frameWork||_g,isfromchat:t.chat?"true":"false"}}))}},{key:"setLogLevel",value:function(t){"number"!=typeof t||isNaN(t)?yT.error("setLogLevel parameter must be a number(0~4)"):(this._logLevel=t,yT.setLevel(t),this.TSignalingClient.setLogLevel(t),this.TRTC&&this.TRTC.setLogLevel(t))}},{key:"initData",value:function(){var t={callStatus:qv.IDLE,soundMode:this.data.config.type===Xv.AUDIO?sg.EAR:sg.SPEAKER,active:!1,invitation:{inviteID:"",inviter:"",type:"",roomID:""},startTalkTime:0,localUser:null,remoteUsers:[],remoteID:"",roomId:0,strRoomId:"",timer:null,chatTimeNum:0,chatTime:"00:00:00",screen:"pusher",_callTimeout:30,pusher:{},playerList:[],isInviter:!0,unHandledInviteeList:[],handledInviteeList:[],_inviterInviteID:{},_audioVideoSwitchIdList:[],_acceptedUserObject:{},isGroupCall:!1,groupID:"",switchCallModeStatus:!0,enterRoomStatus:!1,devicePermission:!1,_initialInviteData:{},netWorkQualityList:[]};this.setIsEnableMultiDeviceAbility(!1),this.data=m(m({},this.data),t)}},{key:"handleNewInvitationReceived",value:(et=o(_().mark((function t(e){var n,r,i,a,o,s,c,u,l,h,d,f,p,v,g;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=this.getCallStatus(),this._logger.info("TSignaling.NEW_INVITATION_RECEIVED",{text:{data:m(m({},e),{},{currentCallStatus:a})},type:"event"}),yT.info("onNewInvitationReceived - params:",e,"currentCallStatus:".concat(a)),o=e.data,s=o.inviter,c=o.inviteeList,u=o.data,l=o.inviteID,h=o.groupID,this.setInitialInviteData(JSON.parse(u)),LT((d=JSON.parse(u)).businessID)){t.next=8;break}return t.abrupt("return");case 8:if(f=(null==d||null===(n=d.data)||void 0===n?void 0:n.initialCallId)||"",this.getUserID()!==s){t.next=11;break}return t.abrupt("return");case 11:if((p=!!h)||!(null!=d&&null!==(r=d.data)&&void 0!==r&&r.consumed||null!=d&&d.consumed)){t.next=14;break}return t.abrupt("return");case 14:if(v={inviter:s,inviteeList:c,inviteID:l,isGroupCall:p,inviteData:d,groupID:h,initialCallId:f,currentCallStatus:a,inCallUserIDs:(null==d?void 0:d.inCallUserIDs)||[]},"hangup"!==(null==d||null===(i=d.data)||void 0===i?void 0:i.cmd)){t.next=22;break}if(yT.info("hangup - params:",s,d,this.getHandledInviteeList(),this.getUnHandledInviteeList(),a,p),a!==qv.IDLE){t.next=19;break}return t.abrupt("return");case 19:return t.next=21,this.handleHangupSignal(v);case 21:return t.abrupt("return");case 22:if(p||!this.judgeSwitchCallMode(d)){t.next=28;break}if(a===qv.IDLE||d.room_id!==this.data.invitation.roomID){t.next=27;break}return t.next=26,this.handleSwitchCallModeTSignaling(l,d);case 26:this.addAudioVideoSwitchIdList(l);case 27:return t.abrupt("return");case 28:if(a===qv.IDLE){t.next=35;break}return t.next=31,this.TSignalingClient.reject({inviteID:l,type:u.call_type,lineBusy:"line_busy"});case 31:return g=t.sent,this.TRTCCallingDelegate.onCallMessage(g),this.getCallRecordReport().eventUploadNotSave({inviteID:f||l,callRole:pg,eventType:jg,roomID:d.room_id,mediaType:d.call_type,callType:h?Sg:wg,groupId:h,strRoomId:d.str_room_id||d.data.str_room_id}),t.abrupt("return");case 35:this.handleInvitedSignal(v);case 36:case"end":return t.stop()}}),t,this)}))),function(t){return et.apply(this,arguments)})},{key:"handleHangupSignal",value:(tt=o(_().mark((function t(e){var n,r,i,a,o,s,c,u,l,h,d,f,p;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.inviter,r=e.currentCallStatus,i=e.inviteData,a=e.inviteeList,o=this.isGroupCall(),s=this.isInviter(),r!==qv.CALLING){t.next=11;break}if(c=this.getUnHandledInviteeList(),u=this.getHandledInviteeList(),-1!==c.indexOf(n)&&this.deleteUnHandledInviteeList([n]),-1!==u.indexOf(n)){t.next=9;break}return t.abrupt("return");case 9:t.next=15;break;case 11:if(this.deleteHandledInviteeList([n]),!(-1===(l=this.getHandledInviteeList()).indexOf(n)&&l.length>1)){t.next=15;break}return t.abrupt("return");case 15:if(h=this.generateCallEndData({totalTime:i.call_end||0}),o){t.next=22;break}return this.TRTCCallingDelegate.onCallEnd(h),t.next=20,this._resetTUICallEngine();case 20:case 31:t.next=46;break;case 22:if(this.deleteHandledInviteeList([n]),this.data.playerList=this.data.playerList.filter((function(t){return t.userID!==n})),d=this.getHandledInviteeList(),f=this.getUnHandledInviteeList(),!s){t.next=33;break}if(1!==d.length||0!==f.length){t.next=31;break}return this.TRTCCallingDelegate.onCallEnd(h),t.next=31,this._resetTUICallEngine();case 33:if(r!==qv.CALLING){t.next=41;break}if(-1!==a.indexOf(this.getUserID())&&this.TRTCCallingDelegate.onUserLeave({userID:n,playerList:this.data.playerList}),0!==d.length||1!==f.length){t.next=41;break}return p=this.generateEventData(),this.TRTCCallingDelegate.onCancel(m(m({inviteID:this.data.invitation.inviteID,invitee:this.getUserID(),userID:this.getUserID()},p),{},{reason:vg})),t.next=41,this._resetTUICallEngine();case 41:if(r!==qv.CONNECTED){t.next=46;break}if(1!==d.length||0!==f.length){t.next=46;break}return this.TRTCCallingDelegate.onCallEnd(h),t.next=46,this._resetTUICallEngine();case 46:case"end":return t.stop()}}),t,this)}))),function(t){return tt.apply(this,arguments)})},{key:"handleSwitchCallModeTSignaling",value:(Z=o(_().mark((function t(e,n){var r,i,a;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={inviteID:e,type:n.call_type},i={cmd:"switchToVideo"},n.call_type===Xv.VIDEO&&(r.switch_to_audio_call="switch_to_audio_call",i.cmd="switchToAudio"),t.next=5,this.TSignalingClient.accept(r,i);case 5:a=t.sent,this.setSwitchCallModeStatus(!1),this.handleCallMode(n.call_type,a);case 8:case"end":return t.stop()}}),t,this)}))),function(t,e){return Z.apply(this,arguments)})},{key:"judgeSwitchCallMode",value:function(t){return t.switch_to_audio_call&&"switch_to_audio_call"===t.switch_to_audio_call||t.data&&"switchToAudio"===t.data.cmd||t.data&&"switchToVideo"===t.data.cmd}},{key:"handleCallMode",value:function(t,e){yT.info("handleCallMode - type",t);var n=t!==Xv.VIDEO;this.setPusherAttributesHandler({enableCamera:n}),n?(this.data.config.type=Xv.VIDEO,this.data.invitation.type=Xv.VIDEO):(this.data.config.type=Xv.AUDIO,this.data.invitation.type=Xv.AUDIO),this.TRTCCallingDelegate.onCallMode({type:this.data.config.type,message:e.data.message}),this.setSwitchCallModeStatus(!0)}},{key:"handleInvitedSignal",value:(X=o(_().mark((function t(e){var n,r,i,a,o,s,c,u,l,h,d,f,p,v,g,y,I;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.inviter,r=e.inviteeList,i=e.isGroupCall,a=e.groupID,o=e.inviteID,s=e.inviteData,c=e.inCallUserIDs,u=void 0===c?[]:c,l=e.initialCallId,h=void 0===l?"":l,this.data.remoteID=n,this.data.config.type=s.call_type,this.data.invitation.inviteID=o,this.data.invitation.inviter=n,this.data.invitation.type=s.call_type,this.data.invitation.roomID=s.room_id,this.data.isInviter=!1,this.data.isGroupCall=i,this.setRoomId(s.room_id),this.setStrRoomId(s.str_room_id||s.data.str_room_id),this.addHandledInviteeList([n]),this.addUnHandledInviteeList([].concat(b(r),b(u))),this.addAcceptedUserList(o,[n]),this.addInviterInviteId(o,[n].concat(b(r))),this.setInitialCallId(h),d=u.filter((function(t){return-1===r.indexOf(t)})),i&&this.setGroupId(a),this.changeCallStatus(qv.CALLING),yT.info("NEW_INVITATION_RECEIVED invitation: ",this.data.callStatus,this.data.invitation),f={sponsor:n,inviteeList:r,userIDList:[].concat(b(r),b(d)),isFromGroup:i,inviteID:o,groupID:a,inviteData:{version:s.version,callType:s.call_type,roomID:s.room_id},userData:s.userData,calleeIdList:r,callMediaType:s.call_type},this.setPusherAttributesHandler({enableCamera:this.data.config.type===Xv.VIDEO}),p={eventType:xg,callType:a?Sg:wg,mediaType:s.call_type,callRole:pg,userID:this.getUserID(),roomID:s.room_id,inviteID:h||o,groupId:this.getGroupId(),strRoomId:this.getStrRoomId()},this.getCallRecordReport().eventUpload(p),v=this.generateEventData()||{},this.TRTCCallingDelegate.onInvited(m(m({},v),f)),g=(new Date).getTime(),y=g;case 28:if(!(y-g<100)){t.next=39;break}return t.next=31,new Promise((function(t,e){return setTimeout(t,10)}));case 31:if(-1!==this.getInviterInviteIdList().indexOf(o)){t.next=36;break}return this._logger.warn("onNewInvitationReceived border case",{text:{data:{handleParams:e}},type:"api"}),t.next=35,this._resetTUICallEngine();case 35:return t.abrupt("return");case 36:y=(new Date).getTime(),t.next=28;break;case 39:return t.next=41,this.getSelfIMCallStatus([this.getUserID()]);case 41:if((I=t.sent)===qv.IDLE){t.next=45;break}return this._logger.error("onNewInvitationReceived",{text:{data:{handleParams:e,customStatus:I}},type:"event"}),t.abrupt("return");case 45:return t.next=47,this.setSelfIMCallStatus(qv.CALLING);case 47:return t.next=49,xT({camera:!0});case 49:this.data.devicePermission=t.sent,this.data.devicePermission&&this.data.config.type===Xv.VIDEO&&this.setPusherAttributesHandler({enableCamera:!0});case 51:case"end":return t.stop()}}),t,this)}))),function(t){return X.apply(this,arguments)})},{key:"addInviterInviteId",value:function(t,e){0!==e.length&&(0===(this.data._inviterInviteID[t]||[]).length?this.data._inviterInviteID[t]=e:this.data._inviterInviteID[t]=[].concat(b(this.data._inviterInviteID[t]),b(e)))}},{key:"handleInviteeAccepted",value:($=o(_().mark((function t(e){var n,r,i,a,o,s,c;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("TSignaling.INVITEE_ACCEPTED",{text:{data:m(m({},e),{},{currentCallStatus:this.data.callStatus}),type:"event"}}),yT.info("onInviteeAccepted - params:",e),LT(null==(n=JSON.parse(e.data.data))?void 0:n.businessID)){t.next=5;break}return t.abrupt("return");case 5:if(r=e.data.invitee,i=e.data.inviteID,-1!==this.getTotalInviterInviteIdList().indexOf(i)){t.next=9;break}return t.abrupt("return");case 9:if(this.data.callStatus!==qv.IDLE){t.next=11;break}return t.abrupt("return");case 11:if(this.isGroupCall()||!this.judgeSwitchCallMode(n)||this.data.switchCallModeStatus){t.next=14;break}return this.handleCallMode(this.data.invitation.type),t.abrupt("return");case 14:if(a=this.getCallStatus(),r!==this.getUserID()||a!==qv.CALLING){t.next=21;break}return o=this.generateEventData(),this.TRTCCallingDelegate.onCancel(m({inviteID:this.data.invitation.inviteID,invitee:r,userID:r},o)),t.next=20,this._resetTUICallEngine();case 20:return t.abrupt("return");case 21:return this.isInviter()&&this.data.callStatus===qv.CALLING&&(this.changeCallStatus(qv.CONNECTED),s=this.generateEventData(),this.TRTCCallingDelegate.onCallBegin(s)),this.addHandledInviteeList([r]),this.deleteUnHandledInviteeList([r]),this.addAcceptedUserList(i,[r]),t.next=27,this.getUserProfile(this.data.unHandledInviteeList.map((function(t){return{userID:t}})));case 27:c=t.sent,this.TRTCCallingDelegate.onUserAccept({userID:r,userList:c});case 29:case"end":return t.stop()}}),t,this)}))),function(t){return $.apply(this,arguments)})},{key:"handleInviteeRejected",value:(Q=o(_().mark((function t(e){var n,r,i,a,o,s,c,u,l,h,d,f,p,v,g,y;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("TSignaling.INVITEE_REJECTED",{text:{data:e},type:"event"}),yT.info("onInviteeRejected - params",e),r=e.data.inviteID,LT(null==(i=JSON.parse(e.data.data))?void 0:i.businessID)){t.next=6;break}return t.abrupt("return");case 6:if(this.isGroupCall()||this.getSwitchCallModeStatus()||-1===this.getAudioVideoSwitchIdList().indexOf(r)){t.next=10;break}return yT.info("onInviteeRejected - Audio and video switching is not available"),this.setSwitchCallModeStatus(!0),t.abrupt("return");case 10:if(a=e.data.invitee,o=e.data.inviter,s=this.getUserID(),c=this.getCallStatus(),-1!==this.getInviterInviteIdList().indexOf(r)){t.next=19;break}if(!this.isInviter()||-1===this.getInviterInviteIdUserList().indexOf(a)){t.next=17;break}return t.abrupt("return");case 17:return this.deleteUnHandledInviteeList([a]),t.abrupt("return");case 19:if(c!==qv.IDLE){t.next=21;break}return t.abrupt("return");case 21:if(u=this.generateEventData(),s!==a||c!==qv.CALLING){t.next=27;break}return this.TRTCCallingDelegate.onCancel(m({inviteID:this.data.invitation.inviteID,invitee:a,userID:a},u)),t.next=26,this._resetTUICallEngine();case 26:return t.abrupt("return");case 27:if(l=this.isGroupCall(),h=this.isInviter(),this.deleteUnHandledInviteeList([a]),d=this.getUnHandledInviteeList(),f=this.getHandledInviteeList(),p=m({inviteID:this.data.invitation.inviteID,invitee:s,userID:s},u),v={inviteID:this.data.invitation.inviteID,invitee:a,userID:a},g=this.data.invitation,c!==qv.CONNECTED){t.next=38;break}if(-1===f.indexOf(a)){t.next=38;break}return t.abrupt("return");case 38:if(!("line_busy"===i.line_busy||""===i.line_busy||null!=i&&null!==(n=i.data)&&void 0!==n&&n.message&&"lineBusy"===i.data.message)){t.next=52;break}if(o===g.inviter&&this.TRTCCallingDelegate.onLineBusy({inviteID:this.data.invitation.inviteID,invitee:a,userID:a}),l){t.next=46;break}return this.TRTCCallingDelegate.onCancel(m(m({},p),{},{reason:Eg})),t.next=44,this._resetTUICallEngine();case 44:t.next=50;break;case 46:if(0!==d.length||1!==f.length){t.next=50;break}return this.TRTCCallingDelegate.onCancel(m(m({},p),{},{reason:Eg})),t.next=50,this._resetTUICallEngine();case 50:case 57:t.next=78;break;case 52:if(l){t.next=59;break}return this.TRTCCallingDelegate.onReject(v),this.TRTCCallingDelegate.onCancel(m(m({},p),{},{reason:gg})),t.next=57,this._resetTUICallEngine();case 59:if(this.TRTCCallingDelegate.onReject(v),c!==qv.CALLING){t.next=72;break}if(!h){t.next=68;break}if(0!==d.length||1!==f.length){t.next=66;break}return this.TRTCCallingDelegate.onCancel(m(m({},p),{},{reason:gg})),t.next=66,this._resetTUICallEngine();case 66:t.next=72;break;case 68:if(1!==d.length||0!==f.length){t.next=72;break}return this.TRTCCallingDelegate.onCancel(m(m({},p),{},{reason:gg})),t.next=72,this._resetTUICallEngine();case 72:if(c!==qv.CONNECTED){t.next=78;break}if(0!==d.length||1!==f.length){t.next=78;break}return y=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(y),t.next=78,this._resetTUICallEngine();case 78:case"end":return t.stop()}}),t,this)}))),function(t){return Q.apply(this,arguments)})},{key:"handleInvitationCancelled",value:(Y=o(_().mark((function t(e){var n,r;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("TSignaling.INVITATION_CANCELLED",{text:{data:e,type:"event"}}),this.data.invitation.inviteID===e.data.inviteID){t.next=3;break}return t.abrupt("return");case 3:if(LT(null==(n=JSON.parse(e.data.data))?void 0:n.businessID)){t.next=6;break}return t.abrupt("return");case 6:if(this.data.callStatus!==qv.IDLE){t.next=8;break}return t.abrupt("return");case 8:if(-1!==this.getInviterInviteIdList().indexOf(e.data.inviteID)){t.next=10;break}return t.abrupt("return");case 10:return yT.info("onInvitationCancelled","inviteID:".concat(e.data.inviteID," inviter:").concat(e.data.inviter," data:").concat(e.data.data)),r=this.generateEventData(),this.TRTCCallingDelegate.onCancel(m(m({inviteID:this.data.invitation.inviteID,invitee:e.data.inviter,userID:e.data.inviter},r),{},{reason:vg})),t.next=15,this._resetTUICallEngine();case 15:case"end":return t.stop()}}),t,this)}))),function(t){return Y.apply(this,arguments)})},{key:"handleInvitationTimeout",value:(J=o(_().mark((function t(e){var n,r,i,a,o,s,c,u,l,h,d,f,p,v,g,y,I,E,R;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("TSignaling.INVITATION_TIMEOUT",{text:{data:e,type:"event"}}),r=e.data,i=r.inviter,a=r.inviteeList,o=void 0===a?[]:a,s=r.inviteID,c=this.getUserID(),u=this.isGroupCall(),l=this.isInviter(),h=this.getCallStatus(),this.deleteUnHandledInviteeList(o),yT.warn("onInvitationTimeout - params:",e,"currentUserID:".concat(c," isInviter:").concat(l," isGroupCall:").concat(u," \n      currentCallStatus:").concat(h," inviteID:").concat(null==this||null===(n=this._newInvitationData)||void 0===n?void 0:n.inviteID)),-1!==this.getInviterInviteIdList().indexOf(s)){t.next=10;break}return t.abrupt("return");case 10:if(h!==qv.IDLE){t.next=12;break}return t.abrupt("return");case 12:if(h!==qv.CONNECTED||u){t.next=14;break}return t.abrupt("return");case 14:if(d=this.getHandledInviteeList(),f=this.getUnHandledInviteeList(),p={groupID:this.getGroupId(),inviteID:this.data.invitation.inviteID,sponsor:i,timeoutUserList:o,userIDList:o},v=this.generateEventData(),g=m(m({inviteID:this.data.invitation.inviteID,invitee:c,userID:c},v),{},{reason:yg}),u){t.next=26;break}return l?(this.TRTCCallingDelegate.onNoResp(p),this.TRTCCallingDelegate.onCancel(g)):(this.TRTCCallingDelegate.onCancel(g),I=this.getCallRecordReport().getCallRecordData().head,this.getCallRecordReport().eventUpload(m(m({},I),{},{eventType:Ng,inviteID:this.getInitialCallId()}))),null!=e&&null!==(y=e.data)&&void 0!==y&&y.isSelfTimeout&&this.TRTCCallingDelegate.onCallMessage(e),t.next=24,this._resetTUICallEngine();case 24:t.next=51;break;case 26:if(h!==qv.CALLING){t.next=44;break}if(!l){t.next=35;break}if(this.TRTCCallingDelegate.onNoResp(p),0!==f.length){t.next=33;break}return this.TRTCCallingDelegate.onCancel(g),t.next=33,this._resetTUICallEngine();case 33:t.next=44;break;case 35:if(-1!==o.indexOf(c)){t.next=39;break}this.TRTCCallingDelegate.onNoResp(p),t.next=42;break;case 39:return this.TRTCCallingDelegate.onCancel(g),t.next=42,this._resetTUICallEngine();case 42:E=this.getCallRecordReport().getCallRecordData().head,this.getCallRecordReport().eventUpload(m(m({},E),{},{eventType:Ng,inviteID:this.getInitialCallId()}));case 44:if(h!==qv.CONNECTED){t.next=51;break}if(this.TRTCCallingDelegate.onNoResp(p),1!==d.length||0!==f.length){t.next=51;break}return R=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(R),t.next=51,this._resetTUICallEngine();case 51:case"end":return t.stop()}}),t,this)}))),function(t){return J.apply(this,arguments)})},{key:"handleSDKReady",value:(z=o(_().mark((function t(){var e=this;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("ChatSdkEvent.SDK_READY",{text:{type:"event"}}),yT.info("TSignaling SDK ready"),this._loginResolveList.forEach((function(t){return t.resolve(t.value)})),this._loginResolveList=[],this.TRTCCallingDelegate.onSdkReady({message:"SDK ready"}),t.next=7,this.setSelfIMCallStatus(qv.IDLE);case 7:this._chat.getMyProfile().then((function(t){e.data.localUser=t.data})).catch((function(t){yT.warn("getMyProfile error:",t)}));case 9:case"end":return t.stop()}}),t,this)}))),function(){return z.apply(this,arguments)})},{key:"handleKickedOut",value:(W=o(_().mark((function t(){var e,n,r;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("ChatSdkEvent.KICKED_OUT",{text:{type:"event"}}),this.getCallStatus()!==qv.CONNECTED){t.next=6;break}return e=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(e),t.next=6,this._resetTUICallEngine();case 6:if(this.getCallStatus()!==qv.CALLING){t.next=14;break}return n=this.getUserID(),r=this.generateEventData(),this.TRTCCallingDelegate.onCancel(m(m({inviteID:this.data.invitation.inviteID,invitee:n,userID:n},r),{},{reason:Yg})),t.next=12,this.cancel();case 12:return t.next=14,this._resetTUICallEngine();case 14:this._initReady=!1,this.TRTCCallingDelegate.onKickedOut({message:"kicked out"});case 16:case"end":return t.stop()}}),t,this)}))),function(){return W.apply(this,arguments)})},{key:"_addTSignalingEvent",value:function(){var e,n,r,i,a,o=t.EVENT,s=t.TSignaling;null===(e=this._chat)||void 0===e||e.addSignalingListener(s.NEW_INVITATION_RECEIVED,this.handleNewInvitationReceived,this),null===(n=this._chat)||void 0===n||n.addSignalingListener(s.INVITEE_ACCEPTED,this.handleInviteeAccepted,this),null===(r=this._chat)||void 0===r||r.addSignalingListener(s.INVITEE_REJECTED,this.handleInviteeRejected,this),null===(i=this._chat)||void 0===i||i.addSignalingListener(s.INVITATION_CANCELLED,this.handleInvitationCancelled,this),null===(a=this._chat)||void 0===a||a.addSignalingListener(s.INVITATION_TIMEOUT,this.handleInvitationTimeout,this),this._chat.on(o.SDK_READY,this.handleSDKReady,this),this._chat.on(o.KICKED_OUT,this.handleKickedOut,this),this._chat.on(o.USER_STATUS_UPDATED,this.onUserStatusUpdated,this)}},{key:"_removeTSignalingEvent",value:function(){var e,n,r,i,a,o=t.EVENT,s=t.TSignaling;null===(e=this._chat)||void 0===e||e.removeSignalingListener(s.NEW_INVITATION_RECEIVED,this.handleNewInvitationReceived),null===(n=this._chat)||void 0===n||n.removeSignalingListener(s.INVITEE_ACCEPTED,this.handleInviteeAccepted),null===(r=this._chat)||void 0===r||r.removeSignalingListener(s.INVITEE_REJECTED,this.handleInviteeRejected),null===(i=this._chat)||void 0===i||i.removeSignalingListener(s.INVITATION_CANCELLED,this.handleInvitationCancelled),null===(a=this._chat)||void 0===a||a.removeSignalingListener(s.INVITATION_TIMEOUT,this.handleInvitationTimeout),this._chat.off(o.SDK_READY,this.handleSDKReady),this._chat.off(o.KICKED_OUT,this.handleKickedOut),this._chat.off(o.USER_STATUS_UPDATED,this.onUserStatusUpdated)}},{key:"onLocalJoin",value:function(){var t=hw("enterRoom").resolve;if(this._logger.info("TRTC.EVENT.LOCAL_JOIN",{text:{type:"event",data:{userId:this.getUserID()}}}),!this.isInviter()){var e=this.generateEventData();this.TRTCCallingDelegate.onCallBegin(e)}CT(t)&&t()}},{key:"onRemoteUserJoin",value:(q=o(_().mark((function t(e){var n,r,i,a,o;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("TRTC.EVENT.REMOTE_USER_JOIN",{text:{type:"event",data:null==e?void 0:e.data}}),n=e.data,r=n.userID,i=n.userList,a=n.playerList,yT.info("REMOTE_USER_JOIN",e,r),this.getCallStatus()!==qv.CALLING||!this.isInviter()){t.next=8;break}return t.next=6,this.setSelfIMCallStatus(qv.CONNECTED);case 6:o=this.generateEventData(),this.TRTCCallingDelegate.onCallBegin(o);case 8:if(this.addHandledInviteeList([r]),this.deleteUnHandledInviteeList([r]),this.changeCallStatus(qv.CONNECTED),!(a.length>0)){t.next=17;break}return t.next=14,this.getUserProfile(a);case 14:t.t0=t.sent,t.next=18;break;case 17:t.t0=this.data.playerList;case 18:this.data.playerList=t.t0,this.data.startTalkTime||(this.data.startTalkTime=Date.now()),this.TRTCCallingDelegate.onUserEnter({userID:e.data.userID,playerList:this.data.playerList}),yT.log("REMOTE_USER_JOIN","playerList:",this.data.playerList,"userList:",i);case 22:case"end":return t.stop()}}),t,this)}))),function(t){return q.apply(this,arguments)})},{key:"onRemoteUserLeave",value:(K=o(_().mark((function t(e){var n,r,i,a,o,s;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("TRTC.EVENT.REMOTE_USER_LEAVE",{text:{type:"event",data:null==e?void 0:e.data}}),this.getCallStatus()!==qv.IDLE){t.next=3;break}return t.abrupt("return");case 3:if(n=e.data.userID,yT.info("REMOTE_USER_LEAVE",e,e.data.userID),this.deleteHandledInviteeList([n]),this.data.playerList=this.data.playerList.filter((function(t){return t.userID!==n})),this.TRTCCallingDelegate.onUserLeave({userID:n,playerList:this.data.playerList}),this.data.isGroupCall){t.next=17;break}return t.next=11,this.TSignalingClient.hangup({userIDList:[n],callType:this.data.config.type,callEnd:this.generateCallTotalTime()});case 11:return r=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(r),yT.log("REMOTE_USER_LEAVE","playerList:"),t.next=16,this._resetTUICallEngine();case 16:return t.abrupt("return");case 17:if(i=this.getHandledInviteeList(),a=this.getUnHandledInviteeList(),o=this.getUserID(),1!==i.length||i[0]!==o||0!==a.length){t.next=25;break}return s=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(s),t.next=25,this._resetTUICallEngine();case 25:case"end":return t.stop()}}),t,this)}))),function(t){return K.apply(this,arguments)})},{key:"onLocalNetStateUpdate",value:function(t){this.data.pusher=t.data.pusher;var e=this.data.pusher,n=e.userID,r=void 0===n?"":n,i=e.netStatus,a=void 0===i?{}:i,o={userId:r,quality:null==a?void 0:a.netQualityLevel};this.data.netWorkQualityList=VT(this.data.netWorkQualityList,o,$g),this.TRTCCallingDelegate.onUserNetworkQualityChanged(this.data.netWorkQualityList),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList})}},{key:"onRemoteNetStateUpdate",value:(B=o(_().mark((function t(e){var n,r,i,a,o,s,c,u;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.data.playerList=e.data.playerList,n=f(this.data.playerList);try{for(n.s();!(r=n.n()).done;)i=r.value,a=i.userID,o=void 0===a?"":a,s=i.netStatus,u={userId:o,quality:null==(c=void 0===s?{}:s)?void 0:c.netQualityLevel},this.data.netWorkQualityList=VT(this.data.netWorkQualityList,u,$g)}catch(t){n.e(t)}finally{n.f()}this.TRTCCallingDelegate.onUserNetworkQualityChanged(this.data.netWorkQualityList),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList});case 5:case"end":return t.stop()}}),t,this)}))),function(t){return B.apply(this,arguments)})},{key:"onUserStatusUpdated",value:(F=o(_().mark((function t(e){var n,r,i,a=this;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("onUserStatusUpdated",{text:{data:e},type:"event"}),n=(e.data||[]).find((function(t){return t.userID===a.getUserID()}))){t.next=4;break}return t.abrupt("return");case 4:if(r=yy[n.customStatus],(i=this.getCallStatus())===qv.IDLE){t.next=10;break}if(r===i){t.next=10;break}return t.next=10,this.setSelfIMCallStatus(i);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return F.apply(this,arguments)})},{key:"onError",value:function(t){yT.warn("onError",t),this.TRTCCallingDelegate.onError(t)}},{key:"onRemoteVideoAdd",value:function(t){this._logger.info("TRTC.EVENT.REMOTE_VIDEO_ADD",{text:{type:"event",data:null==t?void 0:t.data}}),yT.info("* room REMOTE_VIDEO_ADD",t);var e=t.data.player;this.setPlayerAttributesHandler(e,{muteVideo:!1})}},{key:"onRemoteVideoRemove",value:function(t){this._logger.info("TRTC.EVENT.REMOTE_VIDEO_REMOVE",{text:{type:"event",data:null==t?void 0:t.data}}),yT.info("* room REMOTE_VIDEO_REMOVE",t);var e=t.data.player;this.setPlayerAttributesHandler(e,{muteVideo:!0})}},{key:"onRemoteAudioAdd",value:(H=o(_().mark((function t(e){var n;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("TRTC.EVENT.REMOTE_AUDIO_ADD",{text:{type:"event",data:null==e?void 0:e.data}}),yT.info("* room REMOTE_AUDIO_ADD",e),t.next=4,this.getUserProfile([e.data.player]);case 4:n=t.sent,this.setPlayerAttributesHandler(n[0],{muteAudio:!1});case 6:case"end":return t.stop()}}),t,this)}))),function(t){return H.apply(this,arguments)})},{key:"onRemoteAudioRemove",value:function(t){this._logger.info("TRTC.EVENT.REMOTE_AUDIO_REMOVE",{text:{type:"event",data:null==t?void 0:t.data}}),yT.info("* room REMOTE_AUDIO_REMOVE",t);var e=t.data.player;this.setPlayerAttributesHandler(e,{muteAudio:!0})}},{key:"onRemoteAudioVolumeUpdate",value:(G=o(_().mark((function t(e){var n;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:yT.info("* room REMOTE_AUDIO_VOLUME_UPDATE",e),n=e.data.playerList,this.data.playerList=this._updateUserProfile(this.data.playerList,n),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList});case 4:case"end":return t.stop()}}),t,this)}))),function(t){return G.apply(this,arguments)})},{key:"onLocalAudioVolumeUpdate",value:function(t){var e=t.data.pusher;this.data.pusher=e,this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList})}},{key:"onMessageSentByMe",value:function(t){this.TRTCCallingDelegate.onMessageSentByMe(t)}},{key:"_addTRTCEvent",value:function(){this.TRTC.on(this.TRTC.EVENT.LOCAL_JOIN,this.onLocalJoin,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_USER_JOIN,this.onRemoteUserJoin,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_USER_LEAVE,this.onRemoteUserLeave,this),this.TRTC.on(this.TRTC.EVENT.LOCAL_NET_STATE_UPDATE,this.onLocalNetStateUpdate,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_NET_STATE_UPDATE,this.onRemoteNetStateUpdate,this),this.TRTC.on(this.TRTC.EVENT.ERROR,this.onError,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_VIDEO_ADD,this.onRemoteVideoAdd,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_VIDEO_REMOVE,this.onRemoteVideoRemove,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_AUDIO_ADD,this.onRemoteAudioAdd,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_AUDIO_REMOVE,this.onRemoteAudioRemove,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_AUDIO_VOLUME_UPDATE,this.onRemoteAudioVolumeUpdate,this),this.TRTC.on(this.TRTC.EVENT.LOCAL_AUDIO_VOLUME_UPDATE,this.onLocalAudioVolumeUpdate,this)}},{key:"_removeTRTCEvent",value:function(){this.TRTC.off(this.TRTC.EVENT.LOCAL_JOIN,this.onLocalJoin),this.TRTC.off(this.TRTC.EVENT.REMOTE_USER_JOIN,this.onRemoteUserJoin),this.TRTC.off(this.TRTC.EVENT.REMOTE_USER_LEAVE,this.onRemoteUserLeave),this.TRTC.off(this.TRTC.EVENT.LOCAL_NET_STATE_UPDATE,this.onLocalNetStateUpdate),this.TRTC.off(this.TRTC.EVENT.REMOTE_NET_STATE_UPDATE,this.onRemoteNetStateUpdate),this.TRTC.off(this.TRTC.EVENT.ERROR,this.onError),this.TRTC.off(this.TRTC.EVENT.REMOTE_VIDEO_ADD,this.onRemoteVideoAdd),this.TRTC.off(this.TRTC.EVENT.REMOTE_VIDEO_REMOVE,this.onRemoteVideoRemove),this.TRTC.off(this.TRTC.EVENT.REMOTE_AUDIO_ADD,this.onRemoteAudioAdd),this.TRTC.off(this.TRTC.EVENT.REMOTE_AUDIO_REMOVE,this.onRemoteAudioRemove),this.TRTC.off(this.TRTC.EVENT.REMOTE_AUDIO_VOLUME_UPDATE,this.onRemoteAudioVolumeUpdate),this.TRTC.off(this.TRTC.EVENT.LOCAL_AUDIO_VOLUME_UPDATE,this.onLocalAudioVolumeUpdate)}},{key:"initTRTC",value:function(){this._logger.info("initTRTC.start",{type:"api"});var t=this.TRTC.createPusher();this.setBeautyLevel(this._beautyLevel),this.data.pusher=t.pusherAttributes}},{key:"enterRoom",value:(V=o(_().mark((function t(e){var n,r;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("enterRoom.start",{text:{data:e},type:"api"}),n=lw({key:"enterRoom",timeout:15e3,errorMessage:"enter room timeout"}),this._addTRTCEvent(),r=m(m({},this.data.config),{},{roomID:this.getRoomId(),enableMic:!0,autopush:!0,enableAgc:!0,enableAns:!0,enableCamera:e.callType===Xv.VIDEO}),_T(jT(this.getRoomId(),this.getStrRoomId()))&&(r.strRoomID=this.getStrRoomId()),this.data.enterRoomStatus=!0,this.data.pusher=this.TRTC.enterRoom(r),this.setPusherAttributesHandler({enableCamera:e.callType===Xv.VIDEO}),this.getCurrentPusherInstance().start(),this._logger.info("enterRoom.updatePusher.start"),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher}),t.abrupt("return",n);case 12:case"end":return t.stop()}}),t,this)}))),function(t){return V.apply(this,arguments)})},{key:"setBeautyLevel",value:function(t){this._beautyLevel=t,this._initReady&&this.setPusherAttributesHandler({beautyLevel:this._beautyLevel})}},{key:"exitRoom",value:(j=o(_().mark((function t(){var e;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("exitRoom.start",{type:"api"}),t.next=3,this.getCurrentPusherInstance().stop();case 3:return t.next=5,this.TRTC.exitRoom();case 5:e=t.sent,this.data.pusher=e.pusher,this.data.playerList=e.playerList,this.data.unHandledInviteeList=[],this.data.enterRoomStatus=!1,this.initTRTC(),this._removeTRTCEvent();case 12:case"end":return t.stop()}}),t,this)}))),function(){return j.apply(this,arguments)})},{key:"setPusherAttributesHandler",value:function(t){this._logger.info("setPusherAttributesHandler.start",{text:{data:t},type:"api"}),this.data.pusher=this.TRTC.setPusherAttributes(t),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList})}},{key:"setPlayerAttributesHandler",value:(M=o(_().mark((function t(e,n){var r;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._logger.info("setPlayerAttributesHandler.start",{text:{data:n},type:"api"}),r=this.TRTC.setPlayerAttributes(e.streamID,n),yT.warn("setPlayerAttributesHandler",r),this.data.playerList=r.length>0?this._updateUserProfile(this.data.playerList,r):this.data.playerList,this.data.playerList.length>0&&0===r.length&&(this.data.playerList[0].hasAudio=!1,this.data.playerList[0].hasVideo=!1),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList});case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return M.apply(this,arguments)})},{key:"_mutePlayerAudio",value:function(t){this._logger.info("_mutePlayerAudio.start",{text:{data:t},type:"api"});var e=t.currentTarget.dataset.value;e.hasAudio&&e.muteAudio?this.setPlayerAttributesHandler(e,{muteAudio:!1}):!e.hasAudio||e.muteAudio||this.setPlayerAttributesHandler(e,{muteAudio:!0})}},{key:"_mutePlayerVideo",value:function(t){this._logger.info("_mutePlayerVideo.start",{text:{data:t},type:"api"});var e=t.currentTarget.dataset.value;e.hasVideo&&e.muteVideo?this.setPlayerAttributesHandler(e,{muteVideo:!1}):!e.hasVideo||e.muteVideo||this.setPlayerAttributesHandler(e,{muteVideo:!0})}},{key:"_pusherAudioHandler",value:function(){this._logger.info("_pusherAudioHandler.start",{type:"api",text:{data:{enableMic:this.data.pusher.enableMic}}}),this.data.pusher.enableMic?(this.setPusherAttributesHandler({enableMic:!1}),this.getCurrentPusherInstance().setMICVolume({volume:0})):(this.setPusherAttributesHandler({enableMic:!0}),this.getCurrentPusherInstance().setMICVolume({volume:100}))}},{key:"_pusherVideoHandler",value:function(){this._logger.info("_pusherVideoHandler.start",{type:"api",text:{data:{enableCamera:this.data.pusher.enableCamera}}}),this.data.pusher.enableCamera?this.setPusherAttributesHandler({enableCamera:!1}):this.setPusherAttributesHandler({enableCamera:!0})}},{key:"init",value:(P=o(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.login(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return P.apply(this,arguments)})},{key:"login",value:(U=o(_().mark((function t(e){var n=this;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._uniqueLoginId=BT(6),this._logger.updateGetReportData((function(){return{userid:e.userID,uniqueloginid:n._uniqueLoginId}})),this._logger.info("login.start",{type:"api",text:{data:m(m({},e),{},{userSig:""})}}),this.data.config.userID=e.userID,this.data.config.userSig=e.userSig,t.abrupt("return",new Promise((function(t,r){n._chat.login({userID:e.userID,userSig:e.userSig}).then(function(){var e=o(_().mark((function e(r){var i;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n._initReady=!0,e.next=3,n._resetTUICallEngine();case 3:n._addTSignalingEvent(),n.initTRTC(),null!==(i=r.data)&&void 0!==i&&i.repeatLogin&&(n._logger.info("login.success",{text:{error:"The TIM login status has been inherited into Call"},type:"api"}),yT.info("login - success: The TIM login status has been inherited into Call. IM 登录状态已成功被 Call 继承。"),n._chat.isReady()&&n.TRTCCallingDelegate.onSdkReady({message:"SDK ready"}),t()),n._loginResolveList.push({resolve:t,value:r});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){var i=e||{},a=i.code,o=i.message;2024===a||2025===a?(n._logger.warn("login.fail",{text:{error:"".concat(a,", ").concat(o)},type:"api"}),yT.warn("login failed: ".concat(a,", ").concat(o,".")),n._loginResolveList.push({resolve:t,value:{code:0,message:"success"}})):(n._logger.error("login.fail",{text:{error:"".concat(a,", ").concat(o)},type:"api"}),r(e))}))})));case 6:case"end":return t.stop()}}),t,this)}))),function(t){return U.apply(this,arguments)})},{key:"logout",value:(N=o(_().mark((function t(){var e,n,r;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("logout.start",{type:"api",text:{data:{userID:this.data.config.userID,initReady:this._initReady}}}),this._initReady){t.next=3;break}return t.abrupt("return");case 3:return this._loginResolveList=[],this._uniqueLoginId="",e=this.data.config,n=e.userID,r=e.userSig,t.prev=6,t.next=9,this._chat.logout({userID:n,userSig:r});case 9:yT.info("logout","IM logout success"),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(6),this._logger.error("logout.fail",{type:"api",text:{error:t.t0}}),yT.error("logout","IM logout failure");case 16:case"end":return t.stop()}}),t,this,[[6,12]])}))),function(){return N.apply(this,arguments)})},{key:"on",value:function(t,e,n){this._emitter.on(t,e,n)}},{key:"off",value:function(t,e){this._emitter.off(t,e)}},{key:"call",value:(L=o(_().mark((function t(e){var n,r,i,a,o,s,c,u,l,h;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("call.start",{type:"api",text:{data:e}}),n=e.userID,r=e.type,i=e.roomID,a=e.strRoomID,o=e.timeout,t.next=4,ID.getInstance().getAlert().check(new hD({api:"call",initReady:this._initReady,callStatus:this.data.callStatus,capabilityCode:cg.BASE,sdkAppID:this.data.config.sdkAppID}),{tim:this._chat});case 4:return t.prev=4,t.next=7,mD(r);case 7:t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(4),this._logger.error("call.fail",{text:{error:t.t0},type:"api"}),t.abrupt("return");case 13:if(this.getUserID()!==n){t.next=17;break}throw this._logger.error("call.fail",{text:{error:"Called id can not be yourself. userId:".concat(this.getUserID(),", inviteeId:").concat(n)},type:"api"}),yT.error("call failed. Called id can't be yourself. userId:".concat(this.getUserID(),", inviteeId:").concat(n)),new Error("call failed. Called id can't be yourself. userId:".concat(this.getUserID(),", inviteeId:").concat(n));case 17:return t.next=19,this.getSelfIMCallStatus([this.getUserID()]);case 19:if((s=t.sent)===qv.IDLE){t.next=23;break}throw this._logger.error("call.failed",{text:{data:{params:e,customStatus:s}},type:"api"}),new YT({code:tE.ERROR_REQUEST_REFUSED,messageParams:{value:s},fnName:"call"});case 23:return c={callType:wg,mediaType:r,inviteeList:[n]},t.prev=24,this.analyzeAndSetRoomId(i,a),this.data.config.type=r,this.data.invitation.inviter=this.data.config.userID,this.data.invitation.type=r,this.data.invitation.roomID=this.getRoomId(),this.data.isInviter=!0,this.data.remoteID=n,this.setGroupId(""),this.setCallTimeout(bT(o)?this.getCallTimeout():o),this.changeCallStatus(qv.CALLING),u=+new Date,t.next=38,this.enterRoom({callType:r});case 38:return l=+new Date,this._logger.info("enterRoom.success",{text:{data:{roomID:i,callType:r,cost:l-u}},type:"api"}),t.next=42,this.TSignalingClient.invite(m(m({},e),{},{roomID:this.getRoomId(),strRoomId:this.getStrRoomId(),timeout:this.getCallTimeout()}));case 42:if(h=t.sent,yT.info("call(userID: ".concat(n,", type: ").concat(r,") success, ").concat(h)),0!==h.code){t.next=54;break}this.data.invitation.inviteID=h.inviteID,this.addInviterInviteId(h.inviteID,[this.data.config.userID,n]),this.addUnHandledInviteeList([n]),this.addHandledInviteeList([this.getUserID()]),this.setInitialCallId(h.inviteID),this._callRecordUpload(m({eventType:Og},c)),this._callRecordReport.startHeartbeat(),t.next=58;break;case 54:return this._callRecordUpload(m({eventType:Hg},c)),this._logger.error("call.fail",{text:{error:h},type:"api"}),t.next=58,this._resetTUICallEngine();case 58:return t.abrupt("return",{data:h.data,pusher:this.data.pusher,roomID:this.getRoomId(),strRoomID:this.getStrRoomId()});case 61:return t.prev=61,t.t1=t.catch(24),t.t1.code===tE.ERROR_BLACKLIST&&this.TRTCCallingDelegate.onError(tE.ERROR_BLACKLIST,t.t1.message),this._callRecordUpload(m({eventType:Hg},c)),this._logger.error("call.fail",{text:{error:t.t1},type:"api"}),yT.error("call(userID:".concat(n,",type:").concat(r,") failed', error: ").concat(t.t1)),t.next=69,this._resetTUICallEngine();case 69:throw new Error(t.t1);case 70:case"end":return t.stop()}}),t,this,[[4,9],[24,61]])}))),function(t){return L.apply(this,arguments)})},{key:"groupCall",value:(A=o(_().mark((function t(e){var n,r,i,a,o,s,c,u,l,h;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("groupCall.start",{type:"api",text:{data:e}}),n=e.type,r=e.roomID,i=e.strRoomID,a=e.userIDList,o=e.timeout,t.next=4,ID.getInstance().getAlert().check(new hD({api:"groupCall",initReady:this._initReady,callStatus:this.data.callStatus,capabilityCode:cg.PRO,sdkAppID:this.data.config.sdkAppID}),{tim:this._chat});case 4:return t.prev=4,t.next=7,mD(n);case 7:t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(4),this._logger.error("groupCall.fail",{type:"api",text:{error:t.t0}}),t.abrupt("return");case 13:if(-1===a.indexOf(this.getUserID())){t.next=16;break}throw this._logger.error("groupCall.fail",{type:"api",text:{error:"Called list can not contain yourself"}}),new Error("groupCall failed. Called list can't contain yourself. userID:".concat(this.getUserID(),", inviteeIDList:").concat(a));case 16:return t.next=18,this.getSelfIMCallStatus([this.getUserID()]);case 18:if((s=t.sent)===qv.IDLE){t.next=22;break}throw this._logger.error("groupCall.fail",{text:{data:{params:e,customStatus:s}},type:"api"}),new YT({code:tE.ERROR_REQUEST_REFUSED,messageParams:{value:s},fnName:"groupCall"});case 22:return this.analyzeAndSetRoomId(r,i),c={callType:Sg,mediaType:n,inviteeList:e.userIDList},this.data.config.type=e.type,this.data.invitation.inviter=this.data.config.userID,this.data.invitation.type=n,this.data.invitation.roomID=this.getRoomId(),this.data.isInviter=!0,this.data.isGroupCall=!0,this.setGroupId(e.groupID),this.setCallTimeout(bT(o)?this.getCallTimeout():o),this.changeCallStatus(qv.CALLING),t.prev=33,u=+new Date,t.next=37,this.enterRoom({callType:n});case 37:return l=+new Date,this._logger.info("enterRoom.success",{text:{data:{roomID:r,callType:n,cost:l-u}},type:"api"}),t.next=41,this.TSignalingClient.inviteGroup(m(m({},e),{},{roomID:this.getRoomId(),strRoomID:this.getStrRoomId(),timeout:this.getCallTimeout()}));case 41:return h=t.sent,this.data.invitation.inviteID=h.inviteID,this.addUnHandledInviteeList(e.userIDList),this.addHandledInviteeList([this.getUserID()]),this.addInviterInviteId(h.inviteID,[this.data.config.userID].concat(b(e.userIDList))),this.setInitialCallId(h.inviteID),this._callRecordUpload(m({eventType:Og},c)),this._callRecordReport.startHeartbeat(),yT.log("groupCall OK",h),t.abrupt("return",{data:h.data,pusher:this.data.pusher,roomID:this.getRoomId(),strRoomID:this.getStrRoomId()});case 53:return t.prev=53,t.t1=t.catch(33),this._logger.error("groupCall.fail",{text:{error:t.t1},type:"api"}),yT.error("groupCall failed",t.t1),this._callRecordUpload(m({eventType:Hg},c)),t.next=60,this._resetTUICallEngine();case 60:throw new Error(t.t1);case 61:case"end":return t.stop()}}),t,this,[[4,9],[33,53]])}))),function(t){return A.apply(this,arguments)})},{key:"joinInGroupCall",value:(k=o(_().mark((function t(e){var n,r,i,a,o,s,c,u;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("joinInGroupCall.start",{text:{data:e},type:"api"}),n=e.roomID,r=e.strRoomID,i=e.type,a=e.groupID,t.next=4,ID.getInstance().getAlert().check(new hD({api:"joinInGroupCall",initReady:this._initReady,capabilityCode:cg.PRO,sdkAppID:this.data.config.sdkAppID}),{tim:this._chat});case 4:return t.next=6,this.getSelfIMCallStatus([this.getUserID()]);case 6:if((o=t.sent)===qv.IDLE){t.next=10;break}throw this._logger.error("joinInGroupCall.failed",{text:{data:{params:e,customStatus:o}},type:"api"}),new YT({code:tE.ERROR_REQUEST_REFUSED,messageParams:{value:o},fnName:"joinInGroupCall"});case 10:return t.prev=10,t.next=13,mD(i);case 13:t.next=19;break;case 15:return t.prev=15,t.t0=t.catch(10),this._logger.error("joinInGroupCall.failed",{text:{error:t.t0},type:"api"}),t.abrupt("return");case 19:return t.prev=19,this.data.config.type=i,this.data.invitation.type=i,yT.info("joinInGroupCall roomID:".concat(n,",type:").concat(i,",userID:").concat(this.getUserID())),this.changeCallStatus(qv.CALLING),this.addHandledInviteeList([this.getUserID()]),this.setGroupId(a),this.analyzeAndSetRoomId(n,r),this.data.isGroupCall=!0,this.data.isInviter=!1,s=+new Date,t.next=32,this.enterRoom({callType:i});case 32:return c=+new Date,this._logger.info("enterRoom.success",{text:{data:{roomID:n,callType:i,cost:c-s}},type:"api"}),t.next=36,this.setSelfIMCallStatus(qv.CONNECTED);case 36:return this.changeCallStatus(qv.CONNECTED),this.getCallRecordReport().setBodyStatus(qv.CONNECTED),u={eventType:Kg,callType:Sg,mediaType:this._callType},this._callRecordUpload(u),this._callRecordReport.startHeartbeat(),t.abrupt("return",this.data.pusher);case 44:return t.prev=44,t.t1=t.catch(19),this._logger.error("joinInGroupCall.failed",{text:{error:t.t1},type:"api"}),t.next=49,this._resetTUICallEngine();case 49:throw new Error("joinInGroupCall failed error: ".concat(t.t1));case 50:case"end":return t.stop()}}),t,this,[[10,15],[19,44]])}))),function(t){return k.apply(this,arguments)})},{key:"inviteUser",value:(x=o(_().mark((function t(e){var n,r,i,a,o,s,c,u,l,h=this;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("inviteUser.start",{text:{data:e},type:"api"}),t.next=3,ID.getInstance().getAlert().check(new hD({api:"inviteUser",initReady:this._initReady,capabilityCode:cg.PRO,sdkAppID:this.data.config.sdkAppID}),{tim:this._chat});case 3:if(n=e.userIDList,r=void 0===n?[]:n,this.isGroupCall()){t.next=8;break}throw this._logger.error("inviteUser.fail",{text:{error:"inviteUser - groupID:".concat(this.getGroupId(),", roomID:").concat(this.data.roomID,", type:").concat(this.data.callType)},type:"api"}),yT.error("inviteUser - groupID:".concat(this.getGroupId(),", roomID:").concat(this.data.roomID,", type:").concat(this.data.callType)),new Error("inviteUser - groupID:".concat(this.getGroupId(),", roomID:").concat(this.data.roomID,", type:").concat(this.data.callType));case 8:if(this.isInviter()||this.data.callStatus===qv.CONNECTED){t.next=12;break}throw this._logger.error("inviteUser.fail",{text:{error:"inviteUser - current status:".concat(this.data.callStatus," not support")},type:"api"}),yT.error("inviteUser - current status:".concat(this.data.callStatus," not support")),new Error("inviteUser - current status:".concat(this.data.callStatus," not support"));case 12:if(0!==r.length){t.next=16;break}throw this._logger.error("inviteUser.fail",{text:{error:"userIDList is empty"},type:"api"}),yT.error("inviteUser - userIDList is empty"),new Error("inviteUser - userIDList is empty");case 16:if(i=this.getHandledInviteeList(),a=this.getUnHandledInviteeList(),o=[].concat(b(i),b(a)),0!==(s=r.filter((function(t){return-1===o.indexOf(t)}))).length){t.next=24;break}return this._logger.error("inviteUser.fail",{text:{data:{userIDList:r},error:"userIDList in call list"},type:"api"}),yT.error("inviteUser failed - userIDList in call list. userIDList:".concat(JSON.stringify(r))),t.abrupt("return",Promise.reject("inviteUser failed - userIDList in call list. userIDList:".concat(JSON.stringify(r))));case 24:return r=s,t.prev=25,c=this.data.handledInviteeList.filter((function(t){return t!==h.getUserID()})),t.next=29,this.TSignalingClient.inviteGroup({groupID:this.getGroupId(),userIDList:r,type:this.data.invitation.type,roomID:this.getRoomId(),strRoomId:this.getStrRoomId(),timeout:this.getCallTimeout(),inCallUserIDs:[].concat(b(this.data.unHandledInviteeList),b(c)),initialCallId:this.getInitialCallId()});case 29:if(u=t.sent,yT.log("inviteUser res",u),0!==u.code){t.next=38;break}return this.addUnHandledInviteeList(r),this.addInviterInviteId(u.inviteID,[this.data.config.userID].concat(b(r))),l={eventType:Bg,callType:Sg,mediaType:this._callType,inviteeList:r},this._callRecordUpload(l),this._callRecordReport.startHeartbeat(),t.abrupt("return",u);case 38:t.next=44;break;case 40:throw t.prev=40,t.t0=t.catch(25),this._logger.error("inviteUser.fail",{text:{error:t.t0},type:"api"}),new Error("inviteUser failed, userId:".concat(this.getUserID(),", inviteeIdList:").concat(r,", error: ").concat(t.t0));case 44:case"end":return t.stop()}}),t,this,[[25,40]])}))),function(t){return x.apply(this,arguments)})},{key:"accept",value:(O=o(_().mark((function t(){var e=this;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("accept.start",{type:"api"}),t.next=3,ID.getInstance().getAlert().check(new hD({api:"accept",initReady:this._initReady,callStatus:this.data.callStatus,sdkAppID:this.data.config.sdkAppID}));case 3:return t.prev=3,t.next=6,mD(this.data.config.type);case 6:t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(3),this._logger.error("accept.fail",{text:{error:t.t0},type:"api"}),t.abrupt("return");case 12:return t.abrupt("return",new Promise((function(t,n){if(yT.info("accept() inviteID: ",e.data.invitation.inviteID),e.data.config.type!==Xv.VIDEO||e.data.isGroupCall)e.handleAccept(t,n);else if(e.data.devicePermission){e.setPusherAttributesHandler({enableCamera:!1});var r=setTimeout(o(_().mark((function i(){return _().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:clearTimeout(r),e.handleAccept(t,n);case 2:case"end":return i.stop()}}),i)}))),0)}else e.handleAccept(t,n)})));case 13:case"end":return t.stop()}}),t,this,[[3,8]])}))),function(){return O.apply(this,arguments)})},{key:"handleAccept",value:(S=o(_().mark((function t(e,n){var r,i,a,o;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("handleAccept.start",{type:"api"}),r=this.data.invitation.inviteID,i=+new Date,t.prev=3,t.next=6,this.enterRoom({callType:this.data.config.type});case 6:t.next=16;break;case 8:return t.prev=8,t.t0=t.catch(3),this._logger.error("accept.fail",{text:{error:t.t0},type:"api"}),yT.error("accept failed",t.t0),t.next=14,this._resetTUICallEngine();case 14:return n(t.t0),t.abrupt("return");case 16:return a=+new Date,this._logger.info("enterRoom.success",{text:{data:{roomID:this.data.invitation.roomID,callType:this.data.config.type,cost:a-i}},type:"api"}),t.next=20,this.modifyInvitation(r);case 20:return t.next=22,this.TSignalingClient.accept({inviteID:r,type:this.data.config.type});case 22:if(0!==(o=t.sent).code){t.next=36;break}return yT.log("accept OK"),t.next=27,this.setSelfIMCallStatus(qv.CONNECTED);case 27:this.addHandledInviteeList([this.getUserID()]),this.deleteUnHandledInviteeList([this.getUserID()]),this.addAcceptedUserList(r,[this.getUserID()]),this._callRecordUpload({eventType:Ag}),e({message:o.data.message,pusher:this.data.pusher}),this.changeCallStatus(qv.CONNECTED),this.getCallRecordReport().setBodyStatus(qv.CONNECTED),t.next=41;break;case 36:return this._logger.error("accept.fail",{text:{error:o},type:"api"}),yT.error("accept failed",o),n(o),t.next=41,this._resetTUICallEngine();case 41:case"end":return t.stop()}}),t,this,[[3,8]])}))),function(t,e){return S.apply(this,arguments)})},{key:"reject",value:(w=o(_().mark((function t(){var e,n,r;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("reject.start",{text:{data:{invitation:this.data.invitation,type:this.data.config.type}},type:"api"}),t.next=3,ID.getInstance().getAlert().checkSync(new hD({api:"reject",callStatus:this.data.callStatus,initReady:this._initReady}));case 3:if(!(e=this.data.invitation.inviteID)){t.next=15;break}return t.next=7,this.TSignalingClient.reject({inviteID:e,type:this.data.config.type});case 7:return n=t.sent,yT.log("reject OK",n),r=this.generateEventData(),this.TRTCCallingDelegate.onCancel(m(m({inviteID:e,invitee:this.getUserID(),userID:this.getUserID()},r),{},{reason:gg})),this._callRecordUpload({eventType:Pg}),t.next=14,this._resetTUICallEngine();case 14:return t.abrupt("return",n);case 15:return this._logger.error("reject.fail",{text:{error:"未收到邀请，无法拒绝"},type:"api"}),yT.warn("未收到邀请，无法拒绝"),t.abrupt("return","未收到邀请，无法拒绝");case 18:case"end":return t.stop()}}),t,this)}))),function(){return w.apply(this,arguments)})},{key:"hangup",value:(D=o(_().mark((function t(){var e,n,r,i,a,o,s,c,u,l,h,d,f,p,v,g,y,I,E=this;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("hangup.start",{text:{data:{isGroupCall:this.isGroupCall(),isInviter:this.isInviter(),currentUserID:this.getUserID(),totalTime:this.generateCallTotalTime(),callType:this.getCallType()}},type:"api"}),t.next=3,ID.getInstance().getAlert().checkSync(new hD({api:"hangup",callStatus:this.data.callStatus,initReady:this._initReady}));case 3:if(yT.warn(" - callStatus:".concat(this.data.callStatus," _inviterInviteID:").concat(JSON.stringify(this.data.invitation))),this.data.callStatus!==qv.IDLE){t.next=7;break}throw this._logger.error("hangup.fail",{text:{data:{currentStatus:this.data.callStatus},error:"hangup failed. current status:"},type:"api"}),new Error("hangup failed. current status:".concat(this.data.callStatus));case 7:if(this.data.callStatus!==qv.CALLING||0!==this.getInviterInviteIdList().length){t.next=10;break}throw this._logger.error("hangup.fail",{text:{error:"call/groupCall incomplete。please wait cancel"},type:"api"}),new Error("call/groupCall incomplete。please wait cancel");case 10:if(e=this.isGroupCall(),n=this.isInviter(),r=this.getUserID(),i=this.generateCallTotalTime(),a=this.getCallType(),s=this.getInviterInviteIdList(),this.data.callStatus!==qv.CONNECTED){t.next=31;break}if(t.prev=17,0!==s.length){t.next=23;break}return c=this.generateCallEndData({callMediaType:a,totalTime:i}),this.TRTCCallingDelegate.onCallEnd(c),t.next=23,this._resetTUICallEngine();case 23:t.next=31;break;case 25:return t.prev=25,t.t0=t.catch(17),t.next=29,this._resetTUICallEngine();case 29:throw this._logger.error("hangup.fail",{text:{error:t.t0},type:"api"}),new Error(t.t0);case 31:if(u=this.getHandledInviteeList(),l=this.getUnHandledInviteeList(),h=this.generateEventData(),t.prev=34,e){t.next=53;break}if(d=this.generateCallEndData(),!n){t.next=48;break}if(1!==l.length){t.next=45;break}return t.next=41,this.cancel();case 41:o=t.sent,this.TRTCCallingDelegate.onCancel(m(m({inviteID:this.data.invitation.inviteID,invitee:r,userID:r},h),{},{reason:vg})),t.next=46;break;case 45:this.TRTCCallingDelegate.onCallEnd(d);case 46:t.next=49;break;case 48:this.TRTCCallingDelegate.onCallEnd(d);case 49:return t.next=51,this._resetTUICallEngine();case 51:t.next=82;break;case 53:if(f=this.getCallStatus(),p={callType:this.getCallType(),isGroupCall:this.isGroupCall(),groupID:this.getGroupId(),userIDList:[].concat(b(u.filter((function(t){return t!==r}))),b(l)),callEnd:this.generateCallTotalTime()},!n){t.next=73;break}if(f!==qv.CALLING){t.next=63;break}return t.next=59,this.cancel(this.getInviterInviteIdList());case 59:return o=t.sent,this.TRTCCallingDelegate.onCancel(m(m({inviteID:this.data.invitation.inviteID,invitee:r,userID:r},h),{},{reason:vg})),t.next=63,this._resetTUICallEngine();case 63:if(f!==qv.CONNECTED){t.next=71;break}v=_().mark((function t(){var e,n,i,a,c,h,d;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s[g],n=E.getInviterInviteIdUserList(e),!((i=E.getAcceptedUserList(e)).length>0)){t.next=22;break}if(a=i.filter((function(t){return-1!==u.indexOf(t)})),c=n.filter((function(t){return-1!==l.indexOf(t)})),p.userIDList=[].concat(b(a),b(c)).filter((function(t){return t!==r})),yT.warn("inviter emit hangup signal, notify userIDList:".concat(JSON.stringify(p.userIDList))),h=E.generateCallEndData(),E.TRTCCallingDelegate.onCallEnd(h),0===p.userIDList.length){t.next=15;break}return t.next=12,E.TSignalingClient.hangup(p);case 12:o=t.sent,t.next=20;break;case 15:if(!(u.length>1)){t.next=20;break}return p.userIDList=u.filter((function(t){return t!==r})),t.next=19,E.TSignalingClient.hangup(p);case 19:o=t.sent;case 20:t.next=29;break;case 22:if(d=E.getUnHandledInviteeList(),!(n.filter((function(t){return-1!==d.indexOf(t)})).length>0)){t.next=29;break}return yT.warn("inviter emit cancel signal, userIdList:".concat(n)),t.next=28,E.cancel([e]);case 28:o=t.sent;case 29:case"end":return t.stop()}}),t)})),g=0;case 66:if(!(g<s.length)){t.next=71;break}return t.delegateYield(v(),"t1",68);case 68:g++,t.next=66;break;case 71:t.next=80;break;case 73:y=_().mark((function t(){var e,n,i,a,c,h,d;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s[I],n=E.getInviterInviteIdUserList(e),!((i=E.getAcceptedUserList(e)).length>0)){t.next=22;break}if(a=i.filter((function(t){return-1!==u.indexOf(t)})),c=n.filter((function(t){return-1!==l.indexOf(t)})),p.userIDList=[].concat(b(a),b(c)).filter((function(t){return t!==r})),yT.warn("invitee emit hangup signal, notify userIDList:".concat(JSON.stringify(p.userIDList))),h=E.generateCallEndData(),E.TRTCCallingDelegate.onCallEnd(h),0===p.userIDList.length){t.next=15;break}return t.next=12,E.TSignalingClient.hangup(p);case 12:o=t.sent,t.next=20;break;case 15:if(!(u.length>1)){t.next=20;break}return p.userIDList=u.filter((function(t){return t!==r})),t.next=19,E.TSignalingClient.hangup(p);case 19:o=t.sent;case 20:t.next=29;break;case 22:if(d=E.getUnHandledInviteeList(),!(n.filter((function(t){return-1!==d.indexOf(t)})).length>0)){t.next=29;break}return yT.warn("invitee emit cancel signal, inviteID:".concat(e)),t.next=28,E.cancel([e]);case 28:o=t.sent;case 29:case"end":return t.stop()}}),t)})),I=0;case 75:if(!(I<s.length)){t.next=80;break}return t.delegateYield(y(),"t2",77);case 77:I++,t.next=75;break;case 80:return t.next=82,this._resetTUICallEngine();case 82:return t.abrupt("return",o);case 85:throw t.prev=85,t.t3=t.catch(34),this._logger.error("hangup.fail",{text:{error:t.t3},type:"api"}),yT.warn("hangup failed, error: ".concat(t.t3)),new Error("hangup failed, error: ".concat(t.t3));case 90:case"end":return t.stop()}}),t,this,[[17,25],[34,85]])}))),function(){return D.apply(this,arguments)})},{key:"cancel",value:(C=o(_().mark((function t(e){var n,r,i,a,o;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("cancel.start",{text:{data:{inviteIDList:e}},type:"api"}),yT.info("cancel _inviterInviteID",this.data_inviterInviteID),n=[],t.prev=3,0===(e||[]).length&&(e=this.getInviterInviteIdList().slice(0,1)),t.next=7,this.modifyInvitation(e[0]);case 7:r=0;case 8:if(!(r<e.length)){t.next=17;break}return i=e[r],t.next=12,this.TSignalingClient.cancel({inviteID:i,callType:this.data.invitation.type});case 12:a=t.sent,n.push(a);case 14:r++,t.next=8;break;case 17:t.next=23;break;case 19:throw t.prev=19,t.t0=t.catch(3),this._logger.error("cancel.fail",{text:{error:t.t0},type:"api"}),new Error("_cancel failed, error: ".concat(t.t0));case 23:return o="cancel ".concat(JSON.stringify(n)," succeeded"),yT.log("cancel ".concat(o)),t.abrupt("return",n);case 26:case"end":return t.stop()}}),t,this,[[3,19]])}))),function(t){return C.apply(this,arguments)})},{key:"setRoomId",value:function(t){this.data.roomId=t}},{key:"getRoomId",value:function(){return this.data.roomId}},{key:"setStrRoomId",value:function(t){this.data.strRoomId=t}},{key:"getStrRoomId",value:function(){return this.data.strRoomId||""}},{key:"getCallType",value:function(){return this.data.invitation.type}},{key:"setGroupId",value:function(t){this.data.groupID=t}},{key:"getGroupId",value:function(){return this.data.groupID}},{key:"isGroupCall",value:function(){return this.data.isGroupCall}},{key:"getUserID",value:function(){return this.data.config.userID}},{key:"isInviter",value:function(){return this.data.isInviter}},{key:"getHandledInviteeList",value:function(){return this.data.handledInviteeList||[]}},{key:"getCallRecordReport",value:function(){return this._callRecordReport}},{key:"getUnHandledInviteeList",value:function(){return this.data.unHandledInviteeList||[]}},{key:"getCallStatus",value:function(){return this.data.callStatus}},{key:"setInitialInviteData",value:function(t){this._initialInviteData=t}},{key:"modifyInvitation",value:(T=o(_().mark((function t(e){var n;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isGroupCall()){t.next=2;break}return t.abrupt("return");case 2:return n=m(m({},this._initialInviteData.data),{},{consumed:!0}),t.prev=3,t.next=6,this._chat.modifyInvitation({inviteID:e,data:JSON.stringify(m(m({},this._initialInviteData),{},{data:n}))});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),yT.error("modifyInvitation fail ".concat(t.t0));case 11:case"end":return t.stop()}}),t,this,[[3,8]])}))),function(t){return T.apply(this,arguments)})},{key:"getInviterInviteID",value:function(t){return this.data._inviterInviteID[t]||[]}},{key:"addAcceptedUserList",value:function(t,e){var n=this;if(0!==e.length)if(t)0===(this.data._acceptedUserObject[t]||[]).length?this.data._acceptedUserObject[t]=e:e.forEach((function(e){-1===n.data._acceptedUserObject[t].indexOf(e)&&n.data._acceptedUserObject[t].push(e)}));else for(var r=this.getInviterInviteIdList(),i=function(){var t=r[a],i=n.getInviterInviteIdUserList(t),o=e.filter((function(t){return-1!==i.indexOf(t)}));0===(n._acceptedUserObject[t]||[]).length?n.data._acceptedUserObject[t]=o:o.forEach((function(e){-1===n.data._acceptedUserObject[t].indexOf(e)&&n.data._acceptedUserObject[t].push(e)}))},a=0;a<r.length;a++)i()}},{key:"getAcceptedUserList",value:function(t){return this.data._acceptedUserObject[t]||[]}},{key:"getInviterInviteIdList",value:function(){return Object.keys(this.data._inviterInviteID||{})}},{key:"getTotalInviterInviteIdList",value:function(){var t=this.getInviterInviteIdList();return[].concat(b(this.data._audioVideoSwitchIdList),b(t))}},{key:"getInviterInviteIdUserList",value:function(t){var e=this,n=[];return t?n=this.data._inviterInviteID[t]||[]:this.getInviterInviteIdList().forEach((function(t){n=[].concat(b(n),b(e.getInviterInviteIdUserList(t)))})),n}},{key:"addAudioVideoSwitchIdList",value:function(t){t&&this.data._audioVideoSwitchIdList.push(t)}},{key:"getAudioVideoSwitchIdList",value:function(){return this.data._audioVideoSwitchIdList||[]}},{key:"addUnHandledInviteeList",value:function(t){var e=this;0!==t.length&&(t.forEach((function(t){-1===e.data.unHandledInviteeList.indexOf(t)&&e.data.unHandledInviteeList.push(t)})),this.data.unHandledInviteeList=Array.from(new Set(this.data.unHandledInviteeList)))}},{key:"deleteUnHandledInviteeList",value:function(t){var e=this;0!==t.length&&t.forEach((function(t){e.data.unHandledInviteeList=e.data.unHandledInviteeList.filter((function(e){return e!==t}))}))}},{key:"addHandledInviteeList",value:function(t){var e=this;0!==t.length&&(t.forEach((function(t){-1===e.data.handledInviteeList.indexOf(t)&&e.data.handledInviteeList.push(t)})),this.data.handledInviteeList=Array.from(new Set(this.data.handledInviteeList)))}},{key:"deleteHandledInviteeList",value:function(t){var e=this;0!==t.length&&t.forEach((function(t){e.data.handledInviteeList=e.data.handledInviteeList.filter((function(e){return e!==t}))}))}},{key:"getSwitchCallModeStatus",value:function(){return this.data.switchCallModeStatus}},{key:"changeCallStatus",value:function(t){var e=this;switch(this._logger.info("changeCallStatus.start",{text:{data:{status:t}},type:"api"}),this.data.callStatus=t,t){case qv.CONNECTED:if(this.data.timer)return;this.data.timer=setInterval((function(){var t,n,r,i,a,o;e.data.chatTime=(t=e.data.chatTimeNum,(o=t)>=3600?(r=parseInt(o/3600)<10?"0".concat(parseInt(o/3600)):parseInt(o/3600),i=parseInt(o%60/60)<10?"0".concat(parseInt(o%60/60)):parseInt(o%60/60),(a=o%3600<10?"0".concat(o%3600):o%3600)>60&&(i=parseInt(a/60)<10?"0".concat(parseInt(a/60)):parseInt(a/60),a=a%60<10?"0".concat(a%60):a%60),n="".concat(r,":").concat(i,":").concat(a)):o>=60&&o<3600?(i=parseInt(o/60)<10?"0".concat(parseInt(o/60)):parseInt(o/60),a=o%60<10?"0".concat(o%60):o%60,n="00:".concat(i,":").concat(a)):o<60&&(a=o<10?"0".concat(o):o,n="00:00:".concat(a)),n),e.data.chatTimeNum+=1,e.data.pusher.chatTime=e.data.chatTime,e.data.pusher.chatTimeNum=e.data.chatTimeNum,e.TRTCCallingDelegate.onUserUpdate({pusher:e.data.pusher,playerList:e.data.playerList})}),1e3);break;case qv.IDLE:clearInterval(this.data.timer),this.data.timer=null,this.data.chatTime="00:00:00",this.data.chatTimeNum=0}}},{key:"_resetTUICallEngine",value:(R=o(_().mark((function t(e,n){var r,i;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=hw("enterRoom"),i=r.reject,CT(i)&&(this._logger.info("_resetTUICallEngine.resolve",{text:{data:{callEnd:e,type:n}},type:"api"}),i({message:"enter room reset"})),this.getCallStatus()===qv.IDLE){t.next=7;break}if(this.data.callStatus=qv.IDLE,!this.getIsLogin()){t.next=7;break}return t.next=7,this.setSelfIMCallStatus(qv.IDLE);case 7:if(this._logger.info("_resetTUICallEngine.start",{text:{data:{callEnd:e,type:n}},type:"api"}),this.changeCallStatus(qv.IDLE),yT.info(" _resetTUICallEngine()",this.data.enterRoomStatus),!this.data.enterRoomStatus){t.next=13;break}return t.next=13,this.exitRoom(e,n);case 13:this.data.config.type=Xv.AUDIO,this._initialCallId="",this.initData();case 16:case"end":return t.stop()}}),t,this)}))),function(t,e){return R.apply(this,arguments)})},{key:"startRemoteView",value:(E=o(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._logger.info("startRemoteView.start",{text:{data:{userID:e}},type:"api"}),this.data.playerList.forEach((function(t){if(t.userID===e)return t.muteVideo=!1,void yT.info("startRemoteView(".concat(e,")"))}));case 2:case"end":return t.stop()}}),t,this)}))),function(t){return E.apply(this,arguments)})},{key:"stopRemoteView",value:function(t){this._logger.info("stopRemoteView.start",{text:{data:{userID:t}},type:"api"}),this.data.playerList.forEach((function(e){if(e.userID===t)return e.muteVideo=!0,void yT.info("stopRemoteView(".concat(t,")"))}))}},{key:"openCamera",value:function(){this._logger.info("openCamera.start",{text:{data:{enableCamera:this.data.pusher.enableCamera}},type:"api"}),ID.getInstance().getAlert().checkSync(new hD({api:"openCamera",callStatus:this.data.callStatus,initReady:this._initReady})),this.data.pusher.enableCamera||this._pusherVideoHandler(),yT.info("openCamera() pusher: ".concat(this.data.pusher))}},{key:"closeCamera",value:function(){this._logger.info("closeCamera.start",{text:{data:{enableCamera:this.data.pusher.enableCamera}},type:"api"}),ID.getInstance().getAlert().checkSync(new hD({api:"closeCamera",callStatus:this.data.callStatus,initReady:this._initReady})),this.data.pusher.enableCamera&&this._pusherVideoHandler(),yT.info("closeCamera() pusher: ".concat(this.data.pusher))}},{key:"switchCamera",value:function(){this._logger.info("switchCamera.start",{text:{data:{frontCamera:this.data.pusher.frontCamera}},type:"api"}),ID.getInstance().getAlert().checkSync(new hD({api:"switchCamera",callStatus:this.data.callStatus,initReady:this._initReady})),this.getCurrentPusherInstance().switchCamera(),yT.info("switchCamera(), frontCamera".concat(this.data.pusher.frontCamera))}},{key:"openMicrophone",value:function(){this._logger.info("openMicrophone.start",{text:{data:{enableMic:this.data.pusher.enableMic}},type:"api"}),ID.getInstance().getAlert().checkSync(new hD({api:"openMicrophone",callStatus:this.data.callStatus,initReady:this._initReady})),this.data.pusher.enableMic||this._pusherAudioHandler(),yT.info("openMicrophone() pusher: ".concat(this.data.pusher))}},{key:"closeMicrophone",value:function(){this._logger.info("closeMicrophone.start",{text:{data:{enableMic:this.data.pusher.enableMic}},type:"api"}),ID.getInstance().getAlert().checkSync(new hD({api:"closeMicrophone",callStatus:this.data.callStatus,initReady:this._initReady})),this.data.pusher.enableMic&&this._pusherAudioHandler(),yT.info("closeMicrophone() pusher: ".concat(this.data.pusher))}},{key:"selectAudioPlaybackDevice",value:function(t){this._logger.info("selectAudioPlaybackDevice.start",{text:{data:{type:t}},type:"api"}),ID.getInstance().getAlert().checkSync(new hD({api:"selectAudioPlaybackDevice",callStatus:this.data.callStatus,initReady:this._initReady}));var e=!1;switch(t){case"speaker":e=!0;break;case"ear":e=!1}return this.setHandsFree(e)}},{key:"setHandsFree",value:function(t){return this.data.soundMode=t?"speaker":"ear",yT.info("setHandsFree() result: ".concat(this.data.soundMode)),this.data.soundMode}},{key:"switchAudioCall",value:(I=o(_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("switchAudioCall.start",{type:"api"}),!this.isGroupCall()){t.next=5;break}return this._logger.error("switchAudioCall.fail",{text:{error:"switchToAudioCall is not applicable to groupCall"},type:"api"}),yT.warn("switchToAudioCall is not applicable to groupCall."),t.abrupt("return");case 5:if(this.data.invitation.type!==Xv.AUDIO){t.next=9;break}return this._logger.error("switchAudioCall.fail",{text:{error:"the call mode is audio call"},type:"api"}),yT.warn("Now the call mode is audio call."),t.abrupt("return");case 9:if(this.data.switchCallModeStatus){t.next=13;break}return this._logger.error("switchAudioCall.fail",{text:{error:"audio and video call switching"},type:"api"}),yT.warn("audio and video call switching."),t.abrupt("return");case 13:return this.setSwitchCallModeStatus(!1),this.setPusherAttributesHandler({enableCamera:!1}),t.abrupt("return",this.TSignalingClient.switchCallMode({userID:this.data.unHandledInviteeList[0]||this.data.playerList[0].userID,callType:this.data.invitation.type,roomID:this.data.invitation.roomID,mode:ag}));case 16:case"end":return t.stop()}}),t,this)}))),function(){return I.apply(this,arguments)})},{key:"switchCallMediaType",value:(y=o(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("closeMicrophone.start",{text:{data:{type:e}},type:"api"}),t.next=3,ID.getInstance().getAlert().check(new hD({api:"switchCallMediaType",callStatus:this.data.callStatus,initReady:this._initReady,sdkAppID:this.data.config.sdkAppID}));case 3:if(!this.isGroupCall()){t.next=7;break}throw this._logger.error("switchAudioCall.fail",{text:{error:"switchToAudioCall is not applicable to groupCall"},type:"api"}),yT.error("switchToAudioCall is not applicable to groupCall."),new YT(tE.ERROR_SCENE_NOT_SUPPORTED,"switchToAudioCall is not applicable to groupCall.");case 7:if(this.data.switchCallModeStatus){t.next=11;break}return this._logger.error("switchAudioCall.fail",{text:{error:"audio and video call switching"},type:"api"}),yT.warn("audio and video call switching."),t.abrupt("return");case 11:t.t0=e,t.next=t.t0===Xv.AUDIO?14:t.t0===Xv.VIDEO?17:20;break;case 14:return this.setSwitchCallModeStatus(!1),this.setPusherAttributesHandler({enableCamera:!1}),t.abrupt("return",this.TSignalingClient.switchCallMode({userID:this.data.unHandledInviteeList[0]||this.data.playerList[0].userID,callType:this.data.invitation.type,roomID:this.data.invitation.roomID,timeout:this.getCallTimeout(),mode:ag}));case 17:throw this._logger.error("switchAudioCall.fail",{text:{error:"Audio switching Video is not supported yet"},type:"api"}),yT.warn("Audio switching Video is not supported yet"),new Error("Audio switching Video is not supported yet");case 20:case"end":return t.stop()}}),t,this)}))),function(t){return y.apply(this,arguments)})},{key:"setSwitchCallModeStatus",value:function(t){this.data.switchCallModeStatus=t}},{key:"switchVideoCall",value:(g=o(_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("switchVideoCall.start",{type:"api"}),!this.isGroupCall()){t.next=5;break}return this._logger.error("switchAudioCall.fail",{text:{error:"switchToAudioCall is not applicable to groupCall"},type:"api"}),yT.warn("switchToVideoCall is not applicable to groupCall."),t.abrupt("return");case 5:if(this.data.invitation.type!==Xv.VIDEO){t.next=9;break}return this._logger.error("switchAudioCall.fail",{text:{error:"Now the call mode is video call"},type:"api"}),yT.warn("Now the call mode is video call."),t.abrupt("return");case 9:if(this.data.switchCallModeStatus){t.next=13;break}return this._logger.error("switchAudioCall.fail",{text:{error:"audio and video call switching"},type:"api"}),yT.warn("audio and video call switching."),t.abrupt("return");case 13:return this.setSwitchCallModeStatus(!1),this.setPusherAttributesHandler({enableCamera:!0}),t.abrupt("return",this.TSignalingClient.switchCallMode({userID:this.data.playerList[0].userID,callType:this.data.invitation.type,roomID:this.data.invitation.roomID,mode:og}));case 16:case"end":return t.stop()}}),t,this)}))),function(){return g.apply(this,arguments)})},{key:"getCurrentPusherInstance",value:function(){return this.TRTC.getPusherInstance().context=wx.createLivePusherContext(),this.TRTC.getPusherInstance()}},{key:"_pusherStateChangeHandler",value:function(t){this.TRTC.pusherEventHandler(t)}},{key:"_playerStateChange",value:function(t){this._emitter.emit(Kv.REMOTE_STATE_UPDATE,t)}},{key:"_playerAudioVolumeNotify",value:function(t){this.data.playerList.length>0&&this.TRTC.playerAudioVolumeNotify(t)}},{key:"_pusherAudioVolumeNotify",value:function(t){this.TRTC.pusherAudioVolumeNotify(t)}},{key:"_updateUserProfile",value:function(t,e){return 0===e.length||0===t.length?e:e.map((function(e){var n=e,r=t.filter((function(t){return t.userID===e.userID}));return n.avatar=r[0]&&r[0].avatar?r[0].avatar:"",n.nick=r[0]&&r[0].nick?r[0].nick:"",n}))}},{key:"getUserProfile",value:(v=o(_().mark((function t(e){var n,r,i,a,o=arguments;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:"array",0!==e.length){t.next=3;break}return t.abrupt("return",[]);case 3:return r=e.map((function(t){return t.userID})),t.next=6,this._chat.getUserProfile({userIDList:r});case 6:i=t.sent,a=null,t.t0=n,t.next="array"===t.t0?11:"map"===t.t0?13:16;break;case 11:return a=e.map((function(t,e){return t.avatar=i.data[e].avatar,t.nick=i.data[e].nick,t})),t.abrupt("break",16);case 13:return a={},e.forEach((function(t,e){t.avatar=i.data[e].avatar,t.nick=i.data[e].nick,a[t.userID]=t})),t.abrupt("break",16);case 16:return t.abrupt("return",a);case 17:case"end":return t.stop()}}),t,this)}))),function(t){return v.apply(this,arguments)})},{key:"setSelfInfo",value:function(t,e){return this._logger.info("setSelfInfo.start",{text:{data:{nickName:t,avatar:e}},type:"api"}),ID.getInstance().getAlert().checkSync(new hD({api:"setSelfInfo",initReady:this._initReady})),this._chat.updateMyProfile({nick:t,avatar:e})}},{key:"deviceCheck",value:(h=o(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,xT(e);case 2:if(t.t0=t.sent,!t.t0){t.next=5;break}t.t0=AT(e);case 5:return t.abrupt("return",t.t0);case 6:case"end":return t.stop()}}),t)}))),function(t){return h.apply(this,arguments)})},{key:"_pusherNetStatus",value:function(t){this.TRTC.pusherNetStatusHandler(t)}},{key:"_playNetStatus",value:function(t){this.TRTC.playerNetStatus(t)}},{key:"getTim",value:function(){return this._chat}},{key:"destroyed",value:(l=o(_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("destroyed.start",{type:"api"}),this.getCallStatus()===qv.IDLE){t.next=4;break}return t.next=4,this.handleExceptionExit();case 4:return t.next=6,this._resetTUICallEngine();case 6:if(this._removeTSignalingEvent(),this._removeTRTCEvent(),this._timExternal){t.next=11;break}return t.next=11,this.logout();case 11:this._initReady=!1;case 12:case"end":return t.stop()}}),t,this)}))),function(){return l.apply(this,arguments)})},{key:"handleExceptionExit",value:(u=o(_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("handleExceptionExit.start",{text:{data:{callStatus:this.getCallStatus()}},type:"api"}),t.prev=1,this.getCallStatus()!==qv.CALLING){t.next=10;break}if(!this.isInviter()){t.next=8;break}return t.next=6,this.hangup();case 6:t.next=10;break;case 8:return t.next=10,this.reject();case 10:if(this.getCallStatus()!==qv.CONNECTED){t.next=13;break}return t.next=13,this.hangup();case 13:t.next=19;break;case 15:throw t.prev=15,t.t0=t.catch(1),this._logger.error("handleExceptionExit.fail",{text:{data:{error:t.t0}},type:"api"}),t.t0;case 19:case"end":return t.stop()}}),t,this,[[1,15]])}))),function(){return u.apply(this,arguments)})},{key:"_callRecordUpload",value:function(t){var e=m(m({},t),{},{callRole:this.isInviter()?fg:pg,userID:this.getUserID(),roomID:this.getRoomId(),inviteID:this.getInitialCallId(),strRoomId:this.getStrRoomId(),groupId:this.getGroupId()});this._callRecordReport.eventUpload(e)}},{key:"generateCallEndData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.roomId,n=t.callMediaType,r=t.callRole,i=t.totalTime,a=t.userId;return e=e||this.getRoomId(),n=n||this.getCallType(),r||(r=this.isInviter()?tg:eg),i=bT(i)?this.generateCallTotalTime():i,a=a||this.getUserID(),{callID:this.getInitialCallId()||this.getInviterInviteIdList()[0],roomID:e,strRoomID:this.getStrRoomId(),callMediaType:n,callRole:r,totalTime:i,userID:a,callEnd:i,message:t.message||""}}},{key:"generateEventData",value:function(){return{callID:this.getInviterInviteIdList()[0],roomID:this.getRoomId(),strRoomID:this.getStrRoomId(),callRole:this.isInviter()?fg:pg,callMediaType:this.getCallType()}}},{key:"enableMultiDeviceAbility",value:(s=o(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.info("enableMultiDeviceAbility.start",{text:{data:{enable:e}},type:"api"}),t.next=3,ID.getInstance().getAlert().check(new hD({api:"enableMultiDeviceAbility",initReady:this._initReady,capabilityCode:cg.PRO,sdkAppID:this.data.config.sdkAppID}),{tim:this._chat});case 3:this.setIsEnableMultiDeviceAbility(e);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"setInitialCallId",value:function(t){this._initialCallId=t}},{key:"getInitialCallId",value:function(){return this._initialCallId}},{key:"getConnectStartTime",value:function(){return this.data.startTalkTime}},{key:"getIsLogin",value:function(){return this._initReady}},{key:"setIsEnableMultiDeviceAbility",value:function(t){this._isEnableMultiDeviceAbility=!!t}},{key:"getIsEnableMultiDeviceAbility",value:function(){return this._isEnableMultiDeviceAbility}},{key:"getInviterID",value:function(){return this.data.invitation.inviter}},{key:"setCallTimeout",value:function(t){this.data._callTimeout=t}},{key:"getCallTimeout",value:function(){return this.data._callTimeout}},{key:"getExcludeFromHistoryMessage",value:function(){return this._excludeFromHistoryMessage}},{key:"generateCallTotalTime",value:function(){return 0===this.getConnectStartTime()?0:Math.round((Date.now()-this.getConnectStartTime())/1e3)}},{key:"setSelfIMCallStatus",value:(a=o(_().mark((function t(e){var n,r,i;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.getIsEnableMultiDeviceAbility(),this._logger.info("setSelfIMCallStatus.start",{text:{data:{callStatus:e,isEnableMultiDeviceAbility:n}},type:"api"}),n){t.next=4;break}return t.abrupt("return");case 4:if(this._chat&&e&&this.getIsLogin()){t.next=6;break}return t.abrupt("return");case 6:r=py,t.prev=7,t.t0=e,t.next=t.t0===qv.CALLING?11:t.t0===qv.CONNECTED?13:15;break;case 11:return r=vy,t.abrupt("break",15);case 13:return r=gy,t.abrupt("break",15);case 15:return t.next=17,null===(i=this._chat)||void 0===i?void 0:i.setSelfStatus({customStatus:r});case 17:t.next=22;break;case 19:t.prev=19,t.t1=t.catch(7),this._logger.error("setSelfIMCallStatus.fail",{text:{error:t.t1},type:"api"});case 22:case"end":return t.stop()}}),t,this,[[7,19]])}))),function(t){return a.apply(this,arguments)})},{key:"getSelfIMCallStatus",value:(i=o(_().mark((function t(){var e,n,r,i,a,o,s,c,u=arguments;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=u.length>0&&void 0!==u[0]?u[0]:[],n=qv.IDLE,this.getIsEnableMultiDeviceAbility()){t.next=4;break}return t.abrupt("return",n);case 4:if(t.prev=4,this._logger.info("getSelfIMCallStatus.start",{text:{data:e},type:"api"}),this._chat&&0!==e.length&&this.getIsLogin()){t.next=8;break}return t.abrupt("return",n);case 8:return t.next=10,null===(r=this._chat)||void 0===r?void 0:r.getUserStatus({userIDList:e});case 10:if(0!==(i=t.sent).code){t.next=21;break}a=i.data||{},o=a.successUserList,s=(void 0===o?[]:o)[0]||{},c=s.customStatus,t.t0=c,t.next=t.t0===vy?17:t.t0===gy?19:21;break;case 17:return n=qv.CALLING,t.abrupt("break",21);case 19:return n=qv.CONNECTED,t.abrupt("break",21);case 21:t.next=26;break;case 23:t.prev=23,t.t1=t.catch(4),this._logger.error("getSelfIMCallStatus.fail",{text:{error:t.t1},type:"api"});case 26:return t.abrupt("return",n);case 27:case"end":return t.stop()}}),t,this,[[4,23]])}))),function(){return i.apply(this,arguments)})},{key:"reportLog",value:function(t){try{if(RT(t)){var e,n,r=t||{},i=r.name,a=void 0===i?"":i,o=r.data,s=r.error,c=r.type,u=void 0===c?"api":c,l=r.level,h=void 0===l?"info":l,d="error"===h?{error:s,data:o}:{data:o};null===(e=this._logger)||void 0===e||null===(n=e[h])||void 0===n||n.call(e,a,{text:d,type:u})}}catch(s){console.debug("reportLog fail: ",s)}}},{key:"analyzeAndSetRoomId",value:function(t,e){var n=jT(t,e);ET(n)&&this.setRoomId(n),e&&this.setStrRoomId(e)}},{key:"callExperimentalAPI",value:(r=o(_().mark((function t(e){var n,r,i,a,o,s;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.info("callExperimentalAPI",{text:{data:e},type:"api"}),(n=FT(e))!==e){t.next=4;break}return t.abrupt("return");case 4:if(r=n.api,i=n.params,a=void 0===i?{}:i,r&&a){t.next=7;break}return t.abrupt("return");case 7:t.prev=7,t.t0=r,t.next="setExcludeFromHistoryMessage"===t.t0?11:14;break;case 11:return o=a.excludeFromHistoryMessage,s=void 0!==o&&o,this._excludeFromHistoryMessage=s,t.abrupt("break",15);case 14:return t.abrupt("break",15);case 15:t.next=20;break;case 17:throw t.prev=17,t.t1=t.catch(7),t.t1;case 20:case"end":return t.stop()}}),t,this,[[7,17]])}))),function(t){return r.apply(this,arguments)})}],[{key:"createInstance",value:function(t){return Pw.updateEsConfig({url:"".concat("https://webim.tim.qq.com/v4/imopenstat/tweb_trtccalling_report","?sdkappid=").concat(null==t?void 0:t.sdkAppID),table:"timweb-trtccalling"}),n.instance||(n.instance=new n(t)),n.instance.initData(),n.instance}}]);var r,i,a,s,u,l,h,v,g,y,I,E,R,T,C,D,w,S,O,x,k,A,L,N,U,P,M,j,V,G,H,F,B,K,q,W,z,J,Y,Q,$,X,Z,tt,et,nt}(),p(Sw,"instance",null),p(Sw,"AUDIO_PLAYBACK_DEVICE",sg),p(Sw,"MEDIA_TYPE",Xv),p(Sw,"EVENT",Kv),p(Sw,"STATUS",qv),n(ww=Sw,"createInstance",[fw],Object.getOwnPropertyDescriptor(ww,"createInstance"),ww),n(ww.prototype,"setBeautyLevel",[pw],Object.getOwnPropertyDescriptor(ww.prototype,"setBeautyLevel"),ww.prototype),n(ww.prototype,"init",[vw],Object.getOwnPropertyDescriptor(ww.prototype,"init"),ww.prototype),n(ww.prototype,"login",[gw],Object.getOwnPropertyDescriptor(ww.prototype,"login"),ww.prototype),n(ww.prototype,"on",[yw],Object.getOwnPropertyDescriptor(ww.prototype,"on"),ww.prototype),n(ww.prototype,"off",[Iw],Object.getOwnPropertyDescriptor(ww.prototype,"off"),ww.prototype),n(ww.prototype,"call",[mw],Object.getOwnPropertyDescriptor(ww.prototype,"call"),ww.prototype),n(ww.prototype,"groupCall",[Ew],Object.getOwnPropertyDescriptor(ww.prototype,"groupCall"),ww.prototype),n(ww.prototype,"joinInGroupCall",[_w],Object.getOwnPropertyDescriptor(ww.prototype,"joinInGroupCall"),ww.prototype),n(ww.prototype,"inviteUser",[Rw],Object.getOwnPropertyDescriptor(ww.prototype,"inviteUser"),ww.prototype),n(ww.prototype,"selectAudioPlaybackDevice",[bw],Object.getOwnPropertyDescriptor(ww.prototype,"selectAudioPlaybackDevice"),ww.prototype),n(ww.prototype,"switchCallMediaType",[Tw],Object.getOwnPropertyDescriptor(ww.prototype,"switchCallMediaType"),ww.prototype),n(ww.prototype,"setSelfInfo",[Cw],Object.getOwnPropertyDescriptor(ww.prototype,"setSelfInfo"),ww.prototype),n(ww.prototype,"enableMultiDeviceAbility",[Dw],Object.getOwnPropertyDescriptor(ww.prototype,"enableMultiDeviceAbility"),ww.prototype),ww);export{sg as AUDIO_PLAYBACK_DEVICE,Kv as EVENT,Xv as MEDIA_TYPE,qv as STATUS,Mw as TUICallEngine,Mw as default};
