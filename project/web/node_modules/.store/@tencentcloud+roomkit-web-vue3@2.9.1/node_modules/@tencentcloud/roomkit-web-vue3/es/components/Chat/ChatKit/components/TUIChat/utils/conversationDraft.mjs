var __defProp = Object.defineProperty;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __publicField = (obj, key, value) => __defNormalProp(obj, typeof key !== "symbol" ? key + "" : key, value);
import { TUIConversationService, TUIStore, StoreName, TUITranslateService } from "@tencentcloud/chat-uikit-engine";
import { transformTextWithKeysToEmojiNames } from "../emoji-config/index.mjs";
import { JSONToObject } from "../../../utils/type-check.mjs";
const _ConversationDraftManager = class _ConversationDraftManager {
  constructor() {
    __publicField(this, "quoteMessageMap", /* @__PURE__ */ new Map());
  }
  static getInstance() {
    if (!_ConversationDraftManager.instance) {
      _ConversationDraftManager.instance = new _ConversationDraftManager();
    }
    return _ConversationDraftManager.instance;
  }
  setStore(conversationID, draftContent, abstract, quoteMessage) {
    var _a, _b;
    if (conversationID && (this.isEditorNotEmpty(draftContent) || ((_a = quoteMessage == null ? void 0 : quoteMessage.message) == null ? void 0 : _a.ID))) {
      let additionalDraftInfo = {};
      if ((_b = quoteMessage == null ? void 0 : quoteMessage.message) == null ? void 0 : _b.ID) {
        this.quoteMessageMap.set(quoteMessage.message.ID, quoteMessage.message);
        additionalDraftInfo = { messageID: quoteMessage.message.ID, type: quoteMessage.type };
      }
      const draftParams = {
        conversationID,
        draftInfo: {
          html: draftContent,
          abstract,
          ...additionalDraftInfo
        }
      };
      TUIConversationService.setConversationDraft(draftParams);
      TUIStore.update(StoreName.CHAT, "quoteMessage", { message: void 0, type: "quote" });
    }
  }
  getStore(conversationID, setEditorContentCallback) {
    const conversation = TUIStore.getConversationModel(conversationID);
    if (!conversation) {
      return;
    }
    if (conversation.conversationID && conversation.draftText) {
      const draftObject = JSONToObject(conversation.draftText);
      TUIStore.update(StoreName.CHAT, "quoteMessage", { message: this.quoteMessageMap.get(draftObject.messageID) || void 0, type: draftObject.type });
      setEditorContentCallback(draftObject.html);
    }
    TUIConversationService.setConversationDraft({ conversationID: conversation.conversationID });
  }
  generateAbstract(editorContent) {
    let abstract = "";
    editorContent == null ? void 0 : editorContent.forEach((item) => {
      switch (item.type) {
        case "text":
          abstract += transformTextWithKeysToEmojiNames(item.payload.text || "");
          break;
        case "image":
          abstract += TUITranslateService.t("TUIChat.图片");
          break;
        case "video":
          abstract += TUITranslateService.t("TUIChat.视频");
          break;
        case "file":
          abstract += TUITranslateService.t("TUIChat.文件");
          break;
      }
    });
    return abstract;
  }
  isEditorNotEmpty(editorHTML) {
    return editorHTML && !editorHTML.includes("is-empty") && editorHTML !== "<p></p>";
  }
};
__publicField(_ConversationDraftManager, "instance", null);
let ConversationDraftManager = _ConversationDraftManager;
const DraftManager = ConversationDraftManager.getInstance();
export {
  DraftManager as default
};
