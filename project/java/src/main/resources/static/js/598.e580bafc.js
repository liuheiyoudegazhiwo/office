"use strict";(self["webpackChunkproject"]=self["webpackChunkproject"]||[]).push([[598],{3598:function(e,t,i){i.r(t),i.d(t,{default:function(){return h}});var l=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.pendingflag,expression:"pendingflag"}],staticClass:"user-main"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{staticClass:"user-demoright",attrs:{span:24}},[t("div",{staticClass:"demo-user-contentfu"},[t("div",{staticClass:"demo-user-content"},[t("el-row",{staticClass:"demo-user-contentbutleft"},[t("el-col",{attrs:{span:10}},[t("div",{staticClass:"demo-user-contentbutleftsub"},[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:e.addtop}},[e._v("新增 ")])],1)]),t("el-col",{attrs:{span:6}},[e._v(" ")]),t("el-col",{attrs:{span:8}})],1)],1),t("div",{staticClass:"demo-user-page"},[t("el-table",{ref:"multipleTable",staticClass:"demo-user-tablemore",staticStyle:{width:"100%"},attrs:{"header-cell-style":e.headerstyle,data:e.tableData,height:"500","tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[e._l(e.griddata,(function(e,i){return t("el-table-column",{key:i,attrs:{"show-overflow-tooltip":"",prop:e.prop,label:e.label,width:e.width}})})),t("el-table-column",{attrs:{prop:"img",label:"图片",width:"160"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",{staticClass:"receiveclasspic"},e._l(i.row.trans_Arrpic,(function(i,l){return t("img",{key:l,attrs:{src:i,alt:"",width:"45",height:"45"},on:{click:function(t){return e.showimg(i)}}})})),0)]}}])}),t("el-table-column",{attrs:{label:"操作",width:"110"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:"",plain:"",size:"mini"},on:{click:function(t){return e.handleEdit(i.$index,i.row)}}}),t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",plain:"",size:"mini"},on:{click:function(t){return e.handleDelete(i.$index,i.row)}}})]}}])})],2)],1)])])],1),t("el-dialog",{staticClass:"diaitemrole",attrs:{title:e.roleinfotitle,visible:e.dialogroleVisible,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.dialogroleVisible=t}}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"公告名称",prop:"title"}},[t("el-input",{attrs:{placeholder:"请输入公告名称",maxlength:"30"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"公告图片",prop:"trans_pic"}},[t("el-upload",{attrs:{action:"/api/uploadfile","list-type":"picture-card","on-preview":e.handlePictureCardPreviewwl,"on-remove":e.handleRemovewl,"on-success":e.handleSuccesswl,"file-list":e.fileListwl}},[t("i",{staticClass:"el-icon-plus"})])],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"公告内容",prop:"detail"}},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入公告内容"},model:{value:e.form.detail,callback:function(t){e.$set(e.form,"detail",t)},expression:"form.detail"}})],1)],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.userinfosubmit}},[e._v("确 定")]),t("el-button",{on:{click:function(t){e.dialogroleVisible=!1}}},[e._v("取 消")])],1)],1),t("el-dialog",{attrs:{title:"查看图片",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[t("img",{staticClass:"diagimg",attrs:{src:e.imgshow}})])],1)},s=[],a=(i(435),i(2950),i(9511),i(3607),i(1360),i(8151),i(2068),i(2080),i(1071),i(834),i(287)),r=(i(9626),i(6365)),o={name:"extenddevice",components:{},created(){this.userinfo=JSON.parse(sessionStorage.getItem("userinfo")),this.init()},mounted(){},data(){return{inpuflag:!0,dialogTableVisible:!1,imgshow:"",dialogFormVisible:!1,id:"",placeholdercontent:"",formvisi:{content:""},userinfo:{},drawer:!1,textarea:"",pendingflag:!1,updatetype:"",single:!0,multiple:!0,roleinfotitle:"",dialogcolnmVisible:!1,dialogroleVisible:!1,dataTree:[],search:{keyword:"",status:"正常"},griddata:[{prop:"datetime",label:"发布时间",width:"200"},{prop:"title",label:"公告名称",width:"200"},{prop:"detail",label:"公告内容",width:""},{prop:"submitbody",label:"发布人",width:"200"}],tableData:[],fileListwl:[],multipleSelection:[],currentPage:1,form:{title:"",detail:""},rules:{title:[{required:!0,message:"公告名称不能为空",trigger:"blur"}]},current:1,size:10,total:0,dataitem:[]}},methods:{init(){this.query()},searchfun(){this.query()},showimg(e){this.dialogTableVisible=!0,this.imgshow=e},resetfun(){this.search.keyword=""},handleChange(e){console.log(e)},handleSelectionChange(e){this.multipleSelection=e,this.single=1!=e.length,this.multiple=!e.length},handleSizeChange(e){this.size=e,this.query()},handleCurrentChange(e){this.current=e,this.query()},headerstyle(){return"background-color: #f1f1f1"},colnmsubmit(){this.dialogcolnmVisible=!1},query(){let e={current:this.current,keyword:this.search.keyword,size:this.size,status:"正常"==this.search.status?0:1};(0,a.r6)(e).then((e=>{this.tableData=e.map(((e,t)=>(e.status=0==e.status,e.trans_pic&&(e.trans_Arrpic=e.trans_pic.split("^^^")),e))),this.pendingflag=!1})).catch((e=>{this.pendingflag=!1}))},getnowdate(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,l=e.getDate()<10?"0"+e.getDate():e.getDate(),s=t+"-"+i+"-"+l;return s},getnowtime(){let e=new Date,t=e.getHours(),i=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),l=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds(),s=t+":"+i+":"+l;return s},userinfosubmit(){let e=this.userinfo;if(this.pendingflag=!0,"新增公告"==this.roleinfotitle){let t={trans_pic:this.transpicurl(this.fileListwl),title:this.form.title,detail:this.form.detail,datetime:this.getnowdate()+" "+this.getnowtime(),submitbody:e.userName,status:1};this.reset(),(0,a.KJ)(t).then((e=>{this.query(),this.$message.success("操作成功"),this.dialogitemVisible=!1})).catch((e=>{this.dialogitemVisible=!1,this.pendingflag=!1}))}else{let t;"top"==this.updatetype&&(t=this.multipleSelection[0].id),"line"==this.updatetype&&(t=this.form.id);let i={trans_pic:this.transpicurl(this.fileListwl),title:this.form.title,detail:this.form.detail,datetime:this.getnowdate()+" "+this.getnowtime(),submitbody:e.userName,id:t};(0,a.KP)(i).then((e=>{this.query(),this.$message.success("操作成功"),this.dialogitemVisible=!1})).catch((e=>{this.dialogitemVisible=!1,this.pendingflag=!1}))}this.dialogroleVisible=!1},transpicurl(e){let t=[];return e.forEach((e=>{t.push(e.url)})),t.join("^^^")},updatedata(){this.dialogroleVisible=!0,this.roleinfotitle="修改公告",this.updatetype="top",this.form=this.multipleSelection[0]},handleRemovewl(e,t){this.fileListwl=t},handlePictureCardPreviewwl(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},handleSuccesswl(e,t,i){console.log(e,t,i);let l=e,s=t.name,a={url:l,name:s};this.fileListwl.push(a)},seedata(e,t){this.id=t.id,this.querychatfun(),this.drawer=!0},handleEdit(e,t){this.updatetype="line",this.roleinfotitle="修改公告",this.dialogroleVisible=!0;let i=(0,r.A4)(t);this.form=i,this.form.status=i.status?0:1,console.log(this.form);let l=i.trans_pic;try{if(l.indexOf("^^^")>-1||l){let e=l.split("^^^"),t=[];e.forEach(((e,i)=>{let l={url:e,name:""};t.push(l)})),this.fileListwl=t}else this.fileListwl=[]}catch(s){this.fileListwl=[]}},changestatus(e,t){let i={id:t.id,status:t.status?0:1};(0,a.updatafloorstatus)(i).then((e=>{this.query(),this.$message.success("操作成功")})).catch((e=>{}))},handleDelete(e,t){let i=this;this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{i.pendingflag=!0;let e={id:t.id};i.pendingflag=!0,(0,a.vV)(e).then((e=>{i.query(),i.$message.success("操作成功")})).catch((e=>{i.$message.error("操作失败"),i.pendingflag=!1}))})).catch((()=>{this.$message({type:"info",message:"已取消"})}))},addtop(){this.dialogroleVisible=!0,this.roleinfotitle="新增公告",this.reset()},reset(){this.form.title="",this.form.detail="",this.fileListwl=[]},excelinit(){let e=this,t="";document.querySelector("#file").addEventListener("change",(function(){var i=document.querySelector("#file").files[0],l=i.name.split(".");if("xlsx"!==l[l.length-1]&&"xls"!==l[l.length-1])return alert("只能选择excel文件导入"),!1;const s=new FileReader;s.readAsBinaryString(i),s.onload=i=>{const l=i.target.result,s=window.XLS.read(l,{type:"binary"}),r=[];for(let e=0;e<s.SheetNames.length;e++){const t=window.XLS.utils.sheet_to_json(s.Sheets[s.SheetNames[e]]);r.push(...t)}console.log("result",r),t=r;let o=r.map(((e,t)=>e));e.$confirm("此操作将将追加数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e.pendingflag=!0,(0,a.saveactivityexcel)(o).then((t=>{location.reload(),console.log(t),e.query(),e.pendingflag=!1})).catch((t=>{e.pendingflag=!1}))})).catch((()=>{e.$message({type:"info",message:"已取消"})}))}}))},saveAs(e,t){var i=document.createElement("a");i.download=t||"下载",i.href=URL.createObjectURL(e),i.click(),setTimeout((function(){URL.revokeObjectURL(e)}),100)},downloadExl(e,t){console.log(e);let i=this;const l={SheetNames:["Sheet1"],Sheets:{},Props:{}};l.Sheets["Sheet1"]=XLSX.utils.json_to_sheet(e);let s={bookType:"xlsx",bookSST:!1,type:"binary"};console.log(s),this.saveAs(new Blob([i.s2ab(XLSX.write(l,s))],{type:"application/octet-stream"}),"这里是下载的文件名."+("biff2"==s.bookType?"xls":s.bookType))},s2ab(e){if("undefined"!==typeof ArrayBuffer){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),l=0;l!=e.length;++l)i[l]=255&e.charCodeAt(l);return t}for(t=new Array(e.length),l=0;l!=e.length;++l)t[l]=255&e.charCodeAt(l);return t}},watch:{},filters:{updatestatus(e){switch(e){case 0:return"离线";case 1:return"在线"}}}},n=o,c=i(6367),d=(0,c.A)(n,l,s,!1,null,"c923846c",null),h=d.exports}}]);